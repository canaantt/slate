var path=require("path"),fs=require("fs"),f=require("util").format,resolveFrom=require("resolve-from"),semver=require("semver"),exists=fs.existsSync||path.existsSync,find_package_json=function(e){for(var r=!1;!r;)if(exists(e+"/package.json"))r=e;else{if("/"===e)return!1;e=path.dirname(e)}return e},require_optional=function(e,r){r=r||{},r.strict="boolean"==typeof r.strict?r.strict:!0;var n=__dirname;module.parent&&(n=module.parent.filename);var n=find_package_json(n);if(!n)throw new Error("package.json can not be located");var i=JSON.parse(fs.readFileSync(f("%s/package.json",n))),o=e.split(/\//);if(!i.peerOptionalDependencies)throw new Error(f("no optional dependency [%s] defined in peerOptionalDependencies in package.json",o[0]));if(i.peerOptionalDependencies&&!i.peerOptionalDependencies[o[0]])throw new Error(f("no optional dependency [%s] defined in peerOptionalDependencies in package.json",o[0]));var a=i.peerOptionalDependencies[o[0]],t=void 0,s=e;try{t=require(s)}catch(p){try{if(s=resolveFrom(process.cwd(),e),null==s)return void 0;t=require(s)}catch(p){if("MODULE_NOT_FOUND"===p.code)return void 0}}var n=find_package_json(require.resolve(s));if(!n)throw new Error("package.json can not be located");var c=JSON.parse(fs.readFileSync(f("%s/package.json",n))),d=c.version;if(0==semver.satisfies(d,a)&&r.strict){var l=new Error(f("optional dependency [%s] found but version [%s] did not satisfy constraint [%s]",o[0],d,a));throw l.code="OPTIONAL_MODULE_NOT_FOUND",l}return t};require_optional.exists=function(e){try{var r=require_optional(e);return void 0===r?!1:!0}catch(n){return!1}},module.exports=require_optional;