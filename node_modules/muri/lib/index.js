function options(r){var t=/;/.test(r)?";":"&",e=qs.parse(r,t);return Object.keys(e).forEach(function(r){var t=e[r];"readPreferenceTags"==r?(t=readPref(t),t&&(e[r]=Array.isArray(t)?t:[t])):e[r]=format(t)}),e}function format(r){var t;return"true"==r?!0:"false"==r?!1:(t=parseInt(r,10),isNaN(t)?r:t)}function readPref(r){var t;if(Array.isArray(r))return t=r.map(readPref).filter(Boolean),t.length?t:void 0;var e,s=r.split(",");return t={},s.forEach(function(r){if(r=(r||"").trim()){e=!0;var s=r.split(":");t[s[0]]=format(s[1])}}),e&&t}function parse(r){var t,e,s,o=r,i={};return o=o.replace(/^mongodb:\/\//,""),/@/.test(o)&&(t=o.split(/@/),e=t[0],o=t[1],t=e.split(":"),i.auth={},i.auth.user=t[0],i.auth.pass=t[1]),ipcRgx.test(o)?(s=o.split(ipcRgx),i.ipc=s[0]+".sock",s[1]&&(s[1]=s[1].replace(/^\//,""),s[1]&&(i.db=s[1])),i):(t=o.split("/"),t[1]&&(i.db=t[1]),/^\[[^\]]+\]:\d+/.test(t[0])?(i.host=t[0].substring(1,t[0].indexOf("]:")),i.port=t[0].substring(t[0].indexOf("]:")+"]:".length)):(t=t[0].split(":"),i.host=t[0],i.port=t[1]||DEFAULT_PORT),i)}var qs=require("querystring"),DEFAULT_PORT=27017,DEFAULT_DB="test",ADMIN_DB="admin";module.exports=exports=function(r){if(!/^mongodb:\/\//.test(r))throw new Error('Invalid mongodb uri. Must begin with "mongodb://"\n  Received: '+r);var t={hosts:[],db:DEFAULT_DB,options:{}},e=/^mongodb:\/\/([^?]+)(\??.*)$/.exec(r);if(!e||"/"==e[1])throw new Error("Invalid mongodb uri. Missing hostname");var s,o=e[1],i=e[2];if(o.split(",").forEach(function(r){var e=parse(r);e.host?(t.hosts.push({host:e.host,port:parseInt(e.port,10)}),!s&&e.db&&(s=e.db)):e.ipc&&t.hosts.push({ipc:e.ipc}),e.auth&&(t.auth={user:e.auth.user,pass:e.auth.pass})}),!t.hosts.length)throw new Error("Invalid mongodb uri. Missing hostname");var n=i.split("?");return s||(n[0]?s=n[0].replace(/^\//,""):(s=/\/([^\.]+)$/.exec(e[1]),s&&s[1]&&(s=s[1]))),s?t.db=s:t.auth&&(t.db=ADMIN_DB),n[1]&&(t.options=options(n[1])),t};var ipcRgx=/\.sock/;module.exports.version=JSON.parse(require("fs").readFileSync(__dirname+"/../package.json","utf8")).version;