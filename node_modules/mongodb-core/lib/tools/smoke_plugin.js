var fs=require("fs");exports.attachToRunner=function(t,e){var s={results:[]},n={},r={beforeTest:function(t,e){t.startTime=Date.now(),n[t.name]=t,e()},afterTest:function(t,e){s.results.push({status:t.status,start:t.startTime,end:Date.now(),test_file:t.name,exit_code:0,url:""}),delete n[t.name],e()},beforeExit:function(t,n){fs.writeFile(e,JSON.stringify(s),function(){n()})}};return process.on("uncaughtException",function(t){for(var r in n)s.results.push({status:"fail",start:n[r].startTime,end:Date.now(),test_file:r,exit_code:0,url:""});fs.writeFileSync(e,JSON.stringify(s)),console.error(t.stack),process.exit(1)}),t.plugin(r),r};