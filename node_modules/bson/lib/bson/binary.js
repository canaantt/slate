function Binary(r,t){if(!(this instanceof Binary))return new Binary(r,t);if(this._bsontype="Binary",r instanceof Number?(this.sub_type=r,this.position=0):(this.sub_type=null==t?BSON_BINARY_SUBTYPE_DEFAULT:t,this.position=0),null==r||r instanceof Number)"undefined"!=typeof Buffer?this.buffer=new Buffer(Binary.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE)):this.buffer=new Array(Binary.BUFFER_SIZE),this.position=0;else{if("string"==typeof r)if("undefined"!=typeof Buffer)this.buffer=new Buffer(r);else{if("undefined"==typeof Uint8Array&&"[object Array]"!=Object.prototype.toString.call(r))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=writeStringToArray(r)}else this.buffer=r;this.position=r.length}}if("undefined"!=typeof global)var Buffer=require("buffer").Buffer;Binary.prototype.put=function(r){if(null!=r.length&&"number"!=typeof r&&1!=r.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof r&&0>r||r>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var t=null;if(t="string"==typeof r?r.charCodeAt(0):null!=r.length?r[0]:r,this.buffer.length>this.position)this.buffer[this.position++]=t;else if("undefined"!=typeof Buffer&&Buffer.isBuffer(this.buffer)){var i=new Buffer(Binary.BUFFER_SIZE+this.buffer.length);this.buffer.copy(i,0,0,this.buffer.length),this.buffer=i,this.buffer[this.position++]=t}else{var i=null;i="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(Binary.BUFFER_SIZE+this.buffer.length)):new Array(Binary.BUFFER_SIZE+this.buffer.length);for(var e=0;e<this.buffer.length;e++)i[e]=this.buffer[e];this.buffer=i,this.buffer[this.position++]=t}},Binary.prototype.write=function(r,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+r.length){var i=null;if("undefined"!=typeof Buffer&&Buffer.isBuffer(this.buffer))i=new Buffer(this.buffer.length+r.length),this.buffer.copy(i,0,0,this.buffer.length);else if("[object Uint8Array]"==Object.prototype.toString.call(this.buffer)){i=new Uint8Array(new ArrayBuffer(this.buffer.length+r.length));for(var e=0;e<this.position;e++)i[e]=this.buffer[e]}this.buffer=i}if("undefined"!=typeof Buffer&&Buffer.isBuffer(r)&&Buffer.isBuffer(this.buffer))r.copy(this.buffer,t,0,r.length),this.position=t+r.length>this.position?t+r.length:this.position;else if("undefined"!=typeof Buffer&&"string"==typeof r&&Buffer.isBuffer(this.buffer))this.buffer.write(r,t,"binary"),this.position=t+r.length>this.position?t+r.length:this.position;else if("[object Uint8Array]"==Object.prototype.toString.call(r)||"[object Array]"==Object.prototype.toString.call(r)&&"string"!=typeof r){for(var e=0;e<r.length;e++)this.buffer[t++]=r[e];this.position=t>this.position?t:this.position}else if("string"==typeof r){for(var e=0;e<r.length;e++)this.buffer[t++]=r.charCodeAt(e);this.position=t>this.position?t:this.position}},Binary.prototype.read=function(r,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(r,r+t);for(var i="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),e=0;t>e;e++)i[e]=this.buffer[r++];return i},Binary.prototype.value=function(r){if(r=null==r?!1:r,r&&"undefined"!=typeof Buffer&&Buffer.isBuffer(this.buffer)&&this.buffer.length==this.position)return this.buffer;if("undefined"!=typeof Buffer&&Buffer.isBuffer(this.buffer))return r?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(r){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t="[object Uint8Array]"==Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),i=0;i<this.position;i++)t[i]=this.buffer[i];return t}return convertArraytoUtf8BinaryString(this.buffer,0,this.position)},Binary.prototype.length=function(){return this.position},Binary.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},Binary.prototype.toString=function(r){return null!=this.buffer?this.buffer.slice(0,this.position).toString(r):""};var BSON_BINARY_SUBTYPE_DEFAULT=0,writeStringToArray=function(r){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(r.length)):new Array(r.length),i=0;i<r.length;i++)t[i]=r.charCodeAt(i);return t},convertArraytoUtf8BinaryString=function(r,t,i){for(var e="",f=t;i>f;f++)e+=String.fromCharCode(r[f]);return e};Binary.BUFFER_SIZE=256,Binary.SUBTYPE_DEFAULT=0,Binary.SUBTYPE_FUNCTION=1,Binary.SUBTYPE_BYTE_ARRAY=2,Binary.SUBTYPE_UUID_OLD=3,Binary.SUBTYPE_UUID=4,Binary.SUBTYPE_MD5=5,Binary.SUBTYPE_USER_DEFINED=128,module.exports=Binary,module.exports.Binary=Binary;