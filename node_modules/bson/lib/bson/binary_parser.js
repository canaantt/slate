function BinaryParser(r,t){return this instanceof BinaryParser?(this.bigEndian=r,void(this.allowExceptions=t)):new BinaryParser(r,t)}function BinaryParserBuffer(r,t){this.bigEndian=r||0,this.buffer=[],this.setBuffer(t)}for(var chr=String.fromCharCode,maxBits=[],i=0;64>i;i++)maxBits[i]=Math.pow(2,i);BinaryParser.warn=function(r){if(this.allowExceptions)throw new Error(r);return 1},BinaryParser.decodeFloat=function(r,t,e){var n=new this.Buffer(this.bigEndian,r);n.checkBuffer(t+e+1);var o=maxBits[e-1]-1,i=n.readBits(t+e,1),a=n.readBits(t,e),f=0,h=2,c=n.buffer.length+(-t>>3)-1;do for(var s=n.buffer[++c],u=t%8||8,d=1<<u;d>>=1;s&d&&(f+=1/h),h*=2);while(t-=u);return a==(o<<1)+1?f?NaN:i?-(1/0):+(1/0):(1+-2*i)*(a||f?a?Math.pow(2,a-o)*(1+f):Math.pow(2,-o+1)*f:0)},BinaryParser.decodeInt=function(r,t,e,n){var o=new this.Buffer(this.bigEndian||n,r),i=o.readBits(0,t),a=maxBits[t];return e&&i>=a/2?i-a:i},BinaryParser.encodeFloat=function(t,e,n){var o,i,a,f,h,c=maxBits[n-1]-1,s=-c+1,u=c,d=s-e,B=parseFloat(t),l=isNaN(B)||B==-(1/0)||B==+(1/0)?B:0,g=0,y=2*c+1+e+3,C=new Array(y),P=(B=0!==l?0:B)<0,m=Math.floor(B=Math.abs(B)),A=B-m;for(f=y;f;C[--f]=0);for(f=c+2;m&&f;C[--f]=m%2,m=Math.floor(m/2));for(f=c+1;A>0&&f;(C[++f]=((A*=2)>=1)-0)&&--A);for(f=-1;++f<y&&!C[f];);if(C[(o=e-1+(f=(g=c+1-f)>=s&&u>=g?f+1:c+1-(g=s-1)))+1]){if(!(i=C[o]))for(h=o+2;!i&&y>h;i=C[h++]);for(h=o+1;i&&--h>=0;(C[h]=!C[h]-0)&&(i=0));}for(f=0>f-2?-1:f-3;++f<y&&!C[f];);for((g=c+1-f)>=s&&u>=g?++f:s>g&&(g!=c+1-y&&d>g&&this.warn("encodeFloat::float underflow"),f=c+1-(g=s-1)),(m||0!==l)&&(this.warn(m?"encodeFloat::float overflow":"encodeFloat::"+l),g=u+1,f=c+2,l==-(1/0)?P=1:isNaN(l)&&(C[f]=1)),B=Math.abs(g+c),h=n+1,a="";--h;a=B%2+a,B=B>>=1);for(B=0,h=0,f=(a=(P?"1":"0")+a+C.slice(f,f+e).join("")).length,r=[];f;h=(h+1)%8)B+=(1<<h)*a.charAt(--f),7==h&&(r[r.length]=String.fromCharCode(B),B=0);return r[r.length]=B?String.fromCharCode(B):"",(this.bigEndian?r.reverse():r).join("")},BinaryParser.encodeInt=function(r,t,e,n){var o=maxBits[t];(r>=o||-(o/2)>r)&&(this.warn("encodeInt::overflow"),r=0),0>r&&(r+=o);for(var i=[];r;i[i.length]=String.fromCharCode(r%256),r=Math.floor(r/256));for(t=-(-t>>3)-i.length;t--;i[i.length]="\x00");return(this.bigEndian||n?i.reverse():i).join("")},BinaryParser.toSmall=function(r){return this.decodeInt(r,8,!0)},BinaryParser.fromSmall=function(r){return this.encodeInt(r,8,!0)},BinaryParser.toByte=function(r){return this.decodeInt(r,8,!1)},BinaryParser.fromByte=function(r){return this.encodeInt(r,8,!1)},BinaryParser.toShort=function(r){return this.decodeInt(r,16,!0)},BinaryParser.fromShort=function(r){return this.encodeInt(r,16,!0)},BinaryParser.toWord=function(r){return this.decodeInt(r,16,!1)},BinaryParser.fromWord=function(r){return this.encodeInt(r,16,!1)},BinaryParser.toInt=function(r){return this.decodeInt(r,32,!0)},BinaryParser.fromInt=function(r){return this.encodeInt(r,32,!0)},BinaryParser.toLong=function(r){return this.decodeInt(r,64,!0)},BinaryParser.fromLong=function(r){return this.encodeInt(r,64,!0)},BinaryParser.toDWord=function(r){return this.decodeInt(r,32,!1)},BinaryParser.fromDWord=function(r){return this.encodeInt(r,32,!1)},BinaryParser.toQWord=function(r){return this.decodeInt(r,64,!0)},BinaryParser.fromQWord=function(r){return this.encodeInt(r,64,!0)},BinaryParser.toFloat=function(r){return this.decodeFloat(r,23,8)},BinaryParser.fromFloat=function(r){return this.encodeFloat(r,23,8)},BinaryParser.toDouble=function(r){return this.decodeFloat(r,52,11)},BinaryParser.fromDouble=function(r){return this.encodeFloat(r,52,11)},BinaryParser.encode_int32=function(r,t){var e,n,o,i,a;return a=0>r?r+4294967296:r,e=Math.floor(a/16777215),a&=16777215,n=Math.floor(a/65535),a&=65535,o=Math.floor(a/255),a&=255,i=Math.floor(a),t?[chr(e),chr(n),chr(o),chr(i)]:chr(e)+chr(n)+chr(o)+chr(i)},BinaryParser.encode_int64=function(r){var t,e,n,o,i,a,f,h,c;return c=0>r?r+0x10000000000000000:r,t=Math.floor(c/72057594037927940),c&=72057594037927940,e=Math.floor(c/0xffffffffffff),c&=0xffffffffffff,n=Math.floor(c/0xffffffffff),c&=0xffffffffff,o=Math.floor(c/4294967295),c&=4294967295,i=Math.floor(c/16777215),c&=16777215,a=Math.floor(c/65535),c&=65535,f=Math.floor(c/255),c&=255,h=Math.floor(c),chr(t)+chr(e)+chr(n)+chr(o)+chr(i)+chr(a)+chr(f)+chr(h)},BinaryParser.decode_utf8=function(r){for(var t,e=r.length,n="",o=0,i=0,a=0;e>o;)i=r.charCodeAt(o),128>i?(n+=String.fromCharCode(i),o++):i>191&&224>i?(a=r.charCodeAt(o+1),n+=String.fromCharCode((31&i)<<6|63&a),o+=2):(a=r.charCodeAt(o+1),t=r.charCodeAt(o+2),n+=String.fromCharCode((15&i)<<12|(63&a)<<6|63&t),o+=3);return n},BinaryParser.encode_cstring=function(r){return unescape(encodeURIComponent(r))+BinaryParser.fromByte(0)},BinaryParser.encode_utf8=function(r){for(var t,e="",n=0,o=r.length;o>n;n++)t=r.charCodeAt(n),128>t?e+=String.fromCharCode(t):t>127&&2048>t?(e+=String.fromCharCode(t>>6|192),e+=String.fromCharCode(63&t|128)):(e+=String.fromCharCode(t>>12|224),e+=String.fromCharCode(t>>6&63|128),e+=String.fromCharCode(63&t|128));return e},BinaryParser.hprint=function(r){for(var t,e=0,n=r.length;n>e;e++)r.charCodeAt(e)<32?(t=r.charCodeAt(e)<=15?"0"+r.charCodeAt(e).toString(16):r.charCodeAt(e).toString(16),process.stdout.write(t+" ")):(t=r.charCodeAt(e)<=15?"0"+r.charCodeAt(e).toString(16):r.charCodeAt(e).toString(16),process.stdout.write(t+" "));process.stdout.write("\n\n")},BinaryParser.ilprint=function(r){for(var t,e=0,n=r.length;n>e;e++)r.charCodeAt(e)<32?(t=r.charCodeAt(e)<=15?"0"+r.charCodeAt(e).toString(10):r.charCodeAt(e).toString(10),require("util").debug(t+" : ")):(t=r.charCodeAt(e)<=15?"0"+r.charCodeAt(e).toString(10):r.charCodeAt(e).toString(10),require("util").debug(t+" : "+r.charAt(e)))},BinaryParser.hlprint=function(r){for(var t,e=0,n=r.length;n>e;e++)r.charCodeAt(e)<32?(t=r.charCodeAt(e)<=15?"0"+r.charCodeAt(e).toString(16):r.charCodeAt(e).toString(16),require("util").debug(t+" : ")):(t=r.charCodeAt(e)<=15?"0"+r.charCodeAt(e).toString(16):r.charCodeAt(e).toString(16),require("util").debug(t+" : "+r.charAt(e)))},BinaryParserBuffer.prototype.setBuffer=function(r){var t,e,n;if(r){for(e=t=r.length,n=this.buffer=new Array(t);e;n[t-e]=r.charCodeAt(--e));this.bigEndian&&n.reverse()}},BinaryParserBuffer.prototype.hasNeededBits=function(r){return this.buffer.length>=-(-r>>3)},BinaryParserBuffer.prototype.checkBuffer=function(r){if(!this.hasNeededBits(r))throw new Error("checkBuffer::missing bytes")},BinaryParserBuffer.prototype.readBits=function(r,t){function e(r,t){for(;t--;r=1073741824==(1073741824&(r%=2147483648))?2*r:2*(r-1073741824)+2147483647+1);return r}if(0>r||0>=t)return 0;this.checkBuffer(r+t);for(var n,o=r%8,i=this.buffer.length-(r>>3)-1,a=this.buffer.length+(-(r+t)>>3),f=i-a,h=(this.buffer[i]>>o&(1<<(f?8-o:t))-1)+(f&&(n=(r+t)%8)?(this.buffer[a++]&(1<<n)-1)<<(f--<<3)-o:0);f;h+=e(this.buffer[a++],(f--<<3)-o));return h},BinaryParser.Buffer=BinaryParserBuffer,exports.BinaryParser=BinaryParser;