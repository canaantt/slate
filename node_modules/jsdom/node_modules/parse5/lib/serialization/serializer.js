"use strict";function escapeString(e,t){return e=e.replace(AMP_REGEX,"&amp;").replace(NBSP_REGEX,"&nbsp;"),e=t?e.replace(DOUBLE_QUOTE_REGEX,"&quot;"):e.replace(LT_REGEX,"&lt;").replace(GT_REGEX,"&gt;")}var DefaultTreeAdapter=require("../tree_adapters/default"),Doctype=require("../common/doctype"),Utils=require("../common/utils"),HTML=require("../common/html"),$=HTML.TAG_NAMES,NS=HTML.NAMESPACES,DEFAULT_OPTIONS={encodeHtmlEntities:!0},AMP_REGEX=/&/g,NBSP_REGEX=/\u00a0/g,DOUBLE_QUOTE_REGEX=/"/g,LT_REGEX=/</g,GT_REGEX=/>/g,Serializer=module.exports=function(e,t){this.treeAdapter=e||DefaultTreeAdapter,this.options=Utils.mergeOptions(DEFAULT_OPTIONS,t)};Serializer.prototype.serialize=function(e){return this.html="",this._serializeChildNodes(e),this.html},Serializer.prototype._serializeChildNodes=function(e){var t=this.treeAdapter.getChildNodes(e);if(t)for(var i=0,r=t.length;r>i;i++){var s=t[i];this.treeAdapter.isElementNode(s)?this._serializeElement(s):this.treeAdapter.isTextNode(s)?this._serializeTextNode(s):this.treeAdapter.isCommentNode(s)?this._serializeCommentNode(s):this.treeAdapter.isDocumentTypeNode(s)&&this._serializeDocumentTypeNode(s)}},Serializer.prototype._serializeElement=function(e){var t=this.treeAdapter.getTagName(e),i=this.treeAdapter.getNamespaceURI(e);if(this.html+="<"+t,this._serializeAttributes(e),this.html+=">",t!==$.AREA&&t!==$.BASE&&t!==$.BASEFONT&&t!==$.BGSOUND&&t!==$.BR&&t!==$.BR&&t!==$.COL&&t!==$.EMBED&&t!==$.FRAME&&t!==$.HR&&t!==$.IMG&&t!==$.INPUT&&t!==$.KEYGEN&&t!==$.LINK&&t!==$.MENUITEM&&t!==$.META&&t!==$.PARAM&&t!==$.SOURCE&&t!==$.TRACK&&t!==$.WBR){if(t===$.PRE||t===$.TEXTAREA||t===$.LISTING){var r=this.treeAdapter.getFirstChild(e);if(r&&this.treeAdapter.isTextNode(r)){var s=this.treeAdapter.getTextNodeContent(r);"\n"===s[0]&&(this.html+="\n")}}var a=t===$.TEMPLATE&&i===NS.HTML?this.treeAdapter.getChildNodes(e)[0]:e;this._serializeChildNodes(a),this.html+="</"+t+">"}},Serializer.prototype._serializeAttributes=function(e){for(var t=this.treeAdapter.getAttrList(e),i=0,r=t.length;r>i;i++){var s=t[i],a=this.options.encodeHtmlEntities?escapeString(s.value,!0):s.value;this.html+=" ",s.namespace?s.namespace===NS.XML?this.html+="xml:"+s.name:s.namespace===NS.XMLNS?("xmlns"!==s.name&&(this.html+="xmlns:"),this.html+=s.name):s.namespace===NS.XLINK?this.html+="xlink:"+s.name:this.html+=s.namespace+":"+s.name:this.html+=s.name,this.html+='="'+a+'"'}},Serializer.prototype._serializeTextNode=function(e){var t=this.treeAdapter.getTextNodeContent(e),i=this.treeAdapter.getParentNode(e),r=void 0;i&&this.treeAdapter.isElementNode(i)&&(r=this.treeAdapter.getTagName(i)),r===$.STYLE||r===$.SCRIPT||r===$.XMP||r===$.IFRAME||r===$.NOEMBED||r===$.NOFRAMES||r===$.PLAINTEXT||r===$.NOSCRIPT?this.html+=t:this.html+=this.options.encodeHtmlEntities?escapeString(t,!1):t},Serializer.prototype._serializeCommentNode=function(e){this.html+="<!--"+this.treeAdapter.getCommentNodeContent(e)+"-->"},Serializer.prototype._serializeDocumentTypeNode=function(e){var t=this.treeAdapter.getDocumentTypeNodeName(e),i=this.treeAdapter.getDocumentTypeNodePublicId(e),r=this.treeAdapter.getDocumentTypeNodeSystemId(e);this.html+="<"+Doctype.serializeContent(t,i,r)+">"};