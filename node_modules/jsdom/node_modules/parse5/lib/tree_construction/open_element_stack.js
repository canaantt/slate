"use strict";function isImpliedEndTagRequired(t){switch(t.length){case 1:return t===$.P;case 2:return t===$.RP||t===$.RT||t===$.DD||t===$.DT||t===$.LI;case 6:return t===$.OPTION;case 8:return t===$.OPTGROUP}return!1}function isScopingElement(t,e){switch(t.length){case 2:if(t===$.TD||t===$.TH)return e===NS.HTML;if(t===$.MI||t===$.MO||t==$.MN||t===$.MS)return e===NS.MATHML;break;case 4:if(t===$.HTML)return e===NS.HTML;if(t===$.DESC)return e===NS.SVG;break;case 5:if(t===$.TABLE)return e===NS.HTML;if(t===$.MTEXT)return e===NS.MATHML;if(t===$.TITLE)return e===NS.SVG;break;case 6:return(t===$.APPLET||t===$.OBJECT)&&e===NS.HTML;case 7:return(t===$.CAPTION||t===$.MARQUEE)&&e===NS.HTML;case 8:return t===$.TEMPLATE&&e===NS.HTML;case 13:return t===$.FOREIGN_OBJECT&&e===NS.SVG;case 14:return t===$.ANNOTATION_XML&&e===NS.MATHML}return!1}var HTML=require("../common/html"),$=HTML.TAG_NAMES,NS=HTML.NAMESPACES,OpenElementStack=module.exports=function(t,e){this.stackTop=-1,this.items=[],this.current=t,this.currentTagName=null,this.currentTmplContent=null,this.tmplCount=0,this.treeAdapter=e};OpenElementStack.prototype._indexOf=function(t){for(var e=-1,r=this.stackTop;r>=0;r--)if(this.items[r]===t){e=r;break}return e},OpenElementStack.prototype._isInTemplate=function(){return this.currentTagName!==$.TEMPLATE?!1:this.treeAdapter.getNamespaceURI(this.current)===NS.HTML},OpenElementStack.prototype._updateCurrentElement=function(){this.current=this.items[this.stackTop],this.currentTagName=this.current&&this.treeAdapter.getTagName(this.current),this.currentTmplContent=this._isInTemplate()?this.treeAdapter.getChildNodes(this.current)[0]:null},OpenElementStack.prototype.push=function(t){this.items[++this.stackTop]=t,this._updateCurrentElement(),this._isInTemplate()&&this.tmplCount++},OpenElementStack.prototype.pop=function(){this.stackTop--,this.tmplCount>0&&this._isInTemplate()&&this.tmplCount--,this._updateCurrentElement()},OpenElementStack.prototype.replace=function(t,e){var r=this._indexOf(t);this.items[r]=e,r===this.stackTop&&this._updateCurrentElement()},OpenElementStack.prototype.insertAfter=function(t,e){var r=this._indexOf(t)+1;this.items.splice(r,0,e),r==++this.stackTop&&this._updateCurrentElement()},OpenElementStack.prototype.popUntilTagNamePopped=function(t){for(;this.stackTop>-1;){var e=this.currentTagName;if(this.pop(),e===t)break}},OpenElementStack.prototype.popUntilTemplatePopped=function(){for(;this.stackTop>-1;){var t=this.currentTagName,e=this.treeAdapter.getNamespaceURI(this.current);if(this.pop(),t===$.TEMPLATE&&e===NS.HTML)break}},OpenElementStack.prototype.popUntilElementPopped=function(t){for(;this.stackTop>-1;){var e=this.current;if(this.pop(),e===t)break}},OpenElementStack.prototype.popUntilNumberedHeaderPopped=function(){for(;this.stackTop>-1;){var t=this.currentTagName;if(this.pop(),t===$.H1||t===$.H2||t===$.H3||t===$.H4||t===$.H5||t===$.H6)break}},OpenElementStack.prototype.popAllUpToHtmlElement=function(){this.stackTop=0,this._updateCurrentElement()},OpenElementStack.prototype.clearBackToTableContext=function(){for(;this.currentTagName!==$.TABLE&&this.currentTagName!==$.TEMPLATE&&this.currentTagName!==$.HTML;)this.pop()},OpenElementStack.prototype.clearBackToTableBodyContext=function(){for(;this.currentTagName!==$.TBODY&&this.currentTagName!==$.TFOOT&&this.currentTagName!==$.THEAD&&this.currentTagName!==$.TEMPLATE&&this.currentTagName!==$.HTML;)this.pop()},OpenElementStack.prototype.clearBackToTableRowContext=function(){for(;this.currentTagName!==$.TR&&this.currentTagName!==$.TEMPLATE&&this.currentTagName!==$.HTML;)this.pop()},OpenElementStack.prototype.remove=function(t){for(var e=this.stackTop;e>=0;e--)if(this.items[e]===t){this.items.splice(e,1),this.stackTop--,this._updateCurrentElement();break}},OpenElementStack.prototype.tryPeekProperlyNestedBodyElement=function(){var t=this.items[1];return t&&this.treeAdapter.getTagName(t)===$.BODY?t:null},OpenElementStack.prototype.contains=function(t){return this._indexOf(t)>-1},OpenElementStack.prototype.getCommonAncestor=function(t){var e=this._indexOf(t);return--e>=0?this.items[e]:null},OpenElementStack.prototype.isRootHtmlElementCurrent=function(){return 0===this.stackTop&&this.currentTagName===$.HTML},OpenElementStack.prototype.hasInScope=function(t){for(var e=this.stackTop;e>=0;e--){var r=this.treeAdapter.getTagName(this.items[e]);if(r===t)return!0;var n=this.treeAdapter.getNamespaceURI(this.items[e]);if(isScopingElement(r,n))return!1}return!0},OpenElementStack.prototype.hasNumberedHeaderInScope=function(){for(var t=this.stackTop;t>=0;t--){var e=this.treeAdapter.getTagName(this.items[t]);if(e===$.H1||e===$.H2||e===$.H3||e===$.H4||e===$.H5||e===$.H6)return!0;if(isScopingElement(e,this.treeAdapter.getNamespaceURI(this.items[t])))return!1}return!0},OpenElementStack.prototype.hasInListItemScope=function(t){for(var e=this.stackTop;e>=0;e--){var r=this.treeAdapter.getTagName(this.items[e]);if(r===t)return!0;var n=this.treeAdapter.getNamespaceURI(this.items[e]);if((r===$.UL||r===$.OL)&&n===NS.HTML||isScopingElement(r,n))return!1}return!0},OpenElementStack.prototype.hasInButtonScope=function(t){for(var e=this.stackTop;e>=0;e--){var r=this.treeAdapter.getTagName(this.items[e]);if(r===t)return!0;var n=this.treeAdapter.getNamespaceURI(this.items[e]);if(r===$.BUTTON&&n===NS.HTML||isScopingElement(r,n))return!1}return!0},OpenElementStack.prototype.hasInTableScope=function(t){for(var e=this.stackTop;e>=0;e--){var r=this.treeAdapter.getTagName(this.items[e]);if(r===t)return!0;var n=this.treeAdapter.getNamespaceURI(this.items[e]);if((r===$.TABLE||r===$.TEMPLATE||r===$.HTML)&&n===NS.HTML)return!1}return!0},OpenElementStack.prototype.hasTableBodyContextInTableScope=function(){for(var t=this.stackTop;t>=0;t--){var e=this.treeAdapter.getTagName(this.items[t]);if(e===$.TBODY||e===$.THEAD||e===$.TFOOT)return!0;var r=this.treeAdapter.getNamespaceURI(this.items[t]);if((e===$.TABLE||e===$.HTML)&&r===NS.HTML)return!1}return!0},OpenElementStack.prototype.hasInSelectScope=function(t){for(var e=this.stackTop;e>=0;e--){var r=this.treeAdapter.getTagName(this.items[e]);if(r===t)return!0;var n=this.treeAdapter.getNamespaceURI(this.items[e]);if(r!==$.OPTION&&r!==$.OPTGROUP&&n===NS.HTML)return!1}return!0},OpenElementStack.prototype.generateImpliedEndTags=function(){for(;isImpliedEndTagRequired(this.currentTagName);)this.pop()},OpenElementStack.prototype.generateImpliedEndTagsWithExclusion=function(t){for(;isImpliedEndTagRequired(this.currentTagName)&&this.currentTagName!==t;)this.pop()};