"use strict";function isWhitespace(T){return T===$.SPACE||T===$.LINE_FEED||T===$.TABULATION||T===$.FORM_FEED}function isAsciiDigit(T){return T>=$.DIGIT_0&&T<=$.DIGIT_9}function isAsciiUpper(T){return T>=$.LATIN_CAPITAL_A&&T<=$.LATIN_CAPITAL_Z}function isAsciiLower(T){return T>=$.LATIN_SMALL_A&&T<=$.LATIN_SMALL_Z}function isAsciiAlphaNumeric(T){return isAsciiDigit(T)||isAsciiUpper(T)||isAsciiLower(T)}function isDigit(T,t){return isAsciiDigit(T)||t&&(T>=$.LATIN_CAPITAL_A&&T<=$.LATIN_CAPITAL_F||T>=$.LATIN_SMALL_A&&T<=$.LATIN_SMALL_F)}function isReservedCodePoint(T){return T>=55296&&57343>=T||T>1114111}function toAsciiLowerCodePoint(T){return T+32}function toChar(T){return 65535>=T?String.fromCharCode(T):(T-=65536,String.fromCharCode(T>>>10&1023|55296)+String.fromCharCode(56320|1023&T))}function toAsciiLowerChar(T){return String.fromCharCode(toAsciiLowerCodePoint(T))}var Preprocessor=require("./preprocessor"),LocationInfoMixin=require("./location_info_mixin"),UNICODE=require("../common/unicode"),NAMED_ENTITY_TRIE=require("./named_entity_trie"),$=UNICODE.CODE_POINTS,$$=UNICODE.CODE_POINT_SEQUENCES,NUMERIC_ENTITY_REPLACEMENTS={0:65533,13:13,128:8364,129:129,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,141:141,142:381,143:143,144:144,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,157:157,158:382,159:376},DATA_STATE="DATA_STATE",CHARACTER_REFERENCE_IN_DATA_STATE="CHARACTER_REFERENCE_IN_DATA_STATE",RCDATA_STATE="RCDATA_STATE",CHARACTER_REFERENCE_IN_RCDATA_STATE="CHARACTER_REFERENCE_IN_RCDATA_STATE",RAWTEXT_STATE="RAWTEXT_STATE",SCRIPT_DATA_STATE="SCRIPT_DATA_STATE",PLAINTEXT_STATE="PLAINTEXT_STATE",TAG_OPEN_STATE="TAG_OPEN_STATE",END_TAG_OPEN_STATE="END_TAG_OPEN_STATE",TAG_NAME_STATE="TAG_NAME_STATE",RCDATA_LESS_THAN_SIGN_STATE="RCDATA_LESS_THAN_SIGN_STATE",RCDATA_END_TAG_OPEN_STATE="RCDATA_END_TAG_OPEN_STATE",RCDATA_END_TAG_NAME_STATE="RCDATA_END_TAG_NAME_STATE",RAWTEXT_LESS_THAN_SIGN_STATE="RAWTEXT_LESS_THAN_SIGN_STATE",RAWTEXT_END_TAG_OPEN_STATE="RAWTEXT_END_TAG_OPEN_STATE",RAWTEXT_END_TAG_NAME_STATE="RAWTEXT_END_TAG_NAME_STATE",SCRIPT_DATA_LESS_THAN_SIGN_STATE="SCRIPT_DATA_LESS_THAN_SIGN_STATE",SCRIPT_DATA_END_TAG_OPEN_STATE="SCRIPT_DATA_END_TAG_OPEN_STATE",SCRIPT_DATA_END_TAG_NAME_STATE="SCRIPT_DATA_END_TAG_NAME_STATE",SCRIPT_DATA_ESCAPE_START_STATE="SCRIPT_DATA_ESCAPE_START_STATE",SCRIPT_DATA_ESCAPE_START_DASH_STATE="SCRIPT_DATA_ESCAPE_START_DASH_STATE",SCRIPT_DATA_ESCAPED_STATE="SCRIPT_DATA_ESCAPED_STATE",SCRIPT_DATA_ESCAPED_DASH_STATE="SCRIPT_DATA_ESCAPED_DASH_STATE",SCRIPT_DATA_ESCAPED_DASH_DASH_STATE="SCRIPT_DATA_ESCAPED_DASH_DASH_STATE",SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN_STATE="SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN_STATE",SCRIPT_DATA_ESCAPED_END_TAG_OPEN_STATE="SCRIPT_DATA_ESCAPED_END_TAG_OPEN_STATE",SCRIPT_DATA_ESCAPED_END_TAG_NAME_STATE="SCRIPT_DATA_ESCAPED_END_TAG_NAME_STATE",SCRIPT_DATA_DOUBLE_ESCAPE_START_STATE="SCRIPT_DATA_DOUBLE_ESCAPE_START_STATE",SCRIPT_DATA_DOUBLE_ESCAPED_STATE="SCRIPT_DATA_DOUBLE_ESCAPED_STATE",SCRIPT_DATA_DOUBLE_ESCAPED_DASH_STATE="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_STATE",SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH_STATE="SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH_STATE",SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN_STATE="SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN_STATE",SCRIPT_DATA_DOUBLE_ESCAPE_END_STATE="SCRIPT_DATA_DOUBLE_ESCAPE_END_STATE",BEFORE_ATTRIBUTE_NAME_STATE="BEFORE_ATTRIBUTE_NAME_STATE",ATTRIBUTE_NAME_STATE="ATTRIBUTE_NAME_STATE",AFTER_ATTRIBUTE_NAME_STATE="AFTER_ATTRIBUTE_NAME_STATE",BEFORE_ATTRIBUTE_VALUE_STATE="BEFORE_ATTRIBUTE_VALUE_STATE",ATTRIBUTE_VALUE_DOUBLE_QUOTED_STATE="ATTRIBUTE_VALUE_DOUBLE_QUOTED_STATE",ATTRIBUTE_VALUE_SINGLE_QUOTED_STATE="ATTRIBUTE_VALUE_SINGLE_QUOTED_STATE",ATTRIBUTE_VALUE_UNQUOTED_STATE="ATTRIBUTE_VALUE_UNQUOTED_STATE",CHARACTER_REFERENCE_IN_ATTRIBUTE_VALUE_STATE="CHARACTER_REFERENCE_IN_ATTRIBUTE_VALUE_STATE",AFTER_ATTRIBUTE_VALUE_QUOTED_STATE="AFTER_ATTRIBUTE_VALUE_QUOTED_STATE",SELF_CLOSING_START_TAG_STATE="SELF_CLOSING_START_TAG_STATE",BOGUS_COMMENT_STATE="BOGUS_COMMENT_STATE",MARKUP_DECLARATION_OPEN_STATE="MARKUP_DECLARATION_OPEN_STATE",COMMENT_START_STATE="COMMENT_START_STATE",COMMENT_START_DASH_STATE="COMMENT_START_DASH_STATE",COMMENT_STATE="COMMENT_STATE",COMMENT_END_DASH_STATE="COMMENT_END_DASH_STATE",COMMENT_END_STATE="COMMENT_END_STATE",COMMENT_END_BANG_STATE="COMMENT_END_BANG_STATE",DOCTYPE_STATE="DOCTYPE_STATE",BEFORE_DOCTYPE_NAME_STATE="BEFORE_DOCTYPE_NAME_STATE",DOCTYPE_NAME_STATE="DOCTYPE_NAME_STATE",AFTER_DOCTYPE_NAME_STATE="AFTER_DOCTYPE_NAME_STATE",AFTER_DOCTYPE_PUBLIC_KEYWORD_STATE="AFTER_DOCTYPE_PUBLIC_KEYWORD_STATE",BEFORE_DOCTYPE_PUBLIC_IDENTIFIER_STATE="BEFORE_DOCTYPE_PUBLIC_IDENTIFIER_STATE",DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED_STATE="DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED_STATE",DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED_STATE="DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED_STATE",AFTER_DOCTYPE_PUBLIC_IDENTIFIER_STATE="AFTER_DOCTYPE_PUBLIC_IDENTIFIER_STATE",BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS_STATE="BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS_STATE",AFTER_DOCTYPE_SYSTEM_KEYWORD_STATE="AFTER_DOCTYPE_SYSTEM_KEYWORD_STATE",BEFORE_DOCTYPE_SYSTEM_IDENTIFIER_STATE="BEFORE_DOCTYPE_SYSTEM_IDENTIFIER_STATE",DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED_STATE="DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED_STATE",DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED_STATE="DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED_STATE",AFTER_DOCTYPE_SYSTEM_IDENTIFIER_STATE="AFTER_DOCTYPE_SYSTEM_IDENTIFIER_STATE",BOGUS_DOCTYPE_STATE="BOGUS_DOCTYPE_STATE",CDATA_SECTION_STATE="CDATA_SECTION_STATE",Tokenizer=module.exports=function(T,t){this.disableEntitiesDecoding=!1,this.preprocessor=new Preprocessor(T),this.tokenQueue=[],this.allowCDATA=!1,this.state=DATA_STATE,this.returnState="",this.consumptionPos=0,this.tempBuff=[],this.additionalAllowedCp=void 0,this.lastStartTagName="",this.currentCharacterToken=null,this.currentToken=null,this.currentAttr=null,t&&(this.disableEntitiesDecoding=!t.decodeHtmlEntities,t.locationInfo&&LocationInfoMixin.assign(this))};Tokenizer.CHARACTER_TOKEN="CHARACTER_TOKEN",Tokenizer.NULL_CHARACTER_TOKEN="NULL_CHARACTER_TOKEN",Tokenizer.WHITESPACE_CHARACTER_TOKEN="WHITESPACE_CHARACTER_TOKEN",Tokenizer.START_TAG_TOKEN="START_TAG_TOKEN",Tokenizer.END_TAG_TOKEN="END_TAG_TOKEN",Tokenizer.COMMENT_TOKEN="COMMENT_TOKEN",Tokenizer.DOCTYPE_TOKEN="DOCTYPE_TOKEN",Tokenizer.EOF_TOKEN="EOF_TOKEN",Tokenizer.MODE=Tokenizer.prototype.MODE={DATA:DATA_STATE,RCDATA:RCDATA_STATE,RAWTEXT:RAWTEXT_STATE,SCRIPT_DATA:SCRIPT_DATA_STATE,PLAINTEXT:PLAINTEXT_STATE},Tokenizer.getTokenAttr=function(T,t){for(var _=T.attrs.length-1;_>=0;_--)if(T.attrs[_].name===t)return T.attrs[_].value;return null},Tokenizer.prototype.getNextToken=function(){for(;!this.tokenQueue.length;)this[this.state](this._consume());return this.tokenQueue.shift()},Tokenizer.prototype._consume=function(){return this.consumptionPos++,this.preprocessor.advanceAndPeekCodePoint()},Tokenizer.prototype._unconsume=function(){this.consumptionPos--,this.preprocessor.retreat()},Tokenizer.prototype._unconsumeSeveral=function(T){for(;T--;)this._unconsume()},Tokenizer.prototype._reconsumeInState=function(T){this.state=T,this._unconsume()},Tokenizer.prototype._consumeSubsequentIfMatch=function(T,t,_){for(var E=this.consumptionPos,A=!0,e=T.length,i=0,s=t,S=void 0;e>i;i++){if(i>0&&(s=this._consume()),s===$.EOF){A=!1;break}if(S=T[i],s!==S&&(_||s!==toAsciiLowerCodePoint(S))){A=!1;break}}return A||this._unconsumeSeveral(this.consumptionPos-E),A},Tokenizer.prototype._lookahead=function(){var T=this.preprocessor.advanceAndPeekCodePoint();return this.preprocessor.retreat(),T},Tokenizer.prototype.isTempBufferEqualToScriptString=function(){if(this.tempBuff.length!==$$.SCRIPT_STRING.length)return!1;for(var T=0;T<this.tempBuff.length;T++)if(this.tempBuff[T]!==$$.SCRIPT_STRING[T])return!1;return!0},Tokenizer.prototype.buildStartTagToken=function(T){return{type:Tokenizer.START_TAG_TOKEN,tagName:T,selfClosing:!1,attrs:[]}},Tokenizer.prototype.buildEndTagToken=function(T){return{type:Tokenizer.END_TAG_TOKEN,tagName:T,ignored:!1,attrs:[]}},Tokenizer.prototype._createStartTagToken=function(T){this.currentToken=this.buildStartTagToken(T)},Tokenizer.prototype._createEndTagToken=function(T){this.currentToken=this.buildEndTagToken(T)},Tokenizer.prototype._createCommentToken=function(){this.currentToken={type:Tokenizer.COMMENT_TOKEN,data:""}},Tokenizer.prototype._createDoctypeToken=function(T){this.currentToken={type:Tokenizer.DOCTYPE_TOKEN,name:T||"",forceQuirks:!1,publicId:null,systemId:null}},Tokenizer.prototype._createCharacterToken=function(T,t){this.currentCharacterToken={type:T,chars:t}},Tokenizer.prototype._createAttr=function(T){this.currentAttr={name:T,value:""}},Tokenizer.prototype._isDuplicateAttr=function(){return null!==Tokenizer.getTokenAttr(this.currentToken,this.currentAttr.name)},Tokenizer.prototype._leaveAttrName=function(T){this.state=T,this._isDuplicateAttr()||this.currentToken.attrs.push(this.currentAttr)},Tokenizer.prototype._isAppropriateEndTagToken=function(){return this.lastStartTagName===this.currentToken.tagName},Tokenizer.prototype._emitCurrentToken=function(){this._emitCurrentCharacterToken(),this.currentToken.type===Tokenizer.START_TAG_TOKEN&&(this.lastStartTagName=this.currentToken.tagName),this.tokenQueue.push(this.currentToken),this.currentToken=null},Tokenizer.prototype._emitCurrentCharacterToken=function(){this.currentCharacterToken&&(this.tokenQueue.push(this.currentCharacterToken),this.currentCharacterToken=null)},Tokenizer.prototype._emitEOFToken=function(){this._emitCurrentCharacterToken(),this.tokenQueue.push({type:Tokenizer.EOF_TOKEN})},Tokenizer.prototype._appendCharToCurrentCharacterToken=function(T,t){this.currentCharacterToken&&this.currentCharacterToken.type!==T&&this._emitCurrentCharacterToken(),this.currentCharacterToken?this.currentCharacterToken.chars+=t:this._createCharacterToken(T,t)},Tokenizer.prototype._emitCodePoint=function(T){var t=Tokenizer.CHARACTER_TOKEN;isWhitespace(T)?t=Tokenizer.WHITESPACE_CHARACTER_TOKEN:T===$.NULL&&(t=Tokenizer.NULL_CHARACTER_TOKEN),this._appendCharToCurrentCharacterToken(t,toChar(T))},Tokenizer.prototype._emitSeveralCodePoints=function(T){for(var t=0;t<T.length;t++)this._emitCodePoint(T[t])},Tokenizer.prototype._emitChar=function(T){this._appendCharToCurrentCharacterToken(Tokenizer.CHARACTER_TOKEN,T)},Tokenizer.prototype._consumeNumericEntity=function(T){var t="",_=void 0;do t+=toChar(this._consume()),_=this._lookahead();while(_!==$.EOF&&isDigit(_,T));this._lookahead()===$.SEMICOLON&&this._consume();var E=parseInt(t,T?16:10),A=NUMERIC_ENTITY_REPLACEMENTS[E];return A?A:isReservedCodePoint(E)?$.REPLACEMENT_CHARACTER:E},Tokenizer.prototype._consumeNamedEntity=function(T,t){for(var _=null,E=0,A=T,e=NAMED_ENTITY_TRIE[A],i=1,s=!1;e&&A!==$.EOF;A=this._consume(),i++,e=e.l&&e.l[A])if(e.c&&(_=e.c,E=i,A===$.SEMICOLON)){s=!0;break}if(_){if(!s&&(this._unconsumeSeveral(i-E),t)){var S=this._lookahead();if(S===$.EQUALS_SIGN||isAsciiAlphaNumeric(S))return this._unconsumeSeveral(E),null}return _}return this._unconsumeSeveral(i),null},Tokenizer.prototype._consumeCharacterReference=function(T,t){if(this.disableEntitiesDecoding||isWhitespace(T)||T===$.GREATER_THAN_SIGN||T===$.AMPERSAND||T===this.additionalAllowedCp||T===$.EOF)return this._unconsume(),null;if(T===$.NUMBER_SIGN){var _=!1,E=this._lookahead();return(E===$.LATIN_SMALL_X||E===$.LATIN_CAPITAL_X)&&(this._consume(),_=!0),E=this._lookahead(),E!==$.EOF&&isDigit(E,_)?[this._consumeNumericEntity(_)]:(this._unconsumeSeveral(_?2:1),null)}return this._consumeNamedEntity(T,t)};var _=Tokenizer.prototype;_[DATA_STATE]=function(T){T===$.AMPERSAND?this.state=CHARACTER_REFERENCE_IN_DATA_STATE:T===$.LESS_THAN_SIGN?this.state=TAG_OPEN_STATE:T===$.NULL?this._emitCodePoint(T):T===$.EOF?this._emitEOFToken():this._emitCodePoint(T)},_[CHARACTER_REFERENCE_IN_DATA_STATE]=function(T){this.state=DATA_STATE,this.additionalAllowedCp=void 0;var t=this._consumeCharacterReference(T,!1);t?this._emitSeveralCodePoints(t):this._emitChar("&")},_[RCDATA_STATE]=function(T){T===$.AMPERSAND?this.state=CHARACTER_REFERENCE_IN_RCDATA_STATE:T===$.LESS_THAN_SIGN?this.state=RCDATA_LESS_THAN_SIGN_STATE:T===$.NULL?this._emitChar(UNICODE.REPLACEMENT_CHARACTER):T===$.EOF?this._emitEOFToken():this._emitCodePoint(T)},_[CHARACTER_REFERENCE_IN_RCDATA_STATE]=function(T){this.state=RCDATA_STATE,this.additionalAllowedCp=void 0;var t=this._consumeCharacterReference(T,!1);t?this._emitSeveralCodePoints(t):this._emitChar("&")},_[RAWTEXT_STATE]=function(T){T===$.LESS_THAN_SIGN?this.state=RAWTEXT_LESS_THAN_SIGN_STATE:T===$.NULL?this._emitChar(UNICODE.REPLACEMENT_CHARACTER):T===$.EOF?this._emitEOFToken():this._emitCodePoint(T)},_[SCRIPT_DATA_STATE]=function(T){T===$.LESS_THAN_SIGN?this.state=SCRIPT_DATA_LESS_THAN_SIGN_STATE:T===$.NULL?this._emitChar(UNICODE.REPLACEMENT_CHARACTER):T===$.EOF?this._emitEOFToken():this._emitCodePoint(T)},_[PLAINTEXT_STATE]=function(T){T===$.NULL?this._emitChar(UNICODE.REPLACEMENT_CHARACTER):T===$.EOF?this._emitEOFToken():this._emitCodePoint(T)},_[TAG_OPEN_STATE]=function(T){T===$.EXCLAMATION_MARK?this.state=MARKUP_DECLARATION_OPEN_STATE:T===$.SOLIDUS?this.state=END_TAG_OPEN_STATE:isAsciiUpper(T)?(this._createStartTagToken(toAsciiLowerChar(T)),this.state=TAG_NAME_STATE):isAsciiLower(T)?(this._createStartTagToken(toChar(T)),this.state=TAG_NAME_STATE):T===$.QUESTION_MARK?this[BOGUS_COMMENT_STATE](T):(this._emitChar("<"),this._reconsumeInState(DATA_STATE))},_[END_TAG_OPEN_STATE]=function(T){isAsciiUpper(T)?(this._createEndTagToken(toAsciiLowerChar(T)),this.state=TAG_NAME_STATE):isAsciiLower(T)?(this._createEndTagToken(toChar(T)),this.state=TAG_NAME_STATE):T===$.GREATER_THAN_SIGN?this.state=DATA_STATE:T===$.EOF?(this._reconsumeInState(DATA_STATE),this._emitChar("<"),this._emitChar("/")):this[BOGUS_COMMENT_STATE](T)},_[TAG_NAME_STATE]=function(T){isWhitespace(T)?this.state=BEFORE_ATTRIBUTE_NAME_STATE:T===$.SOLIDUS?this.state=SELF_CLOSING_START_TAG_STATE:T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):isAsciiUpper(T)?this.currentToken.tagName+=toAsciiLowerChar(T):T===$.NULL?this.currentToken.tagName+=UNICODE.REPLACEMENT_CHARACTER:T===$.EOF?this._reconsumeInState(DATA_STATE):this.currentToken.tagName+=toChar(T)},_[RCDATA_LESS_THAN_SIGN_STATE]=function(T){T===$.SOLIDUS?(this.tempBuff=[],this.state=RCDATA_END_TAG_OPEN_STATE):(this._emitChar("<"),this._reconsumeInState(RCDATA_STATE))},_[RCDATA_END_TAG_OPEN_STATE]=function(T){isAsciiUpper(T)?(this._createEndTagToken(toAsciiLowerChar(T)),this.tempBuff.push(T),this.state=RCDATA_END_TAG_NAME_STATE):isAsciiLower(T)?(this._createEndTagToken(toChar(T)),this.tempBuff.push(T),this.state=RCDATA_END_TAG_NAME_STATE):(this._emitChar("<"),this._emitChar("/"),this._reconsumeInState(RCDATA_STATE))},_[RCDATA_END_TAG_NAME_STATE]=function(T){if(isAsciiUpper(T))this.currentToken.tagName+=toAsciiLowerChar(T),this.tempBuff.push(T);else if(isAsciiLower(T))this.currentToken.tagName+=toChar(T),this.tempBuff.push(T);else{if(this._isAppropriateEndTagToken()){if(isWhitespace(T))return void(this.state=BEFORE_ATTRIBUTE_NAME_STATE);if(T===$.SOLIDUS)return void(this.state=SELF_CLOSING_START_TAG_STATE);if(T===$.GREATER_THAN_SIGN)return this.state=DATA_STATE,void this._emitCurrentToken()}this._emitChar("<"),this._emitChar("/"),this._emitSeveralCodePoints(this.tempBuff),this._reconsumeInState(RCDATA_STATE)}},_[RAWTEXT_LESS_THAN_SIGN_STATE]=function(T){T===$.SOLIDUS?(this.tempBuff=[],this.state=RAWTEXT_END_TAG_OPEN_STATE):(this._emitChar("<"),this._reconsumeInState(RAWTEXT_STATE))},_[RAWTEXT_END_TAG_OPEN_STATE]=function(T){isAsciiUpper(T)?(this._createEndTagToken(toAsciiLowerChar(T)),this.tempBuff.push(T),this.state=RAWTEXT_END_TAG_NAME_STATE):isAsciiLower(T)?(this._createEndTagToken(toChar(T)),this.tempBuff.push(T),this.state=RAWTEXT_END_TAG_NAME_STATE):(this._emitChar("<"),this._emitChar("/"),this._reconsumeInState(RAWTEXT_STATE))},_[RAWTEXT_END_TAG_NAME_STATE]=function(T){if(isAsciiUpper(T))this.currentToken.tagName+=toAsciiLowerChar(T),this.tempBuff.push(T);else if(isAsciiLower(T))this.currentToken.tagName+=toChar(T),this.tempBuff.push(T);else{if(this._isAppropriateEndTagToken()){if(isWhitespace(T))return void(this.state=BEFORE_ATTRIBUTE_NAME_STATE);if(T===$.SOLIDUS)return void(this.state=SELF_CLOSING_START_TAG_STATE);if(T===$.GREATER_THAN_SIGN)return this._emitCurrentToken(),void(this.state=DATA_STATE)}this._emitChar("<"),this._emitChar("/"),this._emitSeveralCodePoints(this.tempBuff),this._reconsumeInState(RAWTEXT_STATE)}},_[SCRIPT_DATA_LESS_THAN_SIGN_STATE]=function(T){T===$.SOLIDUS?(this.tempBuff=[],this.state=SCRIPT_DATA_END_TAG_OPEN_STATE):T===$.EXCLAMATION_MARK?(this.state=SCRIPT_DATA_ESCAPE_START_STATE,this._emitChar("<"),this._emitChar("!")):(this._emitChar("<"),this._reconsumeInState(SCRIPT_DATA_STATE))},_[SCRIPT_DATA_END_TAG_OPEN_STATE]=function(T){isAsciiUpper(T)?(this._createEndTagToken(toAsciiLowerChar(T)),this.tempBuff.push(T),this.state=SCRIPT_DATA_END_TAG_NAME_STATE):isAsciiLower(T)?(this._createEndTagToken(toChar(T)),this.tempBuff.push(T),this.state=SCRIPT_DATA_END_TAG_NAME_STATE):(this._emitChar("<"),this._emitChar("/"),this._reconsumeInState(SCRIPT_DATA_STATE))},_[SCRIPT_DATA_END_TAG_NAME_STATE]=function(T){if(isAsciiUpper(T))this.currentToken.tagName+=toAsciiLowerChar(T),this.tempBuff.push(T);else if(isAsciiLower(T))this.currentToken.tagName+=toChar(T),this.tempBuff.push(T);else{if(this._isAppropriateEndTagToken()){if(isWhitespace(T))return void(this.state=BEFORE_ATTRIBUTE_NAME_STATE);if(T===$.SOLIDUS)return void(this.state=SELF_CLOSING_START_TAG_STATE);if(T===$.GREATER_THAN_SIGN)return this._emitCurrentToken(),void(this.state=DATA_STATE)}this._emitChar("<"),this._emitChar("/"),this._emitSeveralCodePoints(this.tempBuff),this._reconsumeInState(SCRIPT_DATA_STATE)}},_[SCRIPT_DATA_ESCAPE_START_STATE]=function(T){T===$.HYPHEN_MINUS?(this.state=SCRIPT_DATA_ESCAPE_START_DASH_STATE,this._emitChar("-")):this._reconsumeInState(SCRIPT_DATA_STATE)},_[SCRIPT_DATA_ESCAPE_START_DASH_STATE]=function(T){T===$.HYPHEN_MINUS?(this.state=SCRIPT_DATA_ESCAPED_DASH_DASH_STATE,this._emitChar("-")):this._reconsumeInState(SCRIPT_DATA_STATE)},_[SCRIPT_DATA_ESCAPED_STATE]=function(T){T===$.HYPHEN_MINUS?(this.state=SCRIPT_DATA_ESCAPED_DASH_STATE,this._emitChar("-")):T===$.LESS_THAN_SIGN?this.state=SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN_STATE:T===$.NULL?this._emitChar(UNICODE.REPLACEMENT_CHARACTER):T===$.EOF?this._reconsumeInState(DATA_STATE):this._emitCodePoint(T)},_[SCRIPT_DATA_ESCAPED_DASH_STATE]=function(T){T===$.HYPHEN_MINUS?(this.state=SCRIPT_DATA_ESCAPED_DASH_DASH_STATE,this._emitChar("-")):T===$.LESS_THAN_SIGN?this.state=SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN_STATE:T===$.NULL?(this.state=SCRIPT_DATA_ESCAPED_STATE,this._emitChar(UNICODE.REPLACEMENT_CHARACTER)):T===$.EOF?this._reconsumeInState(DATA_STATE):(this.state=SCRIPT_DATA_ESCAPED_STATE,this._emitCodePoint(T))},_[SCRIPT_DATA_ESCAPED_DASH_DASH_STATE]=function(T){T===$.HYPHEN_MINUS?this._emitChar("-"):T===$.LESS_THAN_SIGN?this.state=SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN_STATE:T===$.GREATER_THAN_SIGN?(this.state=SCRIPT_DATA_STATE,this._emitChar(">")):T===$.NULL?(this.state=SCRIPT_DATA_ESCAPED_STATE,this._emitChar(UNICODE.REPLACEMENT_CHARACTER)):T===$.EOF?this._reconsumeInState(DATA_STATE):(this.state=SCRIPT_DATA_ESCAPED_STATE,this._emitCodePoint(T))},_[SCRIPT_DATA_ESCAPED_LESS_THAN_SIGN_STATE]=function(T){T===$.SOLIDUS?(this.tempBuff=[],this.state=SCRIPT_DATA_ESCAPED_END_TAG_OPEN_STATE):isAsciiUpper(T)?(this.tempBuff=[],this.tempBuff.push(toAsciiLowerCodePoint(T)),this.state=SCRIPT_DATA_DOUBLE_ESCAPE_START_STATE,this._emitChar("<"),this._emitCodePoint(T)):isAsciiLower(T)?(this.tempBuff=[],this.tempBuff.push(T),this.state=SCRIPT_DATA_DOUBLE_ESCAPE_START_STATE,this._emitChar("<"),this._emitCodePoint(T)):(this._emitChar("<"),this._reconsumeInState(SCRIPT_DATA_ESCAPED_STATE))},_[SCRIPT_DATA_ESCAPED_END_TAG_OPEN_STATE]=function(T){isAsciiUpper(T)?(this._createEndTagToken(toAsciiLowerChar(T)),this.tempBuff.push(T),this.state=SCRIPT_DATA_ESCAPED_END_TAG_NAME_STATE):isAsciiLower(T)?(this._createEndTagToken(toChar(T)),this.tempBuff.push(T),this.state=SCRIPT_DATA_ESCAPED_END_TAG_NAME_STATE):(this._emitChar("<"),this._emitChar("/"),this._reconsumeInState(SCRIPT_DATA_ESCAPED_STATE))},_[SCRIPT_DATA_ESCAPED_END_TAG_NAME_STATE]=function(T){if(isAsciiUpper(T))this.currentToken.tagName+=toAsciiLowerChar(T),this.tempBuff.push(T);else if(isAsciiLower(T))this.currentToken.tagName+=toChar(T),this.tempBuff.push(T);else{if(this._isAppropriateEndTagToken()){if(isWhitespace(T))return void(this.state=BEFORE_ATTRIBUTE_NAME_STATE);if(T===$.SOLIDUS)return void(this.state=SELF_CLOSING_START_TAG_STATE);if(T===$.GREATER_THAN_SIGN)return this._emitCurrentToken(),void(this.state=DATA_STATE)}this._emitChar("<"),this._emitChar("/"),this._emitSeveralCodePoints(this.tempBuff),this._reconsumeInState(SCRIPT_DATA_ESCAPED_STATE)}},_[SCRIPT_DATA_DOUBLE_ESCAPE_START_STATE]=function(T){isWhitespace(T)||T===$.SOLIDUS||T===$.GREATER_THAN_SIGN?(this.state=this.isTempBufferEqualToScriptString()?SCRIPT_DATA_DOUBLE_ESCAPED_STATE:SCRIPT_DATA_ESCAPED_STATE,this._emitCodePoint(T)):isAsciiUpper(T)?(this.tempBuff.push(toAsciiLowerCodePoint(T)),this._emitCodePoint(T)):isAsciiLower(T)?(this.tempBuff.push(T),this._emitCodePoint(T)):this._reconsumeInState(SCRIPT_DATA_ESCAPED_STATE)},_[SCRIPT_DATA_DOUBLE_ESCAPED_STATE]=function(T){T===$.HYPHEN_MINUS?(this.state=SCRIPT_DATA_DOUBLE_ESCAPED_DASH_STATE,this._emitChar("-")):T===$.LESS_THAN_SIGN?(this.state=SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN_STATE,this._emitChar("<")):T===$.NULL?this._emitChar(UNICODE.REPLACEMENT_CHARACTER):T===$.EOF?this._reconsumeInState(DATA_STATE):this._emitCodePoint(T)},_[SCRIPT_DATA_DOUBLE_ESCAPED_DASH_STATE]=function(T){T===$.HYPHEN_MINUS?(this.state=SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH_STATE,this._emitChar("-")):T===$.LESS_THAN_SIGN?(this.state=SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN_STATE,this._emitChar("<")):T===$.NULL?(this.state=SCRIPT_DATA_DOUBLE_ESCAPED_STATE,this._emitChar(UNICODE.REPLACEMENT_CHARACTER)):T===$.EOF?this._reconsumeInState(DATA_STATE):(this.state=SCRIPT_DATA_DOUBLE_ESCAPED_STATE,this._emitCodePoint(T))},_[SCRIPT_DATA_DOUBLE_ESCAPED_DASH_DASH_STATE]=function(T){T===$.HYPHEN_MINUS?this._emitChar("-"):T===$.LESS_THAN_SIGN?(this.state=SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN_STATE,this._emitChar("<")):T===$.GREATER_THAN_SIGN?(this.state=SCRIPT_DATA_STATE,this._emitChar(">")):T===$.NULL?(this.state=SCRIPT_DATA_DOUBLE_ESCAPED_STATE,this._emitChar(UNICODE.REPLACEMENT_CHARACTER)):T===$.EOF?this._reconsumeInState(DATA_STATE):(this.state=SCRIPT_DATA_DOUBLE_ESCAPED_STATE,this._emitCodePoint(T))},_[SCRIPT_DATA_DOUBLE_ESCAPED_LESS_THAN_SIGN_STATE]=function(T){T===$.SOLIDUS?(this.tempBuff=[],this.state=SCRIPT_DATA_DOUBLE_ESCAPE_END_STATE,this._emitChar("/")):this._reconsumeInState(SCRIPT_DATA_DOUBLE_ESCAPED_STATE)},_[SCRIPT_DATA_DOUBLE_ESCAPE_END_STATE]=function(T){isWhitespace(T)||T===$.SOLIDUS||T===$.GREATER_THAN_SIGN?(this.state=this.isTempBufferEqualToScriptString()?SCRIPT_DATA_ESCAPED_STATE:SCRIPT_DATA_DOUBLE_ESCAPED_STATE,this._emitCodePoint(T)):isAsciiUpper(T)?(this.tempBuff.push(toAsciiLowerCodePoint(T)),this._emitCodePoint(T)):isAsciiLower(T)?(this.tempBuff.push(T),this._emitCodePoint(T)):this._reconsumeInState(SCRIPT_DATA_DOUBLE_ESCAPED_STATE)},_[BEFORE_ATTRIBUTE_NAME_STATE]=function(T){isWhitespace(T)||(T===$.SOLIDUS?this.state=SELF_CLOSING_START_TAG_STATE:T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):isAsciiUpper(T)?(this._createAttr(toAsciiLowerChar(T)),this.state=ATTRIBUTE_NAME_STATE):T===$.NULL?(this._createAttr(UNICODE.REPLACEMENT_CHARACTER),this.state=ATTRIBUTE_NAME_STATE):T===$.QUOTATION_MARK||T===$.APOSTROPHE||T===$.LESS_THAN_SIGN||T===$.EQUALS_SIGN?(this._createAttr(toChar(T)),this.state=ATTRIBUTE_NAME_STATE):T===$.EOF?this._reconsumeInState(DATA_STATE):(this._createAttr(toChar(T)),this.state=ATTRIBUTE_NAME_STATE))},_[ATTRIBUTE_NAME_STATE]=function(T){isWhitespace(T)?this._leaveAttrName(AFTER_ATTRIBUTE_NAME_STATE):T===$.SOLIDUS?this._leaveAttrName(SELF_CLOSING_START_TAG_STATE):T===$.EQUALS_SIGN?this._leaveAttrName(BEFORE_ATTRIBUTE_VALUE_STATE):T===$.GREATER_THAN_SIGN?(this._leaveAttrName(DATA_STATE),this._emitCurrentToken()):isAsciiUpper(T)?this.currentAttr.name+=toAsciiLowerChar(T):T===$.QUOTATION_MARK||T===$.APOSTROPHE||T===$.LESS_THAN_SIGN?this.currentAttr.name+=toChar(T):T===$.NULL?this.currentAttr.name+=UNICODE.REPLACEMENT_CHARACTER:T===$.EOF?this._reconsumeInState(DATA_STATE):this.currentAttr.name+=toChar(T)},_[AFTER_ATTRIBUTE_NAME_STATE]=function(T){isWhitespace(T)||(T===$.SOLIDUS?this.state=SELF_CLOSING_START_TAG_STATE:T===$.EQUALS_SIGN?this.state=BEFORE_ATTRIBUTE_VALUE_STATE:T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):isAsciiUpper(T)?(this._createAttr(toAsciiLowerChar(T)),this.state=ATTRIBUTE_NAME_STATE):T===$.NULL?(this._createAttr(UNICODE.REPLACEMENT_CHARACTER),this.state=ATTRIBUTE_NAME_STATE):T===$.QUOTATION_MARK||T===$.APOSTROPHE||T===$.LESS_THAN_SIGN?(this._createAttr(toChar(T)),this.state=ATTRIBUTE_NAME_STATE):T===$.EOF?this._reconsumeInState(DATA_STATE):(this._createAttr(toChar(T)),this.state=ATTRIBUTE_NAME_STATE))},_[BEFORE_ATTRIBUTE_VALUE_STATE]=function(T){isWhitespace(T)||(T===$.QUOTATION_MARK?this.state=ATTRIBUTE_VALUE_DOUBLE_QUOTED_STATE:T===$.AMPERSAND?this._reconsumeInState(ATTRIBUTE_VALUE_UNQUOTED_STATE):T===$.APOSTROPHE?this.state=ATTRIBUTE_VALUE_SINGLE_QUOTED_STATE:T===$.NULL?(this.currentAttr.value+=UNICODE.REPLACEMENT_CHARACTER,this.state=ATTRIBUTE_VALUE_UNQUOTED_STATE):T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):T===$.LESS_THAN_SIGN||T===$.EQUALS_SIGN||T===$.GRAVE_ACCENT?(this.currentAttr.value+=toChar(T),this.state=ATTRIBUTE_VALUE_UNQUOTED_STATE):T===$.EOF?this._reconsumeInState(DATA_STATE):(this.currentAttr.value+=toChar(T),this.state=ATTRIBUTE_VALUE_UNQUOTED_STATE))},_[ATTRIBUTE_VALUE_DOUBLE_QUOTED_STATE]=function(T){T===$.QUOTATION_MARK?this.state=AFTER_ATTRIBUTE_VALUE_QUOTED_STATE:T===$.AMPERSAND?(this.additionalAllowedCp=$.QUOTATION_MARK,this.returnState=this.state,this.state=CHARACTER_REFERENCE_IN_ATTRIBUTE_VALUE_STATE):T===$.NULL?this.currentAttr.value+=UNICODE.REPLACEMENT_CHARACTER:T===$.EOF?this._reconsumeInState(DATA_STATE):this.currentAttr.value+=toChar(T)},_[ATTRIBUTE_VALUE_SINGLE_QUOTED_STATE]=function(T){T===$.APOSTROPHE?this.state=AFTER_ATTRIBUTE_VALUE_QUOTED_STATE:T===$.AMPERSAND?(this.additionalAllowedCp=$.APOSTROPHE,this.returnState=this.state,this.state=CHARACTER_REFERENCE_IN_ATTRIBUTE_VALUE_STATE):T===$.NULL?this.currentAttr.value+=UNICODE.REPLACEMENT_CHARACTER:T===$.EOF?this._reconsumeInState(DATA_STATE):this.currentAttr.value+=toChar(T)},_[ATTRIBUTE_VALUE_UNQUOTED_STATE]=function(T){isWhitespace(T)?this.state=BEFORE_ATTRIBUTE_NAME_STATE:T===$.AMPERSAND?(this.additionalAllowedCp=$.GREATER_THAN_SIGN,this.returnState=this.state,this.state=CHARACTER_REFERENCE_IN_ATTRIBUTE_VALUE_STATE):T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):T===$.NULL?this.currentAttr.value+=UNICODE.REPLACEMENT_CHARACTER:T===$.QUOTATION_MARK||T===$.APOSTROPHE||T===$.LESS_THAN_SIGN||T===$.EQUALS_SIGN||T===$.GRAVE_ACCENT?this.currentAttr.value+=toChar(T):T===$.EOF?this._reconsumeInState(DATA_STATE):this.currentAttr.value+=toChar(T)},_[CHARACTER_REFERENCE_IN_ATTRIBUTE_VALUE_STATE]=function(T){var t=this._consumeCharacterReference(T,!0);if(t)for(var _=0;_<t.length;_++)this.currentAttr.value+=toChar(t[_]);else this.currentAttr.value+="&";this.state=this.returnState},_[AFTER_ATTRIBUTE_VALUE_QUOTED_STATE]=function(T){isWhitespace(T)?this.state=BEFORE_ATTRIBUTE_NAME_STATE:T===$.SOLIDUS?this.state=SELF_CLOSING_START_TAG_STATE:T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):T===$.EOF?this._reconsumeInState(DATA_STATE):this._reconsumeInState(BEFORE_ATTRIBUTE_NAME_STATE)},_[SELF_CLOSING_START_TAG_STATE]=function(T){T===$.GREATER_THAN_SIGN?(this.currentToken.selfClosing=!0,this.state=DATA_STATE,this._emitCurrentToken()):T===$.EOF?this._reconsumeInState(DATA_STATE):this._reconsumeInState(BEFORE_ATTRIBUTE_NAME_STATE)},_[BOGUS_COMMENT_STATE]=function(T){for(this._createCommentToken();;){if(T===$.GREATER_THAN_SIGN){this.state=DATA_STATE;break}if(T===$.EOF){this._reconsumeInState(DATA_STATE);break}this.currentToken.data+=T===$.NULL?UNICODE.REPLACEMENT_CHARACTER:toChar(T),T=this._consume()}this._emitCurrentToken()},_[MARKUP_DECLARATION_OPEN_STATE]=function(T){this._consumeSubsequentIfMatch($$.DASH_DASH_STRING,T,!0)?(this._createCommentToken(),this.state=COMMENT_START_STATE):this._consumeSubsequentIfMatch($$.DOCTYPE_STRING,T,!1)?this.state=DOCTYPE_STATE:this.allowCDATA&&this._consumeSubsequentIfMatch($$.CDATA_START_STRING,T,!0)?this.state=CDATA_SECTION_STATE:this[BOGUS_COMMENT_STATE](T)},_[COMMENT_START_STATE]=function(T){T===$.HYPHEN_MINUS?this.state=COMMENT_START_DASH_STATE:T===$.NULL?(this.currentToken.data+=UNICODE.REPLACEMENT_CHARACTER,this.state=COMMENT_STATE):T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):T===$.EOF?(this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.data+=toChar(T),this.state=COMMENT_STATE)},_[COMMENT_START_DASH_STATE]=function(T){T===$.HYPHEN_MINUS?this.state=COMMENT_END_STATE:T===$.NULL?(this.currentToken.data+="-",this.currentToken.data+=UNICODE.REPLACEMENT_CHARACTER,this.state=COMMENT_STATE):T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):T===$.EOF?(this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.data+="-",this.currentToken.data+=toChar(T),this.state=COMMENT_STATE)},_[COMMENT_STATE]=function(T){T===$.HYPHEN_MINUS?this.state=COMMENT_END_DASH_STATE:T===$.NULL?this.currentToken.data+=UNICODE.REPLACEMENT_CHARACTER:T===$.EOF?(this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):this.currentToken.data+=toChar(T)},_[COMMENT_END_DASH_STATE]=function(T){T===$.HYPHEN_MINUS?this.state=COMMENT_END_STATE:T===$.NULL?(this.currentToken.data+="-",this.currentToken.data+=UNICODE.REPLACEMENT_CHARACTER,this.state=COMMENT_STATE):T===$.EOF?(this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.data+="-",this.currentToken.data+=toChar(T),this.state=COMMENT_STATE)},_[COMMENT_END_STATE]=function(T){T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):T===$.EXCLAMATION_MARK?this.state=COMMENT_END_BANG_STATE:T===$.HYPHEN_MINUS?this.currentToken.data+="-":T===$.NULL?(this.currentToken.data+="--",this.currentToken.data+=UNICODE.REPLACEMENT_CHARACTER,this.state=COMMENT_STATE):T===$.EOF?(this._reconsumeInState(DATA_STATE),this._emitCurrentToken()):(this.currentToken.data+="--",this.currentToken.data+=toChar(T),this.state=COMMENT_STATE)},_[COMMENT_END_BANG_STATE]=function(T){T===$.HYPHEN_MINUS?(this.currentToken.data+="--!",this.state=COMMENT_END_DASH_STATE):T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):T===$.NULL?(this.currentToken.data+="--!",this.currentToken.data+=UNICODE.REPLACEMENT_CHARACTER,this.state=COMMENT_STATE):T===$.EOF?(this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.data+="--!",this.currentToken.data+=toChar(T),this.state=COMMENT_STATE)},_[DOCTYPE_STATE]=function(T){isWhitespace(T)?this.state=BEFORE_DOCTYPE_NAME_STATE:T===$.EOF?(this._createDoctypeToken(),this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):this._reconsumeInState(BEFORE_DOCTYPE_NAME_STATE)},_[BEFORE_DOCTYPE_NAME_STATE]=function(T){isWhitespace(T)||(isAsciiUpper(T)?(this._createDoctypeToken(toAsciiLowerChar(T)),this.state=DOCTYPE_NAME_STATE):T===$.GREATER_THAN_SIGN?(this._createDoctypeToken(),this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this.state=DATA_STATE):T===$.EOF?(this._createDoctypeToken(),this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):T===$.NULL?(this._createDoctypeToken(UNICODE.REPLACEMENT_CHARACTER),this.state=DOCTYPE_NAME_STATE):(this._createDoctypeToken(toChar(T)),this.state=DOCTYPE_NAME_STATE))},_[DOCTYPE_NAME_STATE]=function(T){isWhitespace(T)?this.state=AFTER_DOCTYPE_NAME_STATE:T===$.GREATER_THAN_SIGN?(this._emitCurrentToken(),this.state=DATA_STATE):isAsciiUpper(T)?this.currentToken.name+=toAsciiLowerChar(T):T===$.NULL?this.currentToken.name+=UNICODE.REPLACEMENT_CHARACTER:T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):this.currentToken.name+=toChar(T)},_[AFTER_DOCTYPE_NAME_STATE]=function(T){isWhitespace(T)||(T===$.GREATER_THAN_SIGN?(this.state=DATA_STATE,this._emitCurrentToken()):T===$.EOF?(this.currentToken.forceQuirks=!0,
this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):this._consumeSubsequentIfMatch($$.PUBLIC_STRING,T,!1)?this.state=AFTER_DOCTYPE_PUBLIC_KEYWORD_STATE:this._consumeSubsequentIfMatch($$.SYSTEM_STRING,T,!1)?this.state=AFTER_DOCTYPE_SYSTEM_KEYWORD_STATE:(this.currentToken.forceQuirks=!0,this.state=BOGUS_DOCTYPE_STATE))},_[AFTER_DOCTYPE_PUBLIC_KEYWORD_STATE]=function(T){isWhitespace(T)?this.state=BEFORE_DOCTYPE_PUBLIC_IDENTIFIER_STATE:T===$.QUOTATION_MARK?(this.currentToken.publicId="",this.state=DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED_STATE):T===$.APOSTROPHE?(this.currentToken.publicId="",this.state=DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED_STATE):T===$.GREATER_THAN_SIGN?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this.state=DATA_STATE):T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.forceQuirks=!0,this.state=BOGUS_DOCTYPE_STATE)},_[BEFORE_DOCTYPE_PUBLIC_IDENTIFIER_STATE]=function(T){isWhitespace(T)||(T===$.QUOTATION_MARK?(this.currentToken.publicId="",this.state=DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED_STATE):T===$.APOSTROPHE?(this.currentToken.publicId="",this.state=DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED_STATE):T===$.GREATER_THAN_SIGN?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this.state=DATA_STATE):T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.forceQuirks=!0,this.state=BOGUS_DOCTYPE_STATE))},_[DOCTYPE_PUBLIC_IDENTIFIER_DOUBLE_QUOTED_STATE]=function(T){T===$.QUOTATION_MARK?this.state=AFTER_DOCTYPE_PUBLIC_IDENTIFIER_STATE:T===$.NULL?this.currentToken.publicId+=UNICODE.REPLACEMENT_CHARACTER:T===$.GREATER_THAN_SIGN?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this.state=DATA_STATE):T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):this.currentToken.publicId+=toChar(T)},_[DOCTYPE_PUBLIC_IDENTIFIER_SINGLE_QUOTED_STATE]=function(T){T===$.APOSTROPHE?this.state=AFTER_DOCTYPE_PUBLIC_IDENTIFIER_STATE:T===$.NULL?this.currentToken.publicId+=UNICODE.REPLACEMENT_CHARACTER:T===$.GREATER_THAN_SIGN?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this.state=DATA_STATE):T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):this.currentToken.publicId+=toChar(T)},_[AFTER_DOCTYPE_PUBLIC_IDENTIFIER_STATE]=function(T){isWhitespace(T)?this.state=BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS_STATE:T===$.GREATER_THAN_SIGN?(this._emitCurrentToken(),this.state=DATA_STATE):T===$.QUOTATION_MARK?(this.currentToken.systemId="",this.state=DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED_STATE):T===$.APOSTROPHE?(this.currentToken.systemId="",this.state=DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED_STATE):T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.forceQuirks=!0,this.state=BOGUS_DOCTYPE_STATE)},_[BETWEEN_DOCTYPE_PUBLIC_AND_SYSTEM_IDENTIFIERS_STATE]=function(T){isWhitespace(T)||(T===$.GREATER_THAN_SIGN?(this._emitCurrentToken(),this.state=DATA_STATE):T===$.QUOTATION_MARK?(this.currentToken.systemId="",this.state=DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED_STATE):T===$.APOSTROPHE?(this.currentToken.systemId="",this.state=DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED_STATE):T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.forceQuirks=!0,this.state=BOGUS_DOCTYPE_STATE))},_[AFTER_DOCTYPE_SYSTEM_KEYWORD_STATE]=function(T){isWhitespace(T)?this.state=BEFORE_DOCTYPE_SYSTEM_IDENTIFIER_STATE:T===$.QUOTATION_MARK?(this.currentToken.systemId="",this.state=DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED_STATE):T===$.APOSTROPHE?(this.currentToken.systemId="",this.state=DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED_STATE):T===$.GREATER_THAN_SIGN?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this.state=DATA_STATE):T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.forceQuirks=!0,this.state=BOGUS_DOCTYPE_STATE)},_[BEFORE_DOCTYPE_SYSTEM_IDENTIFIER_STATE]=function(T){isWhitespace(T)||(T===$.QUOTATION_MARK?(this.currentToken.systemId="",this.state=DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED_STATE):T===$.APOSTROPHE?(this.currentToken.systemId="",this.state=DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED_STATE):T===$.GREATER_THAN_SIGN?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this.state=DATA_STATE):T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):(this.currentToken.forceQuirks=!0,this.state=BOGUS_DOCTYPE_STATE))},_[DOCTYPE_SYSTEM_IDENTIFIER_DOUBLE_QUOTED_STATE]=function(T){T===$.QUOTATION_MARK?this.state=AFTER_DOCTYPE_SYSTEM_IDENTIFIER_STATE:T===$.GREATER_THAN_SIGN?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this.state=DATA_STATE):T===$.NULL?this.currentToken.systemId+=UNICODE.REPLACEMENT_CHARACTER:T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):this.currentToken.systemId+=toChar(T)},_[DOCTYPE_SYSTEM_IDENTIFIER_SINGLE_QUOTED_STATE]=function(T){T===$.APOSTROPHE?this.state=AFTER_DOCTYPE_SYSTEM_IDENTIFIER_STATE:T===$.GREATER_THAN_SIGN?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this.state=DATA_STATE):T===$.NULL?this.currentToken.systemId+=UNICODE.REPLACEMENT_CHARACTER:T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):this.currentToken.systemId+=toChar(T)},_[AFTER_DOCTYPE_SYSTEM_IDENTIFIER_STATE]=function(T){isWhitespace(T)||(T===$.GREATER_THAN_SIGN?(this._emitCurrentToken(),this.state=DATA_STATE):T===$.EOF?(this.currentToken.forceQuirks=!0,this._emitCurrentToken(),this._reconsumeInState(DATA_STATE)):this.state=BOGUS_DOCTYPE_STATE)},_[BOGUS_DOCTYPE_STATE]=function(T){T===$.GREATER_THAN_SIGN?(this._emitCurrentToken(),this.state=DATA_STATE):T===$.EOF&&(this._emitCurrentToken(),this._reconsumeInState(DATA_STATE))},_[CDATA_SECTION_STATE]=function(T){for(;;){if(T===$.EOF){this._reconsumeInState(DATA_STATE);break}if(this._consumeSubsequentIfMatch($$.CDATA_END_STRING,T,!0)){this.state=DATA_STATE;break}this._emitCodePoint(T),T=this._consume()}};