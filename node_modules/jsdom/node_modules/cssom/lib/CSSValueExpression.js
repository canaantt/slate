var CSSOM={CSSValue:require("./CSSValue").CSSValue};CSSOM.CSSValueExpression=function(e,r){this._token=e,this._idx=r},CSSOM.CSSValueExpression.prototype=new CSSOM.CSSValue,CSSOM.CSSValueExpression.prototype.constructor=CSSOM.CSSValueExpression,CSSOM.CSSValueExpression.prototype.parse=function(){for(var e,r=this._token,s=this._idx,n="",t="",i="",S=[];;++s){if(n=r.charAt(s),""===n){i="css expression error: unfinished expression!";break}switch(n){case"(":S.push(n),t+=n;break;case")":S.pop(n),t+=n;break;case"/":(e=this._parseJSComment(r,s))?e.error?i="css expression error: unfinished comment in expression!":s=e.idx:(e=this._parseJSRexExp(r,s))?(s=e.idx,t+=e.text):t+=n;break;case"'":case'"':e=this._parseJSString(r,s,n),e?(s=e.idx,t+=e.text):t+=n;break;default:t+=n}if(i)break;if(0===S.length)break}var o;return o=i?{error:i}:{idx:s,expression:t}},CSSOM.CSSValueExpression.prototype._parseJSComment=function(e,r){var s,n=e.charAt(r+1);if("/"===n||"*"===n){var t,i,S=r;if("/"===n?i="\n":"*"===n&&(i="*/"),t=e.indexOf(i,S+1+1),-1!==t)return t=t+i.length-1,s=e.substring(r,t+1),{idx:t,text:s};var o="css expression error: unfinished comment in expression!";return{error:o}}return!1},CSSOM.CSSValueExpression.prototype._parseJSString=function(e,r,s){var n,t=this._findMatchedIdx(e,r,s);return-1===t?!1:(n=e.substring(r,t+s.length),{idx:t,text:n})},CSSOM.CSSValueExpression.prototype._parseJSRexExp=function(e,r){var s=e.substring(0,r).replace(/\s+$/,""),n=[/^$/,/\($/,/\[$/,/\!$/,/\+$/,/\-$/,/\*$/,/\/\s+/,/\%$/,/\=$/,/\>$/,/<$/,/\&$/,/\|$/,/\^$/,/\~$/,/\?$/,/\,$/,/delete$/,/in$/,/instanceof$/,/new$/,/typeof$/,/void$/],t=n.some(function(e){return e.test(s)});if(t){var i="/";return this._parseJSString(e,r,i)}return!1},CSSOM.CSSValueExpression.prototype._findMatchedIdx=function(e,r,s){for(var n,t=r,i=-1;;){if(n=e.indexOf(s,t+1),-1===n){n=i;break}var S=e.substring(r+1,n),o=S.match(/\\+$/);if(!o||o[0]%2===0)break;t=n}var a=e.indexOf("\n",r+1);return n>a&&(n=i),n},exports.CSSValueExpression=CSSOM.CSSValueExpression;