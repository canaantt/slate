"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function queue(e,t,r){function a(e,t,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");return s.started=!0,_isArray2["default"](e)||(e=[e]),0===e.length&&s.idle()?_setImmediate2["default"](function(){s.drain()}):(_arrayEach2["default"](e,function(e){var a={data:e,callback:r||_noop2["default"]};t?s._tasks.unshift(a):s._tasks.push(a)}),void _setImmediate2["default"](s.process))}function n(e){return _rest2["default"](function(t){u-=1,_arrayEach2["default"](e,function(e){_arrayEach2["default"](o,function(t,r){return t===e?(o.splice(r,1),!1):void 0}),e.callback.apply(e,t),null!=t[0]&&s.error(t[0],e.data)}),u<=s.concurrency-s.buffer&&s.unsaturated(),s.idle()&&s.drain(),s.process()})}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var u=0,o=[],s={_tasks:new _DoublyLinkedList2["default"],concurrency:t,payload:r,saturated:_noop2["default"],unsaturated:_noop2["default"],buffer:t/4,empty:_noop2["default"],drain:_noop2["default"],error:_noop2["default"],started:!1,paused:!1,push:function(e,t){a(e,!1,t)},kill:function(){s.drain=_noop2["default"],s._tasks.empty()},unshift:function(e,t){a(e,!0,t)},process:function(){for(;!s.paused&&u<s.concurrency&&s._tasks.length;){var t=[],r=[],a=s._tasks.length;s.payload&&(a=Math.min(a,s.payload));for(var i=0;a>i;i++){var l=s._tasks.shift();t.push(l),r.push(l.data)}0===s._tasks.length&&s.empty(),u+=1,o.push(t[0]),u===s.concurrency&&s.saturated();var d=_onlyOnce2["default"](n(t));e(r,d)}},length:function(){return s._tasks.length},running:function(){return u},workersList:function(){return o},idle:function(){return s._tasks.length+u===0},pause:function(){s.paused=!0},resume:function(){if(s.paused!==!1){s.paused=!1;for(var e=Math.min(s.concurrency,s._tasks.length),t=1;e>=t;t++)_setImmediate2["default"](s.process)}}};return s}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=queue;var _arrayEach=require("lodash/_arrayEach"),_arrayEach2=_interopRequireDefault(_arrayEach),_isArray=require("lodash/isArray"),_isArray2=_interopRequireDefault(_isArray),_noop=require("lodash/noop"),_noop2=_interopRequireDefault(_noop),_rest=require("lodash/rest"),_rest2=_interopRequireDefault(_rest),_onlyOnce=require("./onlyOnce"),_onlyOnce2=_interopRequireDefault(_onlyOnce),_setImmediate=require("./setImmediate"),_setImmediate2=_interopRequireDefault(_setImmediate),_DoublyLinkedList=require("./DoublyLinkedList"),_DoublyLinkedList2=_interopRequireDefault(_DoublyLinkedList);module.exports=exports["default"];