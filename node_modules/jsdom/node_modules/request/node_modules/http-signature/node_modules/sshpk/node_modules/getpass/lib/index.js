/*
 * Copyright 2016, Joyent, Inc. All rights reserved.
 * Author: Alex Wilson <alex.wilson@joyent.com>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
*/
function getPass(e,o){"function"==typeof e&&void 0===o&&(o=e,e={}),mod_assert.object(e,"options"),mod_assert.func(o,"callback"),mod_assert.optionalString(e.prompt,"options.prompt"),void 0===e.prompt&&(e.prompt="Password"),openTTY(function(t,r,s,n,d){function i(e){for(var t=e.toString("utf8"),r=0;r<t.length;++r){var s=t[r];switch(s){case"\r":case"\n":case CTRLD:return a(),void o(null,c);case CTRLC:return a(),void o(new Error("Aborted"));case BACKSPACE:c=c.slice(0,c.length-1);break;default:c+=s}}}function a(){d.write("\r\n"),n.setRawMode(!1),n.pause(),n.removeListener("data",i),void 0!==s&&s!==r&&(d.end(),mod_fs.closeSync(s)),void 0!==r&&(n.end(),mod_fs.closeSync(r))}if(t)return void o(t);d.write(e.prompt+":"),n.resume(),n.setRawMode(!0),n.resume(),n.setEncoding("utf8");var c="";n.on("data",i)})}function openTTY(e){mod_fs.open("/dev/tty","r+",function(o,t){if(o&&("ENOENT"===o.code||"EACCES"===o.code)||process.version.match(/^v0[.][0-8][.]/))return void e(null,void 0,void 0,process.stdin,process.stdout);var r=new mod_tty.ReadStream(t);mod_fs.open("/dev/tty","w+",function(o,s){var n=new mod_tty.WriteStream(s);return o?void e(o):void e(null,t,s,r,n)})})}module.exports={getPass:getPass};const mod_tty=require("tty"),mod_fs=require("fs"),mod_assert=require("assert-plus");var BACKSPACE=String.fromCharCode(127),CTRLC="",CTRLD="";