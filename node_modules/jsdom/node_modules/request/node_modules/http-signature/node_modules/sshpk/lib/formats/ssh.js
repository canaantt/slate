// Copyright 2015 Joyent, Inc.
function read(e,r){"string"!=typeof e&&(assert.buffer(e,"buf"),e=e.toString("ascii"));var t=e.trim().replace(/[\\\r]/g,""),a=t.match(SSHKEY_RE);a||(a=t.match(SSHKEY_RE2)),assert.ok(a,"key must match regex");var s,c=rfc4253.algToKeyType(a[1]),i=new Buffer(a[2],"base64"),u={};if(a[4])try{s=rfc4253.read(i)}catch(n){a=t.match(SSHKEY_RE2),assert.ok(a,"key must match regex"),i=new Buffer(a[2],"base64"),s=rfc4253.readInternal(u,"public",i)}else s=rfc4253.readInternal(u,"public",i);if(assert.strictEqual(c,s.type),a[4]&&a[4].length>0)s.comment=a[4];else if(u.consumed){var f=a[2]+a[3],l=4*Math.ceil(u.consumed/3);f=f.slice(0,l-2).replace(/[^a-zA-Z0-9+\/=]/g,"")+f.slice(l-2);var o=u.consumed%3;for(o>0&&"="!==f.slice(l-1,l)&&l--;"="===f.slice(l,l+1);)l++;var m=f.slice(l);m=m.replace(/[\r\n]/g," ").replace(/^\s+/,""),m.match(/^[a-zA-Z0-9]/)&&(s.comment=m)}return s}function write(e,r){if(assert.object(e),!Key.isKey(e))throw new Error("Must be a public key");var t=[],a=rfc4253.keyTypeToAlg(e);t.push(a);var s=rfc4253.write(e);return t.push(s.toString("base64")),e.comment&&t.push(e.comment),new Buffer(t.join(" "))}module.exports={read:read,write:write};var assert=require("assert-plus"),rfc4253=require("./rfc4253"),utils=require("../utils"),Key=require("../key"),PrivateKey=require("../private-key"),sshpriv=require("./ssh-private"),SSHKEY_RE=/^([a-z0-9-]+)[ \t]+([a-zA-Z0-9+\/]+[=]*)([\n \t]+([^\n]+))?$/,SSHKEY_RE2=/^([a-z0-9-]+)[ \t]+([a-zA-Z0-9+\/ \t\n]+[=]*)(.*)$/;