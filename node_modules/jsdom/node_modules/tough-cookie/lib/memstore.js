/*!
 * Copyright (c) 2015, Salesforce.com, Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 * this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. Neither the name of Salesforce.com nor the names of its contributors may
 * be used to endorse or promote products derived from this software without
 * specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */
"use strict";function MemoryCookieStore(){Store.call(this),this.idx={}}var Store=require("./store").Store,permuteDomain=require("./permuteDomain").permuteDomain,pathMatch=require("./pathMatch").pathMatch,util=require("util");util.inherits(MemoryCookieStore,Store),exports.MemoryCookieStore=MemoryCookieStore,MemoryCookieStore.prototype.idx=null,MemoryCookieStore.prototype.synchronous=!0,MemoryCookieStore.prototype.inspect=function(){return"{ idx: "+util.inspect(this.idx,!1,2)+" }"},MemoryCookieStore.prototype.findCookie=function(o,t,e,i){return this.idx[o]&&this.idx[o][t]?i(null,this.idx[o][t][e]||null):i(null,void 0)},MemoryCookieStore.prototype.findCookies=function(o,t,e){var i=[];if(!o)return e(null,[]);var r;r=t?function(o){Object.keys(o).forEach(function(e){if(pathMatch(t,e)){var r=o[e];for(var n in r)i.push(r[n])}})}:function(o){for(var t in o){var e=o[t];for(var r in e)i.push(e[r])}};var n=permuteDomain(o)||[o],u=this.idx;n.forEach(function(o){var t=u[o];t&&r(t)}),e(null,i)},MemoryCookieStore.prototype.putCookie=function(o,t){this.idx[o.domain]||(this.idx[o.domain]={}),this.idx[o.domain][o.path]||(this.idx[o.domain][o.path]={}),this.idx[o.domain][o.path][o.key]=o,t(null)},MemoryCookieStore.prototype.updateCookie=function(o,t,e){this.putCookie(t,e)},MemoryCookieStore.prototype.removeCookie=function(o,t,e,i){this.idx[o]&&this.idx[o][t]&&this.idx[o][t][e]&&delete this.idx[o][t][e],i(null)},MemoryCookieStore.prototype.removeCookies=function(o,t,e){return this.idx[o]&&(t?delete this.idx[o][t]:delete this.idx[o]),e(null)},MemoryCookieStore.prototype.getAllCookies=function(o){var t=[],e=this.idx,i=Object.keys(e);i.forEach(function(o){var i=Object.keys(e[o]);i.forEach(function(i){var r=Object.keys(e[o][i]);r.forEach(function(r){null!==r&&t.push(e[o][i][r])})})}),t.sort(function(o,t){return(o.creationIndex||0)-(t.creationIndex||0)}),o(null,t)};