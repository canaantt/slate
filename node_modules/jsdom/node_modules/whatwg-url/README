<h1 id="whatwg-url">whatwg-url</h1>

<p>whatwg-url is a full implementation of the WHATWG <a href="https://url.spec.whatwg.org/">URL Standard</a>. It can be used standalone, but it also exposes a lot of the internal algorithms that are useful for integrating a URL parser into a project like <a href="https://github.com/tmpvar/jsdom">jsdom</a>.</p>

<h2 id="current-status">Current Status</h2>

<p>whatwg-url is currently up to date with the URL spec up to commit <a href="https://github.com/whatwg/url/tree/e322a8a79246b3f7c026bc9e705f22f069d1bde6">e322a8</a>.</p>

<h2 id="api">API</h2>

<h3 id="the-url-constructor">The <code class="prettyprint">URL</code> Constructor</h3>

<p>The main API is the <a href="https://url.spec.whatwg.org/#url"><code class="prettyprint">URL</code></a> export, which follows the spec&rsquo;s behavior in all ways (including e.g. <code class="prettyprint">USVString</code> conversion). Most consumers of this library will want to use this.</p>

<h3 id="low-level-url-standard-api">Low-level URL Standard API</h3>

<p>The following methods are exported for use by places like jsdom that need to implement things like <a href="https://html.spec.whatwg.org/#htmlhyperlinkelementutils"><code class="prettyprint">HTMLHyperlinkElementUtils</code></a>. They operate on or return an &ldquo;internal URL&rdquo; or <a href="https://url.spec.whatwg.org/#concept-url">&ldquo;URL record&rdquo;</a> type.</p>

<ul>
<li><a href="https://url.spec.whatwg.org/#concept-url-parser">URL parser</a>: <code class="prettyprint">parseURL(input, { baseURL, encodingOverride })</code></li>
<li><a href="https://url.spec.whatwg.org/#concept-basic-url-parser">Basic URL parser</a>: <code class="prettyprint">basicURLParse(input, { baseURL, encodingOverride, url, stateOverride })</code></li>
<li><a href="https://url.spec.whatwg.org/#concept-url-serializer">URL serializer</a>: <code class="prettyprint">serializeURL(urlRecord, excludeFragment)</code></li>
<li><a href="https://url.spec.whatwg.org/#concept-host-serializer">Host serializer</a>: <code class="prettyprint">serializeHost(hostFromURLRecord)</code></li>
<li><a href="https://url.spec.whatwg.org/#serialize-an-integer">Serialize an integer</a>: <code class="prettyprint">serializeInteger(number)</code></li>
<li><a href="https://url.spec.whatwg.org/#concept-url-origin">Origin</a> <a href="https://html.spec.whatwg.org/multipage/browsers.html#unicode-serialisation-of-an-origin">Unicode serializer</a>: <code class="prettyprint">serializeURLToUnicodeOrigin(urlRecord)</code></li>
<li><a href="https://url.spec.whatwg.org/#set-the-username">Set the username</a>: <code class="prettyprint">setTheUsername(urlRecord, usernameString)</code></li>
<li><a href="https://url.spec.whatwg.org/#set-the-password">Set the password</a>: <code class="prettyprint">setThePassword(urlRecord, passwordString)</code>.</li>
</ul>

<p>The <code class="prettyprint">stateOverride</code> parameter is one of the following strings:</p>

<ul>
<li><a href="https://url.spec.whatwg.org/#scheme-start-state"><code class="prettyprint">&quot;scheme start&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#scheme-state"><code class="prettyprint">&quot;scheme&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#no-scheme-state"><code class="prettyprint">&quot;no scheme&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#special-relative-or-authority-state"><code class="prettyprint">&quot;special relative or authority&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#path-or-authority-state"><code class="prettyprint">&quot;path or authority&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#relative-state"><code class="prettyprint">&quot;relative&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#relative-slash-state"><code class="prettyprint">&quot;relative slash&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#special-authority-slashes-state"><code class="prettyprint">&quot;special authority slashes&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#special-authority-ignore-slashes-state"><code class="prettyprint">&quot;special authority ignore slashes&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#authority-state"><code class="prettyprint">&quot;authority&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#host-state"><code class="prettyprint">&quot;host&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#hostname-state"><code class="prettyprint">&quot;hostname&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#port-state"><code class="prettyprint">&quot;port&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#file-state"><code class="prettyprint">&quot;file&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#file-slash-state"><code class="prettyprint">&quot;file slash&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#file-host-state"><code class="prettyprint">&quot;file host&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#path-start-state"><code class="prettyprint">&quot;path start&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#path-state"><code class="prettyprint">&quot;path&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#cannot-be-a-base-url-path-state"><code class="prettyprint">&quot;cannot-be-a-base-URL path&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#query-state"><code class="prettyprint">&quot;query&quot;</code></a></li>
<li><a href="https://url.spec.whatwg.org/#fragment-state"><code class="prettyprint">&quot;fragment&quot;</code></a></li>
</ul>

<p>The URL record type has the following API:</p>

<ul>
<li><a href="https://url.spec.whatwg.org/#concept-url-scheme"><code class="prettyprint">scheme</code></a></li>
<li><a href="https://url.spec.whatwg.org/#concept-url-username"><code class="prettyprint">username</code></a></li>
<li><a href="https://url.spec.whatwg.org/#concept-url-password"><code class="prettyprint">password</code></a></li>
<li><a href="https://url.spec.whatwg.org/#concept-url-host"><code class="prettyprint">host</code></a></li>
<li><a href="https://url.spec.whatwg.org/#concept-url-port"><code class="prettyprint">port</code></a></li>
<li><a href="https://url.spec.whatwg.org/#concept-url-path"><code class="prettyprint">path</code></a> (as an array)</li>
<li><a href="https://url.spec.whatwg.org/#concept-url-query"><code class="prettyprint">query</code></a></li>
<li><a href="https://url.spec.whatwg.org/#concept-url-fragment"><code class="prettyprint">fragment</code></a></li>
<li><a href="https://url.spec.whatwg.org/#url-cannot-be-a-base-url-flag"><code class="prettyprint">cannotBeABaseURL</code></a> (as a boolean)</li>
</ul>

<p>These properties should be treated with care, as in general changing them will cause the URL record to be in an inconsistent state until the appropriate invocation of <code class="prettyprint">basicURLParse</code> is used to fix it up. You can see examples of this in the URL Standard, where there are many step sequences like &ldquo;4. Set context object’s url’s fragment to the empty string. 5. Basic URL parse <em>input</em> with context object’s url as <em>url</em> and fragment state as <em>state override</em>.&rdquo; In between those two steps, a URL record is in an unusable state.</p>

<p>The return value of &ldquo;failure&rdquo; in the spec is represented by the string <code class="prettyprint">&quot;failure&quot;</code>. That is, functions like <code class="prettyprint">parseURL</code> and <code class="prettyprint">basicURLParse</code> can return <em>either</em> a URL record <em>or</em> the string <code class="prettyprint">&quot;failure&quot;</code>.</p>
