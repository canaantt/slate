"use strict";function normalize(u){return u.split("\x00").map(function(u){return u.normalize("NFC")}).join("\x00")}function findStatus(u){for(var D=0,r=mappingTable.length-1;r>=D;){var A=Math.floor((D+r)/2),C=mappingTable[A];if(C[0][0]<=u&&C[0][1]>=u)return C;C[0][0]>u?r=A-1:D=A+1}return null}function countSymbols(u){return u.replace(regexAstralSymbols,"_").length}function mapChars(u,D,r){for(var A=!1,C="",e=countSymbols(u),n=0;e>n;++n){var o=u.codePointAt(n),F=findStatus(o);switch(F[1]){case"disallowed":A=!0,C+=String.fromCodePoint(o);break;case"ignored":break;case"mapped":C+=String.fromCodePoint.apply(String,F[2]);break;case"deviation":C+=r===PROCESSING_OPTIONS.TRANSITIONAL?String.fromCodePoint.apply(String,F[2]):String.fromCodePoint(o);break;case"valid":C+=String.fromCodePoint(o);break;case"disallowed_STD3_mapped":D?(A=!0,C+=String.fromCodePoint(o)):C+=String.fromCodePoint.apply(String,F[2]);break;case"disallowed_STD3_valid":D&&(A=!0),C+=String.fromCodePoint(o)}}return{string:C,error:A}}function validateLabel(u,D){"xn--"===u.substr(0,4)&&(u=punycode.toUnicode(u),D=PROCESSING_OPTIONS.NONTRANSITIONAL);var r=!1;(normalize(u)!==u||"-"===u[3]&&"-"===u[4]||"-"===u[0]||"-"===u[u.length-1]||-1!==u.indexOf(".")||0===u.search(combiningMarksRegex))&&(r=!0);for(var A=countSymbols(u),C=0;A>C;++C){var e=findStatus(u.codePointAt(C));if(processing===PROCESSING_OPTIONS.TRANSITIONAL&&"valid"!==e[1]||processing===PROCESSING_OPTIONS.NONTRANSITIONAL&&"valid"!==e[1]&&"deviation"!==e[1]){r=!0;break}}return{label:u,error:r}}function processing(u,D,r){var A=mapChars(u,D,r);A.string=normalize(A.string);for(var C=A.string.split("."),e=0;e<C.length;++e)try{var n=validateLabel(C[e]);C[e]=n.label,A.error=A.error||n.error}catch(o){A.error=!0}return{string:C.join("."),error:A.error}}var punycode=require("punycode"),mappingTable=require("./lib/mappingTable.json"),PROCESSING_OPTIONS={TRANSITIONAL:0,NONTRANSITIONAL:1},regexAstralSymbols=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,combiningMarksRegex=/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2D]|\uD800[\uDDFD\uDEE0\uDF76-\uDF7A]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F\uDEE5\uDEE6]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC7F-\uDC82\uDCB0-\uDCBA\uDD00-\uDD02\uDD27-\uDD34\uDD73\uDD80-\uDD82\uDDB3-\uDDC0\uDE2C-\uDE37\uDEDF-\uDEEA\uDF01-\uDF03\uDF3C\uDF3E-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF57\uDF62\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDCB0-\uDCC3\uDDAF-\uDDB5\uDDB8-\uDDC0\uDE30-\uDE40\uDEAB-\uDEB7]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF51-\uDF7E\uDF8F-\uDF92]|\uD82F[\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD83A[\uDCD0-\uDCD6]|\uDB40[\uDD00-\uDDEF]/;module.exports.toASCII=function(u,D,r,A){var C=processing(u,D,r),e=C.string.split(".");if(e=e.map(function(u){try{return punycode.toASCII(u)}catch(D){return C.error=!0,u}}),A){var n=e.slice(0,e.length-1).join(".").length;(n.length>253||0===n.length)&&(C.error=!0);for(var o=0;o<e.length;++o)if(e.length>63||0===e.length){C.error=!0;break}}return C.error?null:e.join(".")},module.exports.toUnicode=function(u,D){var r=processing(u,D,PROCESSING_OPTIONS.NONTRANSITIONAL);return{domain:r.string,error:r.error}},module.exports.PROCESSING_OPTIONS=PROCESSING_OPTIONS;