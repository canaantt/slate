/*
 * Copyright (C) 2007-2016 Diego Perini
 * All rights reserved.
 *
 * Caching/memoization module for NWMatcher
 *
 * Added capabilities:
 *
 * - Mutation Events are feature tested and used safely
 * - handle caching different document types HTML/XML/SVG
 * - store result sets for different selectors / contexts
 * - simultaneously control mutation on multiple documents
 *
 */
!function(e){var t="object"==typeof exports?exports:(e.NW||(e.NW=e.Object()))&&(e.NW.Dom||(e.NW.Dom=e.Object())),n=e.Object(),i=e.Object(),o=!1,r=!0,d=!1,c=e.document,s=c.documentElement,u=0,m=15,a=function(e,t){var n=!1,i=document.documentElement,o=document.createElement("div"),r=function(){n=!0};return i.insertBefore(o,i.firstChild),o.addEventListener(e,r,!0),t&&t.call&&t(o),o.removeEventListener(e,r,!0),i.removeChild(o),n},v=!1,f=s.addEventListener?a("DOMAttrModified",function(e){e.setAttribute("id","nw")}):!1,l=function(t,c,s,a){if(o&&!d)if(r)now=(new e.Date).getTime(),now-u<m?(d=r=!0,e.setTimeout(function(){d=!1},m)):D(!0,s),u=now;else if(i[t]&&n[t]===c)return i[t];return void 0},E=function(e,t,o,r){n[e]=t,i[e]=r},p=function(e){var t=e.target.ownerDocument||e.target;h(t),M(t)},O=function(e){!e.isCaching&&e.addEventListener&&(e.addEventListener("DOMAttrModified",p,!0),e.addEventListener("DOMNodeInserted",p,!0),e.addEventListener("DOMNodeRemoved",p,!0),e.isCaching=!0)},h=function(e){e.isCaching&&e.removeEventListener&&(e.removeEventListener("DOMAttrModified",p,!0),e.removeEventListener("DOMNodeInserted",p,!0),e.removeEventListener("DOMNodeRemoved",p,!0),e.isCaching=!1)},D=function(e,t){e?(r=!1,O(t)):(r=!0,h(t)),o=!!e},M=function(t){r=!0,n=e.Object(),i=e.Object()};!f&&s.addEventListener&&Element&&Element.prototype&&a("DOMNodeInserted",function(e){e.appendChild(document.createElement("div"))})&&a("DOMNodeRemoved",function(e){e.removeChild(e.appendChild(document.createElement("div")))})&&(v=!0,Element.prototype._setAttribute=Element.prototype.setAttribute,Element.prototype.setAttribute=function(e,t){this._setAttribute(e,t),p({target:this,type:"DOMAttrModified",attrName:e,attrValue:t})}),o=f||v,t.saveResults=E,t.loadResults=l,t.expireCache=M,t.setCache=D}(this);