/*
 * Copyright (C) 2007-2016 Diego Perini
 * All rights reserved.
 *
 * CSS3 pseudo-classes extension for NWMatcher
 *
 * Added capabilities:
 *
 * - structural pseudo-classes
 *
 * :root, :empty,
 * :nth-child(), nth-of-type(),
 * :nth-last-child(), nth-last-of-type(),
 * :first-child, :last-child, :only-child
 * :first-of-type, :last-of-type, :only-of-type
 *
 * - negation, language, target and UI element pseudo-classes
 *
 * :not(), :target, :lang(), :target
 * :link, :visited, :active, :focus, :hover,
 * :checked, :disabled, :enabled, :selected
 */
!function(e){var t=e.Object({a:1,A:1,area:1,AREA:1,link:1,LINK:1}),n=document.documentElement,i="compareDocumentPosition"in n?function(e,t){return 16==(16&e.compareDocumentPosition(t))}:"contains"in n?function(e,t){return 1==t.nodeType&&e.contains(t)}:function(e,t){for(;(t=t.parentNode)&&1==t.nodeType;)if(t===e)return!0;return!1},s=function(e){return e.getAttribute("href")&&t[e.nodeName]},o=function(e){for(e=e.firstChild;e;){if(3==e.nodeType||e.nodeName>"@")return!1;e=e.nextSibling}return!0},a=function(e,t){for(var n=1,i=t?"nextSibling":"previousSibling";e=e[i];)e.nodeName>"@"&&++n;return n},r=function(e,t){for(var n=1,i=t?"nextSibling":"previousSibling",s=e.nodeName;e=e[i];)e.nodeName==s&&++n;return n};NW.Dom.Snapshot.contains=i,NW.Dom.Snapshot.isLink=s,NW.Dom.Snapshot.isEmpty=o,NW.Dom.Snapshot.nthOfType=r,NW.Dom.Snapshot.nthElement=a}(this),NW.Dom.registerSelector("nwmatcher:spseudos",/^\:(root|empty|(?:first|last|only)(?:-child|-of-type)|nth(?:-last)?(?:-child|-of-type)\(\s*(even|odd|(?:[-+]{0,1}\d*n\s*)?[-+]{0,1}\s*\d*)\s*\))?(.*)/i,function(e){return function(t,n){var i,s,o,a,r,c=!0;switch(t[1]){case"root":n=t[3]?"if(e===h||s.contains(h,e)){"+n+"}":"if(e===h){"+n+"}";break;case"empty":n="if(s.isEmpty(e)){"+n+"}";break;default:if(t[1]&&t[2]){if("n"==t[2]){n="if(e!==h){"+n+"}";break}"even"==t[2]?(i=2,o=0):"odd"==t[2]?(i=2,o=1):(o=(s=t[2].match(/(-?\d+)$/))?e.parseInt(s[1],10):0,i=(s=t[2].match(/(-?\d*)n/i))?e.parseInt(s[1],10):0,s&&"-"==s[1]&&(i=-1)),a=i>1?/last/i.test(t[1])?"(n-("+o+"))%"+i+"==0":"n>="+o+"&&(n-("+o+"))%"+i+"==0":-1>i?/last/i.test(t[1])?"(n-("+o+"))%"+i+"==0":"n<="+o+"&&(n-("+o+"))%"+i+"==0":0===i?"n=="+o:-1==i?"n<="+o:"n>="+o,n="if(e!==h){n=s["+(/-of-type/i.test(t[1])?'"nthOfType"':'"nthElement"')+"](e,"+(/last/i.test(t[1])?"true":"false")+");if("+a+"){"+n+"}}"}else t[1]?(i=/first/i.test(t[1])?"previous":"next",s=/only/i.test(t[1])?"previous":"next",o=/first|last/i.test(t[1]),r=/-of-type/i.test(t[1])?"&&n.nodeName!==e.nodeName":'&&n.nodeName<"@"',n="if(e!==h){"+("n=e;while((n=n."+i+"Sibling)"+r+");if(!n){"+(o?n:"n=e;while((n=n."+s+"Sibling)"+r+");if(!n){"+n+"}")+"}")+"}"):c=!1}return e.Object({source:n,status:c})}}(this)),NW.Dom.registerSelector("nwmatcher:dpseudos",/^\:(link|visited|target|active|focus|hover|checked|disabled|enabled|selected|lang\(([-\w]{2,})\)|not\(\s*(:nth(?:-last)?(?:-child|-of-type)\(\s*(?:even|odd|(?:[-+]{0,1}\d*n\s*)?[-+]{0,1}\s*\d*)\s*\)|[^()]*)\s*\))?(.*)/i,function(e){var t=e.document,n=NW.Dom.Config,i=NW.Dom.Tokens,s=e.RegExp("^\\s+|\\s+$","g"),o=e.RegExp("^((?!:not)("+i.prefixes+"|"+i.identifier+"|\\([^()]*\\))+|\\["+i.attributes+"\\])$");return function(i,a){var r,c,d=!0;switch(i[1].match(/^\w+/)[0]){case"not":r=i[3].replace(s,""),n.SIMPLENOT&&!o.test(r)?NW.Dom.emit('Negation pseudo-class only accepts simple selectors "'+selector+'"'):a="compatMode"in t?"if(!"+NW.Dom.compile(r,"",!1)+"(e,s,r,d,h,g)){"+a+"}":'if(!s.match(e, "'+r.replace(/\x22/g,'\\"')+'",g)){'+a+"}";break;case"checked":a='if((typeof e.form!=="undefined"&&(/^(?:radio|checkbox)$/i).test(e.type)&&e.checked)'+(n.USE_HTML5?"||(/^option$/i.test(e.nodeName)&&(e.selected||e.checked))":"")+"){"+a+"}";break;case"disabled":a='if(((typeof e.form!=="undefined"'+(n.USE_HTML5?"":"&&!(/^hidden$/i).test(e.type)")+")||s.isLink(e))&&e.disabled===true){"+a+"}";break;case"enabled":a='if(((typeof e.form!=="undefined"'+(n.USE_HTML5?"":"&&!(/^hidden$/i).test(e.type)")+")||s.isLink(e))&&e.disabled===false){"+a+"}";break;case"lang":c="",i[2]&&(c=i[2].substr(0,2)+"-"),a='do{(n=e.lang||"").toLowerCase();if((n==""&&h.lang=="'+i[2].toLowerCase()+'")||(n&&(n=="'+i[2].toLowerCase()+'"||n.substr(0,3)=="'+c.toLowerCase()+'"))){'+a+"break;}}while((e=e.parentNode)&&e!==g);";break;case"target":a="if(e.id==d.location.hash.slice(1)){"+a+"}";break;case"link":a="if(s.isLink(e)&&!e.visited){"+a+"}";break;case"visited":a="if(s.isLink(e)&&e.visited){"+a+"}";break;case"active":a="if(e===d.activeElement){"+a+"}";break;case"hover":a="if(e===d.hoverElement){"+a+"}";break;case"focus":a="hasFocus"in t?'if(e===d.activeElement&&d.hasFocus()&&(e.type||e.href||typeof e.tabIndex=="number")){'+a+"}":"if(e===d.activeElement&&(e.type||e.href)){"+a+"}";break;case"selected":a="if(/^option$/i.test(e.nodeName)&&(e.selected||e.checked)){"+a+"}";break;default:d=!1}return e.Object({source:a,status:d})}}(this));