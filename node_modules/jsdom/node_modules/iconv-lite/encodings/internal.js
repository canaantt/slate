"use strict";function InternalCodec(e,t){this.enc=e.encodingName,this.bomAware=e.bomAware,"base64"===this.enc?this.encoder=InternalEncoderBase64:"cesu8"===this.enc&&(this.enc="utf8",this.encoder=InternalEncoderCesu8,3==new Buffer("eda080","hex").toString().length&&(this.decoder=InternalDecoderCesu8,this.defaultCharUnicode=t.defaultCharUnicode))}function InternalDecoder(e,t){StringDecoder.call(this,t.enc)}function InternalEncoder(e,t){this.enc=t.enc}function InternalEncoderBase64(e,t){this.prevStr=""}function InternalEncoderCesu8(e,t){}function InternalDecoderCesu8(e,t){this.acc=0,this.contBytes=0,this.accBytes=0,this.defaultCharUnicode=t.defaultCharUnicode}module.exports={utf8:{type:"_internal",bomAware:!0},cesu8:{type:"_internal",bomAware:!0},unicode11utf8:"utf8",ucs2:{type:"_internal",bomAware:!0},utf16le:"ucs2",binary:{type:"_internal"},base64:{type:"_internal"},hex:{type:"_internal"},_internal:InternalCodec},InternalCodec.prototype.encoder=InternalEncoder,InternalCodec.prototype.decoder=InternalDecoder;var StringDecoder=require("string_decoder").StringDecoder;StringDecoder.prototype.end||(StringDecoder.prototype.end=function(){}),InternalDecoder.prototype=StringDecoder.prototype,InternalEncoder.prototype.write=function(e){return new Buffer(e,this.enc)},InternalEncoder.prototype.end=function(){},InternalEncoderBase64.prototype.write=function(e){e=this.prevStr+e;var t=e.length-e.length%4;return this.prevStr=e.slice(t),e=e.slice(0,t),new Buffer(e,"base64")},InternalEncoderBase64.prototype.end=function(){return new Buffer(this.prevStr,"base64")},InternalEncoderCesu8.prototype.write=function(e){for(var t=new Buffer(3*e.length),n=0,r=0;r<e.length;r++){var o=e.charCodeAt(r);128>o?t[n++]=o:2048>o?(t[n++]=192+(o>>>6),t[n++]=128+(63&o)):(t[n++]=224+(o>>>12),t[n++]=128+(o>>>6&63),t[n++]=128+(63&o))}return t.slice(0,n)},InternalEncoderCesu8.prototype.end=function(){},InternalDecoderCesu8.prototype.write=function(e){for(var t=this.acc,n=this.contBytes,r=this.accBytes,o="",c=0;c<e.length;c++){var i=e[c];128!==(192&i)?(n>0&&(o+=this.defaultCharUnicode,n=0),128>i?o+=String.fromCharCode(i):224>i?(t=31&i,n=1,r=1):240>i?(t=15&i,n=2,r=1):o+=this.defaultCharUnicode):n>0?(t=t<<6|63&i,n--,r++,0===n&&(o+=2===r&&128>t&&t>0?this.defaultCharUnicode:3===r&&2048>t?this.defaultCharUnicode:String.fromCharCode(t))):o+=this.defaultCharUnicode}return this.acc=t,this.contBytes=n,this.accBytes=r,o},InternalDecoderCesu8.prototype.end=function(){var e=0;return this.contBytes>0&&(e+=this.defaultCharUnicode),e};