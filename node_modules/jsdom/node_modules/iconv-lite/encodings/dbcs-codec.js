"use strict";function DBCSCodec(e,t){if(this.encodingName=e.encodingName,!e)throw new Error("DBCS codec is called without the data.");if(!e.table)throw new Error("Encoding '"+this.encodingName+"' has no data.");var o=e.table();this.decodeTables=[],this.decodeTables[0]=UNASSIGNED_NODE.slice(0),this.decodeTableSeq=[];for(var r=0;r<o.length;r++)this._addDecodeChunk(o[r]);this.defaultCharUnicode=t.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var i={};if(e.encodeSkipVals)for(var r=0;r<e.encodeSkipVals.length;r++){var d=e.encodeSkipVals[r];if("number"==typeof d)i[d]=!0;else for(var n=d.from;n<=d.to;n++)i[n]=!0}if(this._fillEncodeTable(0,0,i),e.encodeAdd)for(var a in e.encodeAdd)Object.prototype.hasOwnProperty.call(e.encodeAdd,a)&&this._setEncodeChar(a.charCodeAt(0),e.encodeAdd[a]);if(this.defCharSB=this.encodeTable[0][t.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===UNASSIGNED&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===UNASSIGNED&&(this.defCharSB="?".charCodeAt(0)),"function"==typeof e.gb18030){this.gb18030=e.gb18030();for(var h=this.decodeTables.length,s=this.decodeTables[h]=UNASSIGNED_NODE.slice(0),c=this.decodeTables.length,l=this.decodeTables[c]=UNASSIGNED_NODE.slice(0),r=129;254>=r;r++)for(var S=NODE_START-this.decodeTables[0][r],f=this.decodeTables[S],n=48;57>=n;n++)f[n]=NODE_START-h;for(var r=129;254>=r;r++)s[r]=NODE_START-c;for(var r=48;57>=r;r++)l[r]=GB18030_CODE}}function DBCSEncoder(e,t){this.leadSurrogate=-1,this.seqObj=void 0,this.encodeTable=t.encodeTable,this.encodeTableSeq=t.encodeTableSeq,this.defaultCharSingleByte=t.defCharSB,this.gb18030=t.gb18030}function DBCSDecoder(e,t){this.nodeIdx=0,this.prevBuf=new Buffer(0),this.decodeTables=t.decodeTables,this.decodeTableSeq=t.decodeTableSeq,this.defaultCharUnicode=t.defaultCharUnicode,this.gb18030=t.gb18030}function findIdx(e,t){if(e[0]>t)return-1;for(var o=0,r=e.length;r-1>o;){var i=o+Math.floor((r-o+1)/2);e[i]<=t?o=i:r=i}return o}exports._dbcs=DBCSCodec;for(var UNASSIGNED=-1,GB18030_CODE=-2,SEQ_START=-10,NODE_START=-1e3,UNASSIGNED_NODE=new Array(256),DEF_CHAR=-1,i=0;256>i;i++)UNASSIGNED_NODE[i]=UNASSIGNED;DBCSCodec.prototype.encoder=DBCSEncoder,DBCSCodec.prototype.decoder=DBCSDecoder,DBCSCodec.prototype._getDecodeTrieNode=function(e){for(var t=[];e>0;e>>=8)t.push(255&e);0==t.length&&t.push(0);for(var o=this.decodeTables[0],r=t.length-1;r>0;r--){var i=o[t[r]];if(i==UNASSIGNED)o[t[r]]=NODE_START-this.decodeTables.length,this.decodeTables.push(o=UNASSIGNED_NODE.slice(0));else{if(!(NODE_START>=i))throw new Error("Overwrite byte in "+this.encodingName+", addr: "+e.toString(16));o=this.decodeTables[NODE_START-i]}}return o},DBCSCodec.prototype._addDecodeChunk=function(e){var t=parseInt(e[0],16),o=this._getDecodeTrieNode(t);t=255&t;for(var r=1;r<e.length;r++){var i=e[r];if("string"==typeof i)for(var d=0;d<i.length;){var n=i.charCodeAt(d++);if(n>=55296&&56320>n){var a=i.charCodeAt(d++);if(!(a>=56320&&57344>a))throw new Error("Incorrect surrogate pair in "+this.encodingName+" at chunk "+e[0]);o[t++]=65536+1024*(n-55296)+(a-56320)}else if(n>4080&&4095>=n){for(var h=4095-n+2,s=[],c=0;h>c;c++)s.push(i.charCodeAt(d++));o[t++]=SEQ_START-this.decodeTableSeq.length,this.decodeTableSeq.push(s)}else o[t++]=n}else{if("number"!=typeof i)throw new Error("Incorrect type '"+typeof i+"' given in "+this.encodingName+" at chunk "+e[0]);for(var l=o[t-1]+1,d=0;i>d;d++)o[t++]=l++}}if(t>255)throw new Error("Incorrect chunk in "+this.encodingName+" at addr "+e[0]+": too long"+t)},DBCSCodec.prototype._getEncodeBucket=function(e){var t=e>>8;return void 0===this.encodeTable[t]&&(this.encodeTable[t]=UNASSIGNED_NODE.slice(0)),this.encodeTable[t]},DBCSCodec.prototype._setEncodeChar=function(e,t){var o=this._getEncodeBucket(e),r=255&e;o[r]<=SEQ_START?this.encodeTableSeq[SEQ_START-o[r]][DEF_CHAR]=t:o[r]==UNASSIGNED&&(o[r]=t)},DBCSCodec.prototype._setEncodeSequence=function(e,t){var o,r=e[0],i=this._getEncodeBucket(r),d=255&r;i[d]<=SEQ_START?o=this.encodeTableSeq[SEQ_START-i[d]]:(o={},i[d]!==UNASSIGNED&&(o[DEF_CHAR]=i[d]),i[d]=SEQ_START-this.encodeTableSeq.length,this.encodeTableSeq.push(o));for(var n=1;n<e.length-1;n++){var a=o[r];"object"==typeof a?o=a:(o=o[r]={},void 0!==a&&(o[DEF_CHAR]=a))}r=e[e.length-1],o[r]=t},DBCSCodec.prototype._fillEncodeTable=function(e,t,o){for(var r=this.decodeTables[e],i=0;256>i;i++){var d=r[i],n=t+i;o[n]||(d>=0?this._setEncodeChar(d,n):NODE_START>=d?this._fillEncodeTable(NODE_START-d,n<<8,o):SEQ_START>=d&&this._setEncodeSequence(this.decodeTableSeq[SEQ_START-d],n))}},DBCSEncoder.prototype.write=function(e){for(var t=new Buffer(e.length*(this.gb18030?4:3)),o=this.leadSurrogate,r=this.seqObj,i=-1,d=0,n=0;;){if(-1===i){if(d==e.length)break;var a=e.charCodeAt(d++)}else{var a=i;i=-1}if(a>=55296&&57344>a)if(56320>a){if(-1===o){o=a;continue}o=a,a=UNASSIGNED}else-1!==o?(a=65536+1024*(o-55296)+(a-56320),o=-1):a=UNASSIGNED;else-1!==o&&(i=a,a=UNASSIGNED,o=-1);var h=UNASSIGNED;if(void 0!==r&&a!=UNASSIGNED){var s=r[a];if("object"==typeof s){r=s;continue}"number"==typeof s?h=s:void 0==s&&(s=r[DEF_CHAR],void 0!==s&&(h=s,i=a)),r=void 0}else if(a>=0){var c=this.encodeTable[a>>8];if(void 0!==c&&(h=c[255&a]),SEQ_START>=h){r=this.encodeTableSeq[SEQ_START-h];continue}if(h==UNASSIGNED&&this.gb18030){var l=findIdx(this.gb18030.uChars,a);if(-1!=l){var h=this.gb18030.gbChars[l]+(a-this.gb18030.uChars[l]);t[n++]=129+Math.floor(h/12600),h%=12600,t[n++]=48+Math.floor(h/1260),h%=1260,t[n++]=129+Math.floor(h/10),h%=10,t[n++]=48+h;continue}}}h===UNASSIGNED&&(h=this.defaultCharSingleByte),256>h?t[n++]=h:65536>h?(t[n++]=h>>8,t[n++]=255&h):(t[n++]=h>>16,t[n++]=h>>8&255,t[n++]=255&h)}return this.seqObj=r,this.leadSurrogate=o,t.slice(0,n)},DBCSEncoder.prototype.end=function(){if(-1!==this.leadSurrogate||void 0!==this.seqObj){var e=new Buffer(10),t=0;if(this.seqObj){var o=this.seqObj[DEF_CHAR];void 0!==o&&(256>o?e[t++]=o:(e[t++]=o>>8,e[t++]=255&o)),this.seqObj=void 0}return-1!==this.leadSurrogate&&(e[t++]=this.defaultCharSingleByte,this.leadSurrogate=-1),e.slice(0,t)}},DBCSEncoder.prototype.findIdx=findIdx,DBCSDecoder.prototype.write=function(e){var t,o=new Buffer(2*e.length),r=this.nodeIdx,i=this.prevBuf,d=this.prevBuf.length,n=-this.prevBuf.length;d>0&&(i=Buffer.concat([i,e.slice(0,10)]));for(var a=0,h=0;a<e.length;a++){var s=a>=0?e[a]:i[a+d],t=this.decodeTables[r][s];if(t>=0);else if(t===UNASSIGNED)a=n,t=this.defaultCharUnicode.charCodeAt(0);else if(t===GB18030_CODE){var c=n>=0?e.slice(n,a+1):i.slice(n+d,a+1+d),l=12600*(c[0]-129)+1260*(c[1]-48)+10*(c[2]-129)+(c[3]-48),S=findIdx(this.gb18030.gbChars,l);t=this.gb18030.uChars[S]+l-this.gb18030.gbChars[S]}else{if(NODE_START>=t){r=NODE_START-t;continue}if(!(SEQ_START>=t))throw new Error("iconv-lite internal error: invalid decoding table value "+t+" at "+r+"/"+s);for(var f=this.decodeTableSeq[SEQ_START-t],T=0;T<f.length-1;T++)t=f[T],o[h++]=255&t,o[h++]=t>>8;t=f[f.length-1]}if(t>65535){t-=65536;var E=55296+Math.floor(t/1024);o[h++]=255&E,o[h++]=E>>8,t=56320+t%1024}o[h++]=255&t,o[h++]=t>>8,r=0,n=a+1}return this.nodeIdx=r,this.prevBuf=n>=0?e.slice(n):i.slice(n+d),o.slice(0,h).toString("ucs2")},DBCSDecoder.prototype.end=function(){for(var e="";this.prevBuf.length>0;){e+=this.defaultCharUnicode;var t=this.prevBuf.slice(1);this.prevBuf=new Buffer(0),this.nodeIdx=0,t.length>0&&(e+=this.write(t))}return this.nodeIdx=0,e};