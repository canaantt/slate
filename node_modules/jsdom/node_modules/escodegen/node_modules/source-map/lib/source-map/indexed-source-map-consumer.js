/*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */
if("function"!=typeof define)var define=require("amdefine")(module,require);define(function(e,n,r){function t(e){var n=e;"string"==typeof e&&(n=JSON.parse(e.replace(/^\)\]\}'/,"")));var r=o.getArg(n,"version"),t=o.getArg(n,"sections");if(r!=this._version)throw new Error("Unsupported version: "+r);var i={line:-1,column:0};this._sections=t.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var n=o.getArg(e,"offset"),r=o.getArg(n,"line"),t=o.getArg(n,"column");if(r<i.line||r===i.line&&t<i.column)throw new Error("Section offsets must be ordered and non-overlapping.");return i=n,{generatedOffset:{generatedLine:r+1,generatedColumn:t+1},consumer:new s(o.getArg(e,"map"))}})}var o=e("./util"),i=e("./binary-search"),s=e("./source-map-consumer").SourceMapConsumer;e("./basic-source-map-consumer").BasicSourceMapConsumer;t.prototype=Object.create(s.prototype),t.prototype.constructor=s,t.prototype._version=3,Object.defineProperty(t.prototype,"sources",{get:function(){for(var e=[],n=0;n<this._sections.length;n++)for(var r=0;r<this._sections[n].consumer.sources.length;r++)e.push(this._sections[n].consumer.sources[r]);return e}}),t.prototype.originalPositionFor=function(e){var n={generatedLine:o.getArg(e,"line"),generatedColumn:o.getArg(e,"column")},r=i.search(n,this._sections,function(e,n){var r=e.generatedLine-n.generatedOffset.generatedLine;return r?r:e.generatedColumn-n.generatedOffset.generatedColumn}),t=this._sections[r];return t?t.consumer.originalPositionFor({line:n.generatedLine-(t.generatedOffset.generatedLine-1),column:n.generatedColumn-(t.generatedOffset.generatedLine===n.generatedLine?t.generatedOffset.generatedColumn-1:0)}):{source:null,line:null,column:null,name:null}},t.prototype.sourceContentFor=function(e,n){for(var r=0;r<this._sections.length;r++){var t=this._sections[r],o=t.consumer.sourceContentFor(e,!0);if(o)return o}if(n)return null;throw new Error('"'+e+'" is not in the SourceMap.')},t.prototype.generatedPositionFor=function(e){for(var n=0;n<this._sections.length;n++){var r=this._sections[n];if(-1!==r.consumer.sources.indexOf(o.getArg(e,"source"))){var t=r.consumer.generatedPositionFor(e);if(t){var i={line:t.line+(r.generatedOffset.generatedLine-1),column:t.column+(r.generatedOffset.generatedLine===t.line?r.generatedOffset.generatedColumn-1:0)};return i}}}return{line:null,column:null}},t.prototype._parseMappings=function(e,n){this.__generatedMappings=[],this.__originalMappings=[];for(var r=0;r<this._sections.length;r++)for(var t=this._sections[r],i=t.consumer._generatedMappings,s=0;s<i.length;s++){var a=i[r],u=a.source,g=t.consumer.sourceRoot;null!=u&&null!=g&&(u=o.join(g,u));var c={source:u,generatedLine:a.generatedLine+(t.generatedOffset.generatedLine-1),generatedColumn:a.column+(t.generatedOffset.generatedLine===a.generatedLine)?t.generatedOffset.generatedColumn-1:0,originalLine:a.originalLine,originalColumn:a.originalColumn,name:a.name};this.__generatedMappings.push(c),"number"==typeof c.originalLine&&this.__originalMappings.push(c)}this.__generatedMappings.sort(o.compareByGeneratedPositions),this.__originalMappings.sort(o.compareByOriginalPositions)},n.IndexedSourceMapConsumer=t});