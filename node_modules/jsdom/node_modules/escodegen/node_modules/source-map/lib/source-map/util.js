/*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */
if("function"!=typeof define)var define=require("amdefine")(module,require);define(function(e,n,r){function t(e,n,r){if(n in e)return e[n];if(3===arguments.length)return r;throw new Error('"'+n+'" is a required argument.')}function i(e){var n=e.match(g);return n?{scheme:n[1],auth:n[2],host:n[3],port:n[4],path:n[5]}:null}function a(e){var n="";return e.scheme&&(n+=e.scheme+":"),n+="//",e.auth&&(n+=e.auth+"@"),e.host&&(n+=e.host),e.port&&(n+=":"+e.port),e.path&&(n+=e.path),n}function o(e){var n=e,r=i(e);if(r){if(!r.path)return e;n=r.path}for(var t,o="/"===n.charAt(0),u=n.split(/\/+/),c=0,l=u.length-1;l>=0;l--)t=u[l],"."===t?u.splice(l,1):".."===t?c++:c>0&&(""===t?(u.splice(l+1,c),c=0):(u.splice(l,2),c--));return n=u.join("/"),""===n&&(n=o?"/":"."),r?(r.path=n,a(r)):n}function u(e,n){""===e&&(e="."),""===n&&(n=".");var r=i(n),t=i(e);if(t&&(e=t.path||"/"),r&&!r.scheme)return t&&(r.scheme=t.scheme),a(r);if(r||n.match(p))return n;if(t&&!t.host&&!t.path)return t.host=n,a(t);var u="/"===n.charAt(0)?n:o(e.replace(/\/+$/,"")+"/"+n);return t?(t.path=u,a(t)):u}function c(e,n){""===e&&(e="."),e=e.replace(/\/$/,"");var r=i(e);return"/"==n.charAt(0)&&r&&"/"==r.path?n.slice(1):0===n.indexOf(e+"/")?n.substr(e.length+1):n}function l(e){return"$"+e}function h(e){return e.substr(1)}function s(e,n){var r=e||"",t=n||"";return(r>t)-(t>r)}function f(e,n,r){var t;return(t=s(e.source,n.source))?t:(t=e.originalLine-n.originalLine)?t:(t=e.originalColumn-n.originalColumn,t||r?t:(t=s(e.name,n.name))?t:(t=e.generatedLine-n.generatedLine,t?t:e.generatedColumn-n.generatedColumn))}function m(e,n,r){var t;return(t=e.generatedLine-n.generatedLine)?t:(t=e.generatedColumn-n.generatedColumn,t||r?t:(t=s(e.source,n.source))?t:(t=e.originalLine-n.originalLine)?t:(t=e.originalColumn-n.originalColumn,t?t:s(e.name,n.name)))}n.getArg=t;var g=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,p=/^data:.+\,.+$/;n.urlParse=i,n.urlGenerate=a,n.normalize=o,n.join=u,n.relative=c,n.toSetString=l,n.fromSetString=h,n.compareByOriginalPositions=f,n.compareByGeneratedPositions=m});