/*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */
function define(e,i,n){if("string"!=typeof e)throw new TypeError("Expected string, got: "+e);if(2==arguments.length&&(n=i),e in define.modules)throw new Error("Module already defined: "+e);define.modules[e]=n}function Domain(){this.modules={},this._currentModule=null}define.modules={},function(){function e(e){for(var i=e.split("/"),n=1;n<i.length;)".."===i[n]?i.splice(n-1,1):"."===i[n]?i.splice(n,1):n++;return i.join("/")}function i(e,i){return e=e.trim(),i=i.trim(),/^\//.test(i)?i:e.replace(/\/*$/,"/")+i}function n(e){var i=e.split("/");return i.pop(),i.join("/")}Domain.prototype.require=function(e,i){if(Array.isArray(e)){var n=e.map(function(e){return this.lookup(e)},this);return void(i&&i.apply(null,n))}return this.lookup(e)},Domain.prototype.lookup=function(r){if(/^\./.test(r)&&(r=e(i(n(this._currentModule),r))),r in this.modules){var o=this.modules[r];return o}if(!(r in define.modules))throw new Error("Module not defined: "+r);var o=define.modules[r];if("function"==typeof o){var t={},u=this._currentModule;this._currentModule=r,o(this.require.bind(this),t,{id:r,uri:""}),this._currentModule=u,o=t}return this.modules[r]=o,o}}(),define.Domain=Domain,define.globalDomain=new Domain;var require=define.globalDomain.require.bind(define.globalDomain);