/*
 * Copyright 2011 Mozilla Foundation and contributors
 * Licensed under the New BSD license. See LICENSE or:
 * http://opensource.org/licenses/BSD-3-Clause
 */
if("function"!=typeof define)var define=require("amdefine")(module,require);define(function(e,o,n){var t=e("../../lib/source-map/source-map-consumer").SourceMapConsumer,r=e("../../lib/source-map/indexed-source-map-consumer").IndexedSourceMapConsumer,a=e("../../lib/source-map/basic-source-map-consumer").BasicSourceMapConsumer,s=e("../../lib/source-map/source-map-generator").SourceMapGenerator;o["test that we can instantiate with a string or an object"]=function(e,o){e.doesNotThrow(function(){new t(o.testMap)}),e.doesNotThrow(function(){new t(JSON.stringify(o.testMap))})},o["test that the object returned from new SourceMapConsumer inherits from SourceMapConsumer"]=function(e,o){e.ok(new t(o.testMap)instanceof t)},o["test that a BasicSourceMapConsumer is returned for sourcemaps without sections"]=function(e,o){e.ok(new t(o.testMap)instanceof a)},o["test that an IndexedSourceMapConsumer is returned for sourcemaps with sections"]=function(e,o){e.ok(new t(o.indexedTestMap)instanceof r)},o["test that the `sources` field has the original sources"]=function(e,o){var n,r;n=new t(o.testMap),r=n.sources,e.equal(r[0],"/the/root/one.js"),e.equal(r[1],"/the/root/two.js"),e.equal(r.length,2),n=new t(o.indexedTestMap),r=n.sources,e.equal(r[0],"/the/root/one.js"),e.equal(r[1],"/the/root/two.js"),e.equal(r.length,2),n=new t(o.indexedTestMapDifferentSourceRoots),r=n.sources,e.equal(r[0],"/the/root/one.js"),e.equal(r[1],"/different/root/two.js"),e.equal(r.length,2),n=new t(o.testMapNoSourceRoot),r=n.sources,e.equal(r[0],"one.js"),e.equal(r[1],"two.js"),e.equal(r.length,2),n=new t(o.testMapEmptySourceRoot),r=n.sources,e.equal(r[0],"one.js"),e.equal(r[1],"two.js"),e.equal(r.length,2)},o["test that the source root is reflected in a mapping's source field"]=function(e,o){var n,r;n=new t(o.testMap),r=n.originalPositionFor({line:2,column:1}),e.equal(r.source,"/the/root/two.js"),r=n.originalPositionFor({line:1,column:1}),e.equal(r.source,"/the/root/one.js"),n=new t(o.testMapNoSourceRoot),r=n.originalPositionFor({line:2,column:1}),e.equal(r.source,"two.js"),r=n.originalPositionFor({line:1,column:1}),e.equal(r.source,"one.js"),n=new t(o.testMapEmptySourceRoot),r=n.originalPositionFor({line:2,column:1}),e.equal(r.source,"two.js"),r=n.originalPositionFor({line:1,column:1}),e.equal(r.source,"one.js")},o["test mapping tokens back exactly"]=function(e,o){var n=new t(o.testMap);o.assertMapping(1,1,"/the/root/one.js",1,1,null,n,e),o.assertMapping(1,5,"/the/root/one.js",1,5,null,n,e),o.assertMapping(1,9,"/the/root/one.js",1,11,null,n,e),o.assertMapping(1,18,"/the/root/one.js",1,21,"bar",n,e),o.assertMapping(1,21,"/the/root/one.js",2,3,null,n,e),o.assertMapping(1,28,"/the/root/one.js",2,10,"baz",n,e),o.assertMapping(1,32,"/the/root/one.js",2,14,"bar",n,e),o.assertMapping(2,1,"/the/root/two.js",1,1,null,n,e),o.assertMapping(2,5,"/the/root/two.js",1,5,null,n,e),o.assertMapping(2,9,"/the/root/two.js",1,11,null,n,e),o.assertMapping(2,18,"/the/root/two.js",1,21,"n",n,e),o.assertMapping(2,21,"/the/root/two.js",2,3,null,n,e),o.assertMapping(2,28,"/the/root/two.js",2,10,"n",n,e)},o["test mapping tokens back exactly in indexed source map"]=function(e,o){var n=new t(o.indexedTestMap);o.assertMapping(1,1,"/the/root/one.js",1,1,null,n,e),o.assertMapping(1,5,"/the/root/one.js",1,5,null,n,e),o.assertMapping(1,9,"/the/root/one.js",1,11,null,n,e),o.assertMapping(1,18,"/the/root/one.js",1,21,"bar",n,e),o.assertMapping(1,21,"/the/root/one.js",2,3,null,n,e),o.assertMapping(1,28,"/the/root/one.js",2,10,"baz",n,e),o.assertMapping(1,32,"/the/root/one.js",2,14,"bar",n,e),o.assertMapping(2,1,"/the/root/two.js",1,1,null,n,e),o.assertMapping(2,5,"/the/root/two.js",1,5,null,n,e),o.assertMapping(2,9,"/the/root/two.js",1,11,null,n,e),o.assertMapping(2,18,"/the/root/two.js",1,21,"n",n,e),o.assertMapping(2,21,"/the/root/two.js",2,3,null,n,e),o.assertMapping(2,28,"/the/root/two.js",2,10,"n",n,e)},o["test mapping tokens back exactly"]=function(e,o){var n=new t(o.testMap);o.assertMapping(1,1,"/the/root/one.js",1,1,null,n,e),o.assertMapping(1,5,"/the/root/one.js",1,5,null,n,e),o.assertMapping(1,9,"/the/root/one.js",1,11,null,n,e),o.assertMapping(1,18,"/the/root/one.js",1,21,"bar",n,e),o.assertMapping(1,21,"/the/root/one.js",2,3,null,n,e),o.assertMapping(1,28,"/the/root/one.js",2,10,"baz",n,e),o.assertMapping(1,32,"/the/root/one.js",2,14,"bar",n,e),o.assertMapping(2,1,"/the/root/two.js",1,1,null,n,e),o.assertMapping(2,5,"/the/root/two.js",1,5,null,n,e),o.assertMapping(2,9,"/the/root/two.js",1,11,null,n,e),o.assertMapping(2,18,"/the/root/two.js",1,21,"n",n,e),o.assertMapping(2,21,"/the/root/two.js",2,3,null,n,e),o.assertMapping(2,28,"/the/root/two.js",2,10,"n",n,e)},o["test mapping tokens fuzzy"]=function(e,o){var n=new t(o.testMap);o.assertMapping(1,20,"/the/root/one.js",1,21,"bar",n,e,!0),o.assertMapping(1,30,"/the/root/one.js",2,10,"baz",n,e,!0),o.assertMapping(2,12,"/the/root/two.js",1,11,null,n,e,!0),o.assertMapping(1,18,"/the/root/one.js",1,22,"bar",n,e,null,!0),o.assertMapping(1,28,"/the/root/one.js",2,13,"baz",n,e,null,!0),o.assertMapping(2,9,"/the/root/two.js",1,16,null,n,e,null,!0)},o["test mapping tokens fuzzy in indexed source map"]=function(e,o){var n=new t(o.indexedTestMap);o.assertMapping(1,20,"/the/root/one.js",1,21,"bar",n,e,!0),o.assertMapping(1,30,"/the/root/one.js",2,10,"baz",n,e,!0),o.assertMapping(2,12,"/the/root/two.js",1,11,null,n,e,!0),o.assertMapping(1,18,"/the/root/one.js",1,22,"bar",n,e,null,!0),o.assertMapping(1,28,"/the/root/one.js",2,13,"baz",n,e,null,!0),o.assertMapping(2,9,"/the/root/two.js",1,16,null,n,e,null,!0)},o["test mappings and end of lines"]=function(e,o){var n=new s({file:"foo.js"});n.addMapping({original:{line:1,column:1},generated:{line:1,column:1},source:"bar.js"}),n.addMapping({original:{line:2,column:2},generated:{line:2,column:2},source:"bar.js"});var r=t.fromSourceMap(n);o.assertMapping(2,1,null,null,null,null,r,e,!0),o.assertMapping(1,1,"bar.js",2,1,null,r,e,null,!0)},o["test creating source map consumers with )]}' prefix"]=function(e,o){e.doesNotThrow(function(){new t(")]}'"+JSON.stringify(o.testMap))})},o["test eachMapping"]=function(e,o){var n;n=new t(o.testMap);var r=-(1/0),a=-(1/0);n.eachMapping(function(o){e.ok(o.generatedLine>=r),e.ok("/the/root/one.js"===o.source||"/the/root/two.js"===o.source),o.generatedLine===r?(e.ok(o.generatedColumn>=a),a=o.generatedColumn):(r=o.generatedLine,a=-(1/0))}),n=new t(o.testMapNoSourceRoot),n.eachMapping(function(o){e.ok("one.js"===o.source||"two.js"===o.source)}),n=new t(o.testMapEmptySourceRoot),n.eachMapping(function(o){e.ok("one.js"===o.source||"two.js"===o.source)})},o["test eachMapping for indexed source maps"]=function(e,o){var n=new t(o.indexedTestMap),r=-(1/0),a=-(1/0);n.eachMapping(function(n){e.ok(n.generatedLine>=r),n.source&&e.equal(n.source.indexOf(o.testMap.sourceRoot),0),n.generatedLine===r?(e.ok(n.generatedColumn>=a),a=n.generatedColumn):(r=n.generatedLine,a=-(1/0))})},o["test iterating over mappings in a different order"]=function(e,o){var n=new t(o.testMap),r=-(1/0),a=-(1/0),s="";n.eachMapping(function(o){e.ok(o.source>=s),o.source===s?(e.ok(o.originalLine>=r),o.originalLine===r?(e.ok(o.originalColumn>=a),a=o.originalColumn):(r=o.originalLine,a=-(1/0))):(s=o.source,r=-(1/0),a=-(1/0))},null,t.ORIGINAL_ORDER)},o["test iterating over mappings in a different order in indexed source maps"]=function(e,o){var n=new t(o.indexedTestMap),r=-(1/0),a=-(1/0),s="";n.eachMapping(function(o){e.ok(o.source>=s),o.source===s?(e.ok(o.originalLine>=r),o.originalLine===r?(e.ok(o.originalColumn>=a),a=o.originalColumn):(r=o.originalLine,a=-(1/0))):(s=o.source,r=-(1/0),a=-(1/0))},null,t.ORIGINAL_ORDER)},o["test that we can set the context for `this` in eachMapping"]=function(e,o){var n=new t(o.testMap),r={};n.eachMapping(function(){e.equal(this,r)},r)},o["test that we can set the context for `this` in eachMapping in indexed source maps"]=function(e,o){var n=new t(o.indexedTestMap),r={};n.eachMapping(function(){e.equal(this,r)},r)},o["test that the `sourcesContent` field has the original sources"]=function(e,o){var n=new t(o.testMapWithSourcesContent),r=n.sourcesContent;e.equal(r[0]," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(r[1]," TWO.inc = function (n) {\n   return n + 1;\n };"),e.equal(r.length,2)},o["test that we can get the original sources for the sources"]=function(e,o){var n=new t(o.testMapWithSourcesContent),r=n.sources;e.equal(n.sourceContentFor(r[0])," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(n.sourceContentFor(r[1])," TWO.inc = function (n) {\n   return n + 1;\n };"),e.equal(n.sourceContentFor("one.js")," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(n.sourceContentFor("two.js")," TWO.inc = function (n) {\n   return n + 1;\n };"),e["throws"](function(){n.sourceContentFor("")},Error),e["throws"](function(){n.sourceContentFor("/the/root/three.js")},Error),e["throws"](function(){n.sourceContentFor("three.js")},Error)},o["test that we can get the original source content with relative source paths"]=function(e,o){var n=new t(o.testMapRelativeSources),r=n.sources;e.equal(n.sourceContentFor(r[0])," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(n.sourceContentFor(r[1])," TWO.inc = function (n) {\n   return n + 1;\n };"),e.equal(n.sourceContentFor("one.js")," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(n.sourceContentFor("two.js")," TWO.inc = function (n) {\n   return n + 1;\n };"),e["throws"](function(){n.sourceContentFor("")},Error),e["throws"](function(){n.sourceContentFor("/the/root/three.js")},Error),e["throws"](function(){n.sourceContentFor("three.js")},Error)},o["test that we can get the original source content for the sources on an indexed source map"]=function(e,o){var n=new t(o.indexedTestMap),r=n.sources;e.equal(n.sourceContentFor(r[0])," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(n.sourceContentFor(r[1])," TWO.inc = function (n) {\n   return n + 1;\n };"),e.equal(n.sourceContentFor("one.js")," ONE.foo = function (bar) {\n   return baz(bar);\n };"),e.equal(n.sourceContentFor("two.js")," TWO.inc = function (n) {\n   return n + 1;\n };"),e["throws"](function(){n.sourceContentFor("")},Error),e["throws"](function(){n.sourceContentFor("/the/root/three.js")},Error),e["throws"](function(){n.sourceContentFor("three.js")},Error)},o["test sourceRoot + generatedPositionFor"]=function(e,o){var n=new s({sourceRoot:"foo/bar",file:"baz.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"bang.coffee"}),n.addMapping({original:{line:5,column:5},generated:{line:6,column:6},source:"bang.coffee"}),n=new t(n.toString());var r=n.generatedPositionFor({line:1,column:1,source:"bang.coffee"});e.equal(r.line,2),e.equal(r.column,2);var r=n.generatedPositionFor({line:1,column:1,source:"foo/bar/bang.coffee"});e.equal(r.line,2),e.equal(r.column,2)},o["test allGeneratedPositionsFor"]=function(e,o){var n=new s({file:"generated.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"foo.coffee"}),n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"bar.coffee"}),n.addMapping({original:{line:2,column:1},generated:{line:3,column:2},source:"bar.coffee"}),n.addMapping({original:{line:2,column:2},generated:{line:3,column:3},source:"bar.coffee"}),n.addMapping({original:{line:3,column:1},generated:{line:4,column:2},source:"bar.coffee"}),n=new t(n.toString());var r=n.allGeneratedPositionsFor({line:2,source:"bar.coffee"});e.equal(r.length,2),e.equal(r[0].line,3),e.equal(r[0].column,2),e.equal(r[1].line,3),e.equal(r[1].column,3)},o["test allGeneratedPositionsFor for line with no mappings"]=function(e,o){var n=new s({file:"generated.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"foo.coffee"}),n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"bar.coffee"}),n.addMapping({original:{line:3,column:1},generated:{line:4,column:2},source:"bar.coffee"}),n=new t(n.toString());var r=n.allGeneratedPositionsFor({line:2,source:"bar.coffee"});e.equal(r.length,0)},o["test allGeneratedPositionsFor source map with no mappings"]=function(e,o){var n=new s({file:"generated.js"});n=new t(n.toString());var r=n.allGeneratedPositionsFor({line:2,source:"bar.coffee"});e.equal(r.length,0)},o["test computeColumnSpans"]=function(e,o){var n=new s({file:"generated.js"});n.addMapping({original:{line:1,column:1},generated:{line:1,column:1},source:"foo.coffee"}),n.addMapping({original:{line:2,column:1},generated:{line:2,column:1},source:"foo.coffee"}),n.addMapping({original:{line:2,column:2},generated:{line:2,column:10},source:"foo.coffee"}),n.addMapping({original:{line:2,column:3},generated:{line:2,column:20},source:"foo.coffee"}),n.addMapping({original:{line:3,column:1},generated:{line:3,column:1},source:"foo.coffee"}),n.addMapping({original:{line:3,column:2},generated:{line:3,column:2},source:"foo.coffee"}),n=new t(n.toString()),n.computeColumnSpans();var r=n.allGeneratedPositionsFor({line:1,source:"foo.coffee"});e.equal(r.length,1),e.equal(r[0].lastColumn,1/0);var r=n.allGeneratedPositionsFor({line:2,source:"foo.coffee"});e.equal(r.length,3),e.equal(r[0].lastColumn,9),e.equal(r[1].lastColumn,19),e.equal(r[2].lastColumn,1/0);var r=n.allGeneratedPositionsFor({line:3,source:"foo.coffee"});e.equal(r.length,2),e.equal(r[0].lastColumn,1),e.equal(r[1].lastColumn,1/0)},o["test sourceRoot + originalPositionFor"]=function(e,o){var n=new s({sourceRoot:"foo/bar",file:"baz.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"bang.coffee"}),n=new t(n.toString());var r=n.originalPositionFor({line:2,column:2});e.equal(r.source,"foo/bar/bang.coffee"),e.equal(r.line,1),e.equal(r.column,1)},o["test github issue #56"]=function(e,o){var n=new s({sourceRoot:"http://",file:"www.example.com/foo.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"www.example.com/original.js"}),n=new t(n.toString());var r=n.sources;e.equal(r.length,1),e.equal(r[0],"http://www.example.com/original.js")},o["test github issue #43"]=function(e,o){var n=new s({sourceRoot:"http://example.com",file:"foo.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"http://cdn.example.com/original.js"}),n=new t(n.toString());var r=n.sources;e.equal(r.length,1,"Should only be one source."),e.equal(r[0],"http://cdn.example.com/original.js","Should not be joined with the sourceRoot.")},o["test absolute path, but same host sources"]=function(e,o){var n=new s({sourceRoot:"http://example.com/foo/bar",file:"foo.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"/original.js"}),n=new t(n.toString());var r=n.sources;e.equal(r.length,1,"Should only be one source."),e.equal(r[0],"http://example.com/original.js","Source should be relative the host of the source root.")},o["test indexed source map errors when sections are out of order by line"]=function(e,o){var n=JSON.parse(JSON.stringify(o.indexedTestMap));n.sections[0].offset={line:2,column:0},e["throws"](function(){new t(n)},Error)},o["test github issue #64"]=function(e,o){var n=new t({version:3,file:"foo.js",sourceRoot:"http://example.com/",sources:["/a"],names:[],mappings:"AACA",sourcesContent:["foo"]});e.equal(n.sourceContentFor("a"),"foo"),e.equal(n.sourceContentFor("/a"),"foo")},o["test bug 885597"]=function(e,o){var n=new t({version:3,file:"foo.js",sourceRoot:"file:///Users/AlGore/Invented/The/Internet/",sources:["/a"],names:[],mappings:"AACA",sourcesContent:["foo"]}),r=n.sources[0];e.equal(n.sourceContentFor(r),"foo")},o["test github issue #72, duplicate sources"]=function(e,o){var n=new t({version:3,file:"foo.js",sources:["source1.js","source1.js","source3.js"],names:[],mappings:";EAAC;;IAEE;;MEEE",sourceRoot:"http://example.com"}),r=n.originalPositionFor({line:2,column:2});e.equal(r.source,"http://example.com/source1.js"),e.equal(r.line,1),e.equal(r.column,1);var r=n.originalPositionFor({line:4,column:4});e.equal(r.source,"http://example.com/source1.js"),e.equal(r.line,3),e.equal(r.column,3);var r=n.originalPositionFor({line:6,column:6});e.equal(r.source,"http://example.com/source3.js"),e.equal(r.line,5),e.equal(r.column,5)},o["test github issue #72, duplicate names"]=function(e,o){var n=new t({version:3,file:"foo.js",sources:["source.js"],names:["name1","name1","name3"],mappings:";EAACA;;IAEEA;;MAEEE",sourceRoot:"http://example.com"}),r=n.originalPositionFor({line:2,column:2});e.equal(r.name,"name1"),e.equal(r.line,1),e.equal(r.column,1);var r=n.originalPositionFor({line:4,column:4});e.equal(r.name,"name1"),e.equal(r.line,3),e.equal(r.column,3);var r=n.originalPositionFor({line:6,column:6});e.equal(r.name,"name3"),e.equal(r.line,5),e.equal(r.column,5)},o["test SourceMapConsumer.fromSourceMap"]=function(e,o){var n=new s({sourceRoot:"http://example.com/",file:"foo.js"});n.addMapping({original:{line:1,column:1},generated:{line:2,column:2},source:"bar.js"}),n.addMapping({original:{line:2,column:2},generated:{line:4,column:4},source:"baz.js",name:"dirtMcGirt"}),n.setSourceContent("baz.js","baz.js content");var r=t.fromSourceMap(n);e.equal(r.file,"foo.js"),e.equal(r.sourceRoot,"http://example.com/"),e.equal(r.sources.length,2),e.equal(r.sources[0],"http://example.com/bar.js"),e.equal(r.sources[1],"http://example.com/baz.js"),e.equal(r.sourceContentFor("baz.js"),"baz.js content");var a=r.originalPositionFor({line:2,column:2});e.equal(a.line,1),e.equal(a.column,1),e.equal(a.source,"http://example.com/bar.js"),e.equal(a.name,null),a=r.generatedPositionFor({line:1,column:1,source:"http://example.com/bar.js"}),e.equal(a.line,2),e.equal(a.column,2),a=r.originalPositionFor({line:4,column:4}),e.equal(a.line,2),e.equal(a.column,2),e.equal(a.source,"http://example.com/baz.js"),e.equal(a.name,"dirtMcGirt"),a=r.generatedPositionFor({line:2,column:2,source:"http://example.com/baz.js"}),e.equal(a.line,4),e.equal(a.column,4)}});