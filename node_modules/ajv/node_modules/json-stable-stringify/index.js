var json="undefined"!=typeof JSON?JSON:require("jsonify");module.exports=function(r,n){n||(n={}),"function"==typeof n&&(n={cmp:n});var e=n.space||"";"number"==typeof e&&(e=Array(e+1).join(" "));var t="boolean"==typeof n.cycles?n.cycles:!1,o=n.replacer||function(r,n){return n},i=n.cmp&&function(r){return function(n){return function(e,t){var o={key:e,value:n[e]},i={key:t,value:n[t]};return r(o,i)}}}(n.cmp),u=[];return function c(r,n,f,a){var y=e?"\n"+new Array(a+1).join(e):"",s=e?": ":":";if(f&&f.toJSON&&"function"==typeof f.toJSON&&(f=f.toJSON()),f=o.call(r,n,f),void 0!==f){if("object"!=typeof f||null===f)return json.stringify(f);if(isArray(f)){for(var l=[],p=0;p<f.length;p++){var v=c(f,p,f[p],a+1)||json.stringify(null);l.push(y+e+v)}return"["+l.join(",")+y+"]"}if(-1!==u.indexOf(f)){if(t)return json.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}u.push(f);for(var j=objectKeys(f).sort(i&&i(f)),l=[],p=0;p<j.length;p++){var n=j[p],O=c(f,n,f[n],a+1);if(O){var b=json.stringify(n)+s+O;l.push(y+e+b)}}return u.splice(u.indexOf(f),1),"{"+l.join(",")+y+"}"}}({"":r},"",r,0)};var isArray=Array.isArray||function(r){return"[object Array]"==={}.toString.call(r)},objectKeys=Object.keys||function(r){var n=Object.prototype.hasOwnProperty||function(){return!0},e=[];for(var t in r)n.call(r,t)&&e.push(t);return e};