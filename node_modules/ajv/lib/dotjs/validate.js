"use strict";module.exports=function(e,r){function a(e){for(var r=0;r<e.rules.length;r++)if(t(e.rules[r]))return!0}function t(r){return void 0!==e.schema[r.keyword]||"properties"==r.keyword&&(e.schema.additionalProperties===!1||"object"==typeof e.schema.additionalProperties||e.schema.patternProperties&&Object.keys(e.schema.patternProperties).length||e.opts.v5&&e.schema.patternGroups&&Object.keys(e.schema.patternGroups).length)}var s="",o=e.schema.$async===!0;if(e.isTop){var i=e.isTop,l=e.level=0,n=e.dataLevel=0,c="data";if(e.rootId=e.resolve.fullPath(e.root.schema.id),e.baseId=e.baseId||e.rootId,o){e.async=!0;var h="es7"==e.opts.async;e.yieldAwait=h?"await":"yield"}delete e.isTop,e.dataPathArr=[void 0],s+=" validate = ",o?h?s+=" (async function ":("co*"==e.opts.async&&(s+="co.wrap"),s+="(function* "):s+=" (function ",s+=" (data, dataPath, parentData, parentDataProperty) { 'use strict'; var vErrors = null; ",s+=" var errors = 0;     "}else{var l=e.level,n=e.dataLevel,c="data"+(n||"");if(e.schema.id&&(e.baseId=e.resolve.url(e.baseId,e.schema.id)),o&&!e.async)throw new Error("async schema in sync schema");s+=" var errs_"+l+" = errors;"}var p,d="valid"+l,f=!e.opts.allErrors,u="",v="",y=e.schema.type,m=Array.isArray(y);if(y&&e.opts.coerceTypes){var P=e.util.coerceToTypes(e.opts.coerceTypes,y);if(P){var g=e.schemaPath+".type",E=e.errSchemaPath+"/type",w=m?"checkDataTypes":"checkDataType";s+=" if ("+e.util[w](y,c,!0)+") {  ";var b="dataType"+l,k="coerced"+l;s+=" var "+b+" = typeof "+c+"; ","array"==e.opts.coerceTypes&&(s+=" if ("+b+" == 'object' && Array.isArray("+c+")) "+b+" = 'array'; "),s+=" var "+k+" = undefined; ";var T="",D=P;if(D)for(var j,S=-1,R=D.length-1;R>S;)j=D[S+=1],S&&(s+=" if ("+k+" === undefined) { ",T+="}"),"array"==e.opts.coerceTypes&&"array"!=j&&(s+=" if ("+b+" == 'array' && "+c+".length == 1) { "+k+" = "+c+" = "+c+"[0]; "+b+" = typeof "+c+";  } "),"string"==j?s+=" if ("+b+" == 'number' || "+b+" == 'boolean') "+k+" = '' + "+c+"; else if ("+c+" === null) "+k+" = ''; ":"number"==j||"integer"==j?(s+=" if ("+b+" == 'boolean' || "+c+" === null || ("+b+" == 'string' && "+c+" && "+c+" == +"+c+" ","integer"==j&&(s+=" && !("+c+" % 1)"),s+=")) "+k+" = +"+c+"; "):"boolean"==j?s+=" if ("+c+" === 'false' || "+c+" === 0 || "+c+" === null) "+k+" = false; else if ("+c+" === 'true' || "+c+" === 1) "+k+" = true; ":"null"==j?s+=" if ("+c+" === '' || "+c+" === 0 || "+c+" === false) "+k+" = null; ":"array"==e.opts.coerceTypes&&"array"==j&&(s+=" if ("+b+" == 'string' || "+b+" == 'number' || "+b+" == 'boolean' || "+c+" == null) "+k+" = ["+c+"]; ");s+=" "+T+" if ("+k+" === undefined) {   ";var A=A||[];A.push(s),s="",e.createErrors!==!1?(s+=" { keyword: '"+(p||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+' , schemaPath: "'+E+"\" , params: { type: '",s+=m?""+y.join(","):""+y,s+="' } ",e.opts.messages!==!1&&(s+=" , message: 'should be ",s+=m?""+y.join(","):""+y,s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),s+=" } "):s+=" {} ";var $=s;if(s=A.pop(),s+=!e.compositeRule&&f?e.async?" throw new ValidationError(["+$+"]); ":" validate.errors = ["+$+"]; return false; ":" var err = "+$+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } else { ",n){var I="data"+(n-1||""),x=e.dataPathArr[n];s+=" "+c+" = "+I+"["+x+"] = "+k+"; "}else s+=" data = "+k+"; if (parentData !== undefined) parentData[parentDataProperty] = "+k+"; ";s+=" } } "}}var L;if(e.schema.$ref&&(L=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"))){if("fail"==e.opts.extendRefs)throw new Error("$ref: validation keywords used in schema at "+e.errorPath);"ignore"==e.opts.extendRefs?(L=!1,console.log("$ref: keywords ignored in schema at path",e.errorPath)):console.log("$ref: all keywords used in schema at path",e.errorPath,"(it will change in the next major version, see issue #260)")}if(e.schema.$ref&&!L)s+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",f&&(s+=" } if (errors === ",s+=i?"0":"errs_"+l,s+=") { ",v+="}");else{var O=e.RULES;if(O)for(var U,V=-1,_=O.length-1;_>V;)if(U=O[V+=1],a(U)){if(U.type&&(s+=" if ("+e.util.checkDataType(U.type,c)+") { "),e.opts.useDefaults&&!e.compositeRule)if("object"==U.type&&e.schema.properties){var G=e.schema.properties,J=Object.keys(G),N=J;if(N)for(var C,H=-1,q=N.length-1;q>H;){C=N[H+=1];var z=G[C];if(void 0!==z["default"]){var B=c+e.util.getProperty(C);s+="  if ("+B+" === undefined) "+B+" = ",s+="shared"==e.opts.useDefaults?" "+e.useDefault(z["default"])+" ":" "+JSON.stringify(z["default"])+" ",s+="; "}}}else if("array"==U.type&&Array.isArray(e.schema.items)){var F=e.schema.items;if(F)for(var z,S=-1,K=F.length-1;K>S;)if(z=F[S+=1],void 0!==z["default"]){var B=c+"["+S+"]";s+="  if ("+B+" === undefined) "+B+" = ",s+="shared"==e.opts.useDefaults?" "+e.useDefault(z["default"])+" ":" "+JSON.stringify(z["default"])+" ",s+="; "}}var M=U.rules;if(M)for(var Q,W=-1,X=M.length-1;X>W;)Q=M[W+=1],t(Q)&&(s+=" "+Q.code(e,Q.keyword)+" ",f&&(u+="}"));if(f&&(s+=" "+u+" ",u=""),U.type&&(s+=" } ",y&&y===U.type)){var Y=!0;s+=" else { ";var g=e.schemaPath+".type",E=e.errSchemaPath+"/type",A=A||[];A.push(s),s="",e.createErrors!==!1?(s+=" { keyword: '"+(p||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+' , schemaPath: "'+E+"\" , params: { type: '",s+=m?""+y.join(","):""+y,s+="' } ",e.opts.messages!==!1&&(s+=" , message: 'should be ",s+=m?""+y.join(","):""+y,s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),s+=" } "):s+=" {} ";var $=s;s=A.pop(),s+=!e.compositeRule&&f?e.async?" throw new ValidationError(["+$+"]); ":" validate.errors = ["+$+"]; return false; ":" var err = "+$+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" } "}f&&(s+=" if (errors === ",s+=i?"0":"errs_"+l,s+=") { ",v+="}")}}if(y&&!Y&&(!e.opts.coerceTypes||!P)){var g=e.schemaPath+".type",E=e.errSchemaPath+"/type",w=m?"checkDataTypes":"checkDataType";s+=" if ("+e.util[w](y,c,!0)+") {   ";var A=A||[];A.push(s),s="",e.createErrors!==!1?(s+=" { keyword: '"+(p||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+' , schemaPath: "'+E+"\" , params: { type: '",s+=m?""+y.join(","):""+y,s+="' } ",e.opts.messages!==!1&&(s+=" , message: 'should be ",s+=m?""+y.join(","):""+y,s+="' "),e.opts.verbose&&(s+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),s+=" } "):s+=" {} ";var $=s;s=A.pop(),s+=!e.compositeRule&&f?e.async?" throw new ValidationError(["+$+"]); ":" validate.errors = ["+$+"]; return false; ":" var err = "+$+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",s+=" }"}return f&&(s+=" "+v+" "),i?(o?(s+=" if (errors === 0) return true;           ",s+=" else throw new ValidationError(vErrors); "):(s+=" validate.errors = vErrors; ",s+=" return errors === 0;       "),s+=" });"):s+=" var "+d+" = errors === errs_"+l+";",s=e.util.cleanUpCode(s),i&&f&&(s=e.util.cleanUpVarErrors(s,o)),s};