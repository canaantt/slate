"use strict";function setupAsync(e,n){n!==!1&&(n=!0);var r,t=e.async,o=e.transpile;switch(typeof o){case"string":var a=TRANSPILE[o];if(!a)throw new Error("bad transpiler: "+o);return e._transpileFunc=a(e,n);case"undefined":case"boolean":if("string"==typeof t){if(r=ASYNC[t],!r)throw new Error("bad async mode: "+t);return e.transpile=r(e,n)}for(var c=0;c<MODES.length;c++){var i=MODES[c];if(setupAsync(i,!1))return util.copy(i,e),e.transpile}throw new Error("generators, nodent and regenerator are not available");case"function":return e._transpileFunc=e.transpile;default:throw new Error("bad transpiler: "+o)}}function checkGenerators(opts,required){try{return eval("(function*(){})()"),!0}catch(e){if(required)throw new Error("generators not supported")}}function checkAsyncFunction(opts,required){try{return eval("(async function(){})()"),!0}catch(e){if(required)throw new Error("es7 async functions not supported")}}function getRegenerator(e,n){try{return regenerator||(regenerator=require("regenerator"),regenerator.runtime()),e.async&&e.async!==!0||(e.async="es7"),regeneratorTranspile}catch(r){if(n)throw new Error("regenerator not available")}}function regeneratorTranspile(e){return regenerator.compile(e).code}function getNodent(e,n){try{return nodent||(nodent=require("nodent")({log:!1,dontInstallRequireHook:!0})),"es7"!=e.async&&(e.async&&e.async!==!0&&console.warn("nodent transpiles only es7 async functions"),e.async="es7"),nodentTranspile}catch(r){if(n)throw new Error("nodent not available")}}function nodentTranspile(e){return nodent.compile(e,"",{promises:!0,sourcemap:!1}).code}function compileAsync(e,n){function r(e,n,t){function a(t){function a(t,a){if(t)return n(t);if(!o._refs[c]&&!o._schemas[c])try{o.addSchema(a,c)}catch(i){return void n(i)}r(e,n)}var c=t.missingSchema;if(o._refs[c]||o._schemas[c])return n(new Error("Schema "+c+" is loaded but "+t.missingRef+" cannot be resolved"));var i=o._loadingSchemas[c];i?"function"==typeof i?o._loadingSchemas[c]=[i,a]:i[i.length]=a:(o._loadingSchemas[c]=a,o._opts.loadSchema(c,function(e,n){var r=o._loadingSchemas[c];if(delete o._loadingSchemas[c],"function"==typeof r)r(e,n);else for(var t=0;t<r.length;t++)r[t](e,n)}))}function c(e,r){return t?void setTimeout(function(){n(e,r)}):n(e,r)}var i;try{i=o.compile(e)}catch(s){return void(s.missingSchema?a(s):c(s))}c(null,i)}var t,o=this;try{t=this._addSchema(e)}catch(a){return void setTimeout(function(){n(a)})}if(t.validate)setTimeout(function(){n(null,t.validate)});else{if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");r(e,n,!0)}}module.exports={setup:setupAsync,compile:compileAsync};var util=require("./compile/util"),ASYNC={"*":checkGenerators,"co*":checkGenerators,es7:checkAsyncFunction},TRANSPILE={nodent:getNodent,regenerator:getRegenerator},MODES=[{async:"co*"},{async:"es7",transpile:"nodent"},{async:"co*",transpile:"regenerator"}],regenerator,nodent;