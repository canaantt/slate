"use strict";function copy(e,r){r=r||{};for(var t in e)r[t]=e[t];return r}function checkDataType(e,r,t){var a=t?" !== ":" === ",n=t?" || ":" && ",c=t?"!":"",o=t?"":"!";switch(e){case"null":return r+a+"null";case"array":return c+"Array.isArray("+r+")";case"object":return"("+c+r+n+"typeof "+r+a+'"object"'+n+o+"Array.isArray("+r+"))";case"integer":return"(typeof "+r+a+'"number"'+n+o+"("+r+" % 1)"+n+r+a+r+")";default:return"typeof "+r+a+'"'+e+'"'}}function checkDataTypes(e,r){switch(e.length){case 1:return checkDataType(e[0],r,!0);default:var t="",a=toHash(e);a.array&&a.object&&(t=a["null"]?"(":"(!"+r+" || ",t+="typeof "+r+' !== "object")',delete a["null"],delete a.array,delete a.object),a.number&&delete a.integer;for(var n in a)t+=(t?" && ":"")+checkDataType(n,r,!0);return t}}function coerceToTypes(e,r){if(Array.isArray(r)){for(var t=[],a=0;a<r.length;a++){var n=r[a];COERCE_TO_TYPES[n]?t[t.length]=n:"array"===e&&"array"===n&&(t[t.length]=n)}if(t.length)return t}else{if(COERCE_TO_TYPES[r])return[r];if("array"===e&&"array"===r)return["array"]}}function toHash(e){for(var r={},t=0;t<e.length;t++)r[e[t]]=!0;return r}function getProperty(e){return"number"==typeof e?"["+e+"]":IDENTIFIER.test(e)?"."+e:"['"+escapeQuotes(e)+"']"}function escapeQuotes(e){return e.replace(SINGLE_QUOTE,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function ucs2length(e){for(var r,t=0,a=e.length,n=0;a>n;)t++,r=e.charCodeAt(n++),r>=55296&&56319>=r&&a>n&&(r=e.charCodeAt(n),56320==(64512&r)&&n++);return t}function varOccurences(e,r){r+="[^0-9]";var t=e.match(new RegExp(r,"g"));return t?t.length:0}function varReplace(e,r,t){return r+="([^0-9])",t=t.replace(/\$/g,"$$$$"),e.replace(new RegExp(r,"g"),t+"$1")}function cleanUpCode(e){return e.replace(EMPTY_ELSE,"").replace(EMPTY_IF_NO_ELSE,"").replace(EMPTY_IF_WITH_ELSE,"if (!($1))")}function cleanUpVarErrors(e,r){var t=e.match(ERRORS_REGEXP);return t&&2===t.length?r?e.replace(REMOVE_ERRORS_ASYNC,"").replace(RETURN_ASYNC,RETURN_TRUE_ASYNC):e.replace(REMOVE_ERRORS,"").replace(RETURN_VALID,RETURN_TRUE):e}function schemaHasRules(e,r){for(var t in e)if(r[t])return!0}function schemaHasRulesExcept(e,r,t){for(var a in e)if(a!=t&&r[a])return!0}function toQuotedString(e){return"'"+escapeQuotes(e)+"'"}function getPathExpr(e,r,t,a){var n=t?"'/' + "+r+(a?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):a?"'[' + "+r+" + ']'":"'[\\'' + "+r+" + '\\']'";return joinPaths(e,n)}function getPath(e,r,t){var a=toQuotedString(t?"/"+escapeJsonPointer(r):getProperty(r));return joinPaths(e,a)}function getData(e,r,t){var a=e.match(RELATIVE_JSON_POINTER);if(!a)throw new Error("Invalid relative JSON-pointer: "+e);var n=+a[1],c=a[2];if("#"==c){if(n>=r)throw new Error("Cannot access property/index "+n+" levels up, current level is "+r);return t[r-n]}if(n>r)throw new Error("Cannot access data "+n+" levels up, current level is "+r);var o="data"+(r-n||"");if(!c)return o;for(var s=o,u=c.split("/"),l=0;l<u.length;l++){var p=u[l];p&&(o+=getProperty(unescapeJsonPointer(p)),s+=" && "+o)}return s}function joinPaths(e,r){return'""'==e?r:(e+" + "+r).replace(/' \+ '/g,"")}function unescapeFragment(e){return unescapeJsonPointer(decodeURIComponent(e))}function escapeFragment(e){return encodeURIComponent(escapeJsonPointer(e))}function escapeJsonPointer(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function unescapeJsonPointer(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}module.exports={copy:copy,checkDataType:checkDataType,checkDataTypes:checkDataTypes,coerceToTypes:coerceToTypes,toHash:toHash,getProperty:getProperty,escapeQuotes:escapeQuotes,ucs2length:ucs2length,varOccurences:varOccurences,varReplace:varReplace,cleanUpCode:cleanUpCode,cleanUpVarErrors:cleanUpVarErrors,schemaHasRules:schemaHasRules,schemaHasRulesExcept:schemaHasRulesExcept,stableStringify:require("json-stable-stringify"),toQuotedString:toQuotedString,getPathExpr:getPathExpr,getPath:getPath,getData:getData,unescapeFragment:unescapeFragment,escapeFragment:escapeFragment,escapeJsonPointer:escapeJsonPointer};var COERCE_TO_TYPES=toHash(["string","number","integer","boolean","null"]),IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i,SINGLE_QUOTE=/'|\\/g,EMPTY_ELSE=/else\s*{\s*}/g,EMPTY_IF_NO_ELSE=/if\s*\([^)]+\)\s*\{\s*\}(?!\s*else)/g,EMPTY_IF_WITH_ELSE=/if\s*\(([^)]+)\)\s*\{\s*\}\s*else(?!\s*if)/g,ERRORS_REGEXP=/[^v\.]errors/g,REMOVE_ERRORS=/var errors = 0;|var vErrors = null;|validate.errors = vErrors;/g,REMOVE_ERRORS_ASYNC=/var errors = 0;|var vErrors = null;/g,RETURN_VALID="return errors === 0;",RETURN_TRUE="validate.errors = null; return true;",RETURN_ASYNC=/if \(errors === 0\) return true;\s*else throw new ValidationError\(vErrors\);/,RETURN_TRUE_ASYNC="return true;",RELATIVE_JSON_POINTER=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;