"use strict";function SCHEMA_URI_FORMAT_FUNC(e){return SCHEMA_URI_FORMAT.test(e)}function Ajv(e){function r(e,r){var t;if("string"==typeof e){if(t=c(e),!t)throw new Error('no schema with key or ref "'+e+'"')}else{var a=h(e);t=a.validate||u(a)}var s=t(r);return t.$async===!0?"*"==g._opts.async?co(s):s:(g.errors=t.errors,s)}function t(e,r){var t=h(e,void 0,r);return t.validate||u(t)}function a(e,r,t,s){if(Array.isArray(e))for(var o=0;o<e.length;o++)a(e[o],void 0,t,s);else r=resolve.normalizeId(r||e.id),A(r),g._schemas[r]=h(e,t,s,!0)}function s(e,r,t){a(e,r,t,!0)}function o(e,t){var a=e.$schema||g._opts.defaultMeta||i(),s=g._formats.uri;g._formats.uri="function"==typeof s?SCHEMA_URI_FORMAT_FUNC:SCHEMA_URI_FORMAT;var o;try{o=r(a,e)}finally{g._formats.uri=s}if(!o&&t){var c="schema is invalid: "+_();if("log"!=g._opts.validateSchema)throw new Error(c);console.error(c)}return o}function i(){var e=g._opts.meta;return g._opts.defaultMeta="object"==typeof e?e.id||e:g._opts.v5?v5.META_SCHEMA_ID:META_SCHEMA_ID,g._opts.defaultMeta}function c(e){var r=l(e);switch(typeof r){case"object":return r.validate||u(r);case"string":return c(r);case"undefined":return n(e)}}function n(e){var r=resolve.schema.call(g,{schema:{}},e);if(r){var t=r.schema,a=r.root,s=r.baseId,o=compileSchema.call(g,t,a,void 0,s);return g._fragments[e]=new SchemaObject({ref:e,fragment:!0,schema:t,root:a,baseId:s,validate:o}),o}}function l(e){return e=resolve.normalizeId(e),g._schemas[e]||g._refs[e]||g._fragments[e]}function f(e){if(e instanceof RegExp)return m(g._schemas,e),void m(g._refs,e);switch(typeof e){case"undefined":return m(g._schemas),m(g._refs),void g._cache.clear();case"string":var r=l(e);return r&&g._cache.del(r.jsonStr),delete g._schemas[e],void delete g._refs[e];case"object":var t=stableStringify(e);g._cache.del(t);var a=e.id;a&&(a=resolve.normalizeId(a),delete g._schemas[a],delete g._refs[a])}}function m(e,r){for(var t in e){var a=e[t];a.meta||r&&!r.test(t)||(g._cache.del(a.jsonStr),delete e[t])}}function h(e,r,t,a){if("object"!=typeof e)throw new Error("schema should be object");var s=stableStringify(e),i=g._cache.get(s);if(i)return i;a=a||g._opts.addUsedSchema!==!1;var c=resolve.normalizeId(e.id);c&&a&&A(c);var n,l=g._opts.validateSchema!==!1&&!r;l&&!(n=e.id&&e.id==e.$schema)&&o(e,!0);var f=resolve.ids.call(g,e),m=new SchemaObject({id:c,schema:e,localRefs:f,jsonStr:s,meta:t});return"#"!=c[0]&&a&&(g._refs[c]=m),g._cache.put(s,m),l&&n&&o(e,!0),m}function u(e,r){function t(){var r=e.validate,a=r.apply(null,arguments);return t.errors=r.errors,a}if(e.compiling)return e.validate=t,t.schema=e.schema,t.errors=null,t.root=r?r:t,e.schema.$async===!0&&(t.$async=!0),t;e.compiling=!0;var a;e.meta&&(a=g._opts,g._opts=g._metaOpts);var s;try{s=compileSchema.call(g,e.schema,r,e.localRefs)}finally{e.compiling=!1,e.meta&&(g._opts=a)}return e.validate=s,e.refs=s.refs,e.refVal=s.refVal,e.root=s.root,s}function _(e,r){if(e=e||g.errors,!e)return"No errors";r=r||{};for(var t=void 0===r.separator?", ":r.separator,a=void 0===r.dataVar?"data":r.dataVar,s="",o=0;o<e.length;o++){var i=e[o];i&&(s+=a+i.dataPath+" "+i.message+t)}return s.slice(0,-t.length)}function d(e,r){"string"==typeof r&&(r=new RegExp(r)),g._formats[e]=r}function v(){if(g._opts.meta!==!1){var e=require("./refs/json-schema-draft-04.json");s(e,META_SCHEMA_ID,!0),g._refs["http://json-schema.org/schema"]=META_SCHEMA_ID}}function p(){var e=g._opts.schemas;if(e)if(Array.isArray(e))a(e);else for(var r in e)a(e[r],r)}function y(){for(var e in g._opts.formats){var r=g._opts.formats[e];d(e,r)}}function A(e){if(g._schemas[e]||g._refs[e])throw new Error('schema with key or id "'+e+'" already exists')}function S(){for(var e=util.copy(g._opts),r=0;r<META_IGNORE_OPTIONS.length;r++)delete e[META_IGNORE_OPTIONS[r]];return e}if(!(this instanceof Ajv))return new Ajv(e);var g=this;e=this._opts=util.copy(e)||{},this._schemas={},this._refs={},this._fragments={},this._formats=formats(e.format),this._cache=e.cache||new Cache,this._loadingSchemas={},this._compilations=[],this.RULES=rules(),this.validate=r,this.compile=t,this.addSchema=a,this.addMetaSchema=s,this.validateSchema=o,this.getSchema=c,this.removeSchema=f,this.addFormat=d,this.errorsText=_,this._addSchema=h,this._compile=u,e.loopRequired=e.loopRequired||1/0,(e.async||e.transpile)&&async.setup(e),e.beautify===!0&&(e.beautify={indent_size:2}),"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.extendRefs&&(e.extendRefs=!0),this._metaOpts=S(),e.formats&&y(),v(),e.v5&&v5.enable(this),"object"==typeof e.meta&&s(e.meta),p()}var compileSchema=require("./compile"),resolve=require("./compile/resolve"),Cache=require("./cache"),SchemaObject=require("./compile/schema_obj"),stableStringify=require("json-stable-stringify"),formats=require("./compile/formats"),rules=require("./compile/rules"),v5=require("./v5"),util=require("./compile/util"),async=require("./async"),co=require("co");module.exports=Ajv,Ajv.prototype.compileAsync=async.compile,Ajv.prototype.addKeyword=require("./keyword"),Ajv.ValidationError=require("./compile/validation_error");var META_SCHEMA_ID="http://json-schema.org/draft-04/schema",SCHEMA_URI_FORMAT=/^(?:(?:[a-z][a-z0-9+-.]*:)?\/\/)?[^\s]*$/i,META_IGNORE_OPTIONS=["removeAdditional","useDefaults","coerceTypes"];