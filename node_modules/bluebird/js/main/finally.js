"use strict";module.exports=function(t,r,n){function i(){return this}function e(){throw this}function o(t){return function(){return t}}function u(t){return function(){throw t}}function s(t,r,n){var s;return s=l(r)?n?o(r):u(r):n?i:e,t._then(s,c,void 0,r,void 0)}function a(i){var e=this.promise,o=this.handler,u=e._isBound()?o.call(e._boundValue()):o();if(void 0!==u){var a=n(u,e);if(a instanceof t)return a=a._target(),s(a,i,e.isFulfilled())}return e.isRejected()?(r.e=i,r):i}function h(r){var i=this.promise,e=this.handler,o=i._isBound()?e.call(i._boundValue(),r):e(r);if(void 0!==o){var u=n(o,i);if(u instanceof t)return u=u._target(),s(u,r,!0)}return r}var f=require("./util.js"),l=f.isPrimitive,c=f.thrower;t.prototype._passThroughHandler=function(t,r){if("function"!=typeof t)return this.then();var n={promise:this,handler:t};return this._then(r?a:h,r?a:void 0,void 0,n,void 0)},t.prototype.lastly=t.prototype["finally"]=function(t){return this._passThroughHandler(t,!0)},t.prototype.tap=function(t){return this._passThroughHandler(t,!1)}};