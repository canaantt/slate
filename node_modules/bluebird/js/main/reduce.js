"use strict";module.exports=function(t,i,e,s,r){function c(i,e,c,n){this.constructor$(i),this._promise._captureStackTrace(),this._preservedValues=n===r?[]:null,this._zerothIsAccum=void 0===c,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var _=s(c,this._promise),a=!1,l=_ instanceof t;l&&(_=_._target(),_._isPending()?_._proxyPromiseArray(this,-1):_._isFulfilled()?(c=_._value(),this._gotAccum=!0):(this._reject(_._reason()),a=!0)),l||this._zerothIsAccum||(this._gotAccum=!0);var m=o();this._callback=null===m?e:m.bind(e),this._accum=c,a||h.invoke(u,this,void 0)}function u(){this._init$(void 0,-5)}function n(t,i,s,r){if("function"!=typeof i)return e("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var u=new c(t,i,s,r);return u.promise()}var o=t._getDomain,h=require("./async.js"),_=require("./util.js"),a=_.tryCatch,l=_.errorObj;_.inherits(c,i),c.prototype._init=function(){},c.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},c.prototype._promiseFulfilled=function(i,e){var r=this._values;r[e]=i;var c,u=this.length(),n=this._preservedValues,o=null!==n,h=this._gotAccum,_=this._valuesPhase;if(!_)for(_=this._valuesPhase=new Array(u),c=0;u>c;++c)_[c]=0;if(c=_[e],0===e&&this._zerothIsAccum?(this._accum=i,this._gotAccum=h=!0,_[e]=0===c?1:2):-1===e?(this._accum=i,this._gotAccum=h=!0):0===c?_[e]=1:(_[e]=2,this._accum=i),h){for(var m,p=this._callback,f=this._promise._boundValue(),d=this._reducingIndex;u>d;++d)if(c=_[d],2!==c){if(1!==c)return;if(i=r[d],this._promise._pushContext(),o?(n.push(i),m=a(p).call(f,i,d,u)):m=a(p).call(f,this._accum,i,d,u),this._promise._popContext(),m===l)return this._reject(m.e);var v=s(m,this._promise);if(v instanceof t){if(v=v._target(),v._isPending())return _[d]=4,v._proxyPromiseArray(this,d);if(!v._isFulfilled())return this._reject(v._reason());m=v._value()}this._reducingIndex=d+1,this._accum=m}else this._reducingIndex=d+1;this._resolve(o?n:this._accum)}},t.prototype.reduce=function(t,i){return n(this,t,i,null)},t.reduce=function(t,i,e,s){return n(t,i,e,s)}};