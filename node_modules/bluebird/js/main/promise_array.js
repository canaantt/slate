"use strict";module.exports=function(e,t,i,s){function r(e){switch(e){case-2:return[];case-3:return{}}}function o(i){var s,r=this._promise=new e(t);i instanceof e&&(s=i,r._propagateFrom(s,5)),this._values=i,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var n=require("./util.js"),l=n.isArray;return o.prototype.length=function(){return this._length},o.prototype.promise=function(){return this._promise},o.prototype._init=function _(t,o){var n=i(this._values,this._promise);if(n instanceof e){if(n=n._target(),this._values=n,!n._isFulfilled())return n._isPending()?void n._then(_,this._reject,void 0,this,o):void this._reject(n._reason());if(n=n._value(),!l(n)){var h=new e.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(h)}}else if(!l(n))return void this._promise._reject(s("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")._reason());if(0===n.length)return void(-5===o?this._resolveEmptyArray():this._resolve(r(o)));var a=this.getActualLength(n.length);this._length=a,this._values=this.shouldCopyValues()?new Array(a):this._values;for(var u=this._promise,p=0;a>p;++p){var c=this._isResolved(),v=i(n[p],u);v instanceof e?(v=v._target(),c?v._ignoreRejections():v._isPending()?v._proxyPromiseArray(this,p):v._isFulfilled()?this._promiseFulfilled(v._value(),p):this._promiseRejected(v._reason(),p)):c||this._promiseFulfilled(v,p)}},o.prototype._isResolved=function(){return null===this._values},o.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},o.prototype.__hardReject__=o.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1,!0)},o.prototype._promiseProgressed=function(e,t){this._promise._progress({index:t,value:e})},o.prototype._promiseFulfilled=function(e,t){this._values[t]=e;var i=++this._totalResolved;i>=this._length&&this._resolve(this._values)},o.prototype._promiseRejected=function(e,t){this._totalResolved++,this._reject(e)},o.prototype.shouldCopyValues=function(){return!0},o.prototype.getActualLength=function(e){return e},o};