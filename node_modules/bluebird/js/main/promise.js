"use strict";module.exports=function(){function e(t){if("function"!=typeof t)throw new c("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==e)throw new c("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,t!==h&&this._resolveFromResolver(t)}function t(t){var i=new e(h);i._fulfillmentHandler0=t,i._rejectionHandler0=t,i._progressHandler0=t,i._promise0=t,i._receiver0=t,i._settledValue=t}var i,r=function(){return new c("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},o=function(){return new e.PromiseInspection(this._target())},n=function(t){return e.reject(new c(t))},s=require("./util.js");i=s.isNode?function(){var e=process.domain;return void 0===e&&(e=null),e}:function(){return null},s.notEnumerableProp(e,"_getDomain",i);var l={},u=require("./async.js"),a=require("./errors.js"),c=e.TypeError=a.TypeError;e.RangeError=a.RangeError,e.CancellationError=a.CancellationError,e.TimeoutError=a.TimeoutError,e.OperationalError=a.OperationalError,e.RejectionError=a.OperationalError,e.AggregateError=a.AggregateError;var h=function(){},_={},d={e:null},p=require("./thenables.js")(e,h),f=require("./promise_array.js")(e,h,p,n),v=require("./captured_trace.js")(),g=require("./debuggability.js")(e,v),y=require("./context.js")(e,v,g),j=require("./catch_filter.js")(d),m=require("./promise_resolver.js"),b=m._nodebackForPromise,F=s.errorObj,k=s.tryCatch;return e.prototype.toString=function(){return"[object Promise]"},e.prototype.caught=e.prototype["catch"]=function(t){var i=arguments.length;if(i>1){var r,o=new Array(i-1),n=0;for(r=0;i-1>r;++r){var s=arguments[r];if("function"!=typeof s)return e.reject(new c("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"));o[n++]=s}o.length=n,t=arguments[r];var l=new j(o,t,this);return this._then(void 0,l.doFilter,void 0,l,void 0)}return this._then(void 0,t,void 0,void 0,void 0)},e.prototype.reflect=function(){return this._then(o,o,void 0,this,void 0)},e.prototype.then=function(e,t,i){if(g()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var r=".then() only accepts functions but was passed: "+s.classString(e);arguments.length>1&&(r+=", "+s.classString(t)),this._warn(r)}return this._then(e,t,i,void 0,void 0)},e.prototype.done=function(e,t,i){var r=this._then(e,t,i,void 0,void 0);r._setIsFinal()},e.prototype.spread=function(e,t){return this.all()._then(e,t,void 0,_,void 0)},e.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},e.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},e.prototype.all=function(){return new f(this).promise()},e.prototype.error=function(e){return this.caught(s.originatesFromRejection,e)},e.is=function(t){return t instanceof e},e.fromNode=function(t){var i=new e(h),r=k(t)(b(i));return r===F&&i._rejectCallback(r.e,!0,!0),i},e.all=function(e){return new f(e).promise()},e.defer=e.pending=function(){var t=new e(h);return new m(t)},e.cast=function(t){var i=p(t);if(!(i instanceof e)){var r=i;i=new e(h),i._fulfillUnchecked(r)}return i},e.resolve=e.fulfilled=e.cast,e.reject=e.rejected=function(t){var i=new e(h);return i._captureStackTrace(),i._rejectCallback(t,!0),i},e.setScheduler=function(e){if("function"!=typeof e)throw new c("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var t=u._schedule;return u._schedule=e,t},e.prototype._then=function(t,r,o,n,s){var l=void 0!==s,a=l?s:new e(h);l||(a._propagateFrom(this,5),a._captureStackTrace());var c=this._target();c!==this&&(void 0===n&&(n=this._boundTo),l||a._setIsMigrated());var _=c._addCallbacks(t,r,o,a,n,i());return c._isResolved()&&!c._isSettlePromisesQueued()&&u.invoke(c._settlePromiseAtPostResolution,c,_),a},e.prototype._settlePromiseAtPostResolution=function(e){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(e)},e.prototype._length=function(){return 131071&this._bitField},e.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},e.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},e.prototype._setLength=function(e){this._bitField=-131072&this._bitField|131071&e},e.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},e.prototype._setRejected=function(){this._bitField=134217728|this._bitField},e.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},e.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},e.prototype._isFinal=function(){return(33554432&this._bitField)>0},e.prototype._cancellable=function(){return(67108864&this._bitField)>0},e.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},e.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},e.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},e.prototype._unsetIsMigrated=function(){this._bitField=-4194305&this._bitField},e.prototype._isMigrated=function(){return(4194304&this._bitField)>0},e.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[5*e-5+4];return t===l?void 0:void 0===t&&this._isBound()?this._boundValue():t},e.prototype._promiseAt=function(e){return 0===e?this._promise0:this[5*e-5+3]},e.prototype._fulfillmentHandlerAt=function(e){return 0===e?this._fulfillmentHandler0:this[5*e-5+0]},e.prototype._rejectionHandlerAt=function(e){return 0===e?this._rejectionHandler0:this[5*e-5+1]},e.prototype._boundValue=function(){var t=this._boundTo;return void 0!==t&&t instanceof e?t.isFulfilled()?t.value():void 0:t},e.prototype._migrateCallbacks=function(t,i){var r=t._fulfillmentHandlerAt(i),o=t._rejectionHandlerAt(i),n=t._progressHandlerAt(i),s=t._promiseAt(i),u=t._receiverAt(i);s instanceof e&&s._setIsMigrated(),void 0===u&&(u=l),this._addCallbacks(r,o,n,s,u,null)},e.prototype._addCallbacks=function(e,t,i,r,o,n){var s=this._length();if(s>=131066&&(s=0,this._setLength(0)),0===s)this._promise0=r,void 0!==o&&(this._receiver0=o),"function"!=typeof e||this._isCarryingStackTrace()||(this._fulfillmentHandler0=null===n?e:n.bind(e)),"function"==typeof t&&(this._rejectionHandler0=null===n?t:n.bind(t)),"function"==typeof i&&(this._progressHandler0=null===n?i:n.bind(i));else{var l=5*s-5;this[l+3]=r,this[l+4]=o,"function"==typeof e&&(this[l+0]=null===n?e:n.bind(e)),"function"==typeof t&&(this[l+1]=null===n?t:n.bind(t)),"function"==typeof i&&(this[l+2]=null===n?i:n.bind(i))}return this._setLength(s+1),s},e.prototype._setProxyHandlers=function(e,t){var i=this._length();if(i>=131066&&(i=0,this._setLength(0)),0===i)this._promise0=t,this._receiver0=e;else{var r=5*i-5;this[r+3]=t,this[r+4]=e}this._setLength(i+1)},e.prototype._proxyPromiseArray=function(e,t){this._setProxyHandlers(e,t)},e.prototype._resolveCallback=function(t,i){if(!this._isFollowingOrFulfilledOrRejected()){if(t===this)return this._rejectCallback(r(),!1,!0);var o=p(t,this);if(!(o instanceof e))return this._fulfill(t);var n=1|(i?4:0);this._propagateFrom(o,n);var s=o._target();if(s._isPending()){for(var l=this._length(),u=0;l>u;++u)s._migrateCallbacks(this,u);this._setFollowing(),this._setLength(0),this._setFollowee(s)}else s._isFulfilled()?this._fulfillUnchecked(s._value()):this._rejectUnchecked(s._reason(),s._getCarriedStackTrace())}},e.prototype._rejectCallback=function(e,t,i){i||s.markAsOriginatingFromRejection(e);var r=s.ensureErrorObject(e),o=r===e;this._attachExtraTrace(r,t?o:!1),this._reject(e,o?void 0:r)},e.prototype._resolveFromResolver=function(e){var t=this;this._captureStackTrace(),this._pushContext();var i=!0,r=k(e)(function(e){null!==t&&(t._resolveCallback(e),t=null)},function(e){null!==t&&(t._rejectCallback(e,i),t=null)});i=!1,this._popContext(),void 0!==r&&r===F&&null!==t&&(t._rejectCallback(r.e,!0,!0),t=null)},e.prototype._settlePromiseFromHandler=function(e,t,i,o){if(!o._isRejected()){o._pushContext();var n;if(n=t!==_||this._isRejected()?k(e).call(t,i):k(e).apply(this._boundValue(),i),o._popContext(),n===F||n===o||n===d){var s=n===o?r():n.e;o._rejectCallback(s,!1,!0)}else o._resolveCallback(n)}},e.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},e.prototype._followee=function(){return this._rejectionHandler0},e.prototype._setFollowee=function(e){this._rejectionHandler0=e},e.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},e.prototype._propagateFrom=function(e,t){(1&t)>0&&e._cancellable()&&(this._setCancellable(),this._cancellationParent=e),(4&t)>0&&e._isBound()&&this._setBoundTo(e._boundTo)},e.prototype._fulfill=function(e){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(e)},e.prototype._reject=function(e,t){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(e,t)},e.prototype._settlePromiseAt=function(t){var i=this._promiseAt(t),r=i instanceof e;if(r&&i._isMigrated())return i._unsetIsMigrated(),u.invoke(this._settlePromiseAt,this,t);var o=this._isFulfilled()?this._fulfillmentHandlerAt(t):this._rejectionHandlerAt(t),n=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,s=this._settledValue,l=this._receiverAt(t);this._clearCallbackDataAtIndex(t),"function"==typeof o?r?this._settlePromiseFromHandler(o,l,s,i):o.call(l,s,i):l instanceof f?l._isResolved()||(this._isFulfilled()?l._promiseFulfilled(s,i):l._promiseRejected(s,i)):r&&(this._isFulfilled()?i._fulfill(s):i._reject(s,n)),t>=4&&4===(31&t)&&u.invokeLater(this._setLength,this,0)},e.prototype._clearCallbackDataAtIndex=function(e){if(0===e)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var t=5*e-5;this[t+3]=this[t+4]=this[t+0]=this[t+1]=this[t+2]=void 0}},e.prototype._isSettlePromisesQueued=function(){return-1073741824===(-1073741824&this._bitField)},e.prototype._setSettlePromisesQueued=function(){this._bitField=-1073741824|this._bitField},e.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},e.prototype._queueSettlePromises=function(){u.settlePromises(this),this._setSettlePromisesQueued()},e.prototype._fulfillUnchecked=function(e){if(e===this){var t=r();return this._attachExtraTrace(t),this._rejectUnchecked(t,void 0)}this._setFulfilled(),this._settledValue=e,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},e.prototype._rejectUncheckedCheckError=function(e){var t=s.ensureErrorObject(e);this._rejectUnchecked(e,t===e?void 0:t)},e.prototype._rejectUnchecked=function(e,t){if(e===this){var i=r();return this._attachExtraTrace(i),this._rejectUnchecked(i)}return this._setRejected(),this._settledValue=e,this._cleanValues(),this._isFinal()?void u.throwLater(function(e){throw"stack"in e&&u.invokeFirst(v.unhandledRejection,void 0,e),e},void 0===t?e:t):(void 0!==t&&t!==e&&this._setCarriedStackTrace(t),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},e.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var e=this._length(),t=0;e>t;t++)this._settlePromiseAt(t)},s.notEnumerableProp(e,"_makeSelfResolutionError",r),require("./progress.js")(e,f),require("./method.js")(e,h,p,n),require("./bind.js")(e,h,p),require("./finally.js")(e,d,p),require("./direct_resolve.js")(e),require("./synchronous_inspection.js")(e),require("./join.js")(e,f,p,h),e.Promise=e,require("./map.js")(e,f,n,p,h),require("./cancel.js")(e),require("./using.js")(e,n,p,y),require("./generators.js")(e,n,h,p),require("./nodeify.js")(e),require("./call_get.js")(e),require("./props.js")(e,f,p,n),require("./race.js")(e,h,p,n),require("./reduce.js")(e,f,n,p,h),require("./settle.js")(e,f),require("./some.js")(e,f,n),require("./promisify.js")(e,h),require("./any.js")(e),require("./each.js")(e,h),require("./timers.js")(e,h),require("./filter.js")(e,h),s.toFastProperties(e),s.toFastProperties(e.prototype),t({a:1}),t({b:2}),t({c:3}),t(1),t(function(){}),t(void 0),t(!1),t(new e(h)),v.setBounds(u.firstLineError,s.lastLineError),e};