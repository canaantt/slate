function log(e){console.log(),console.log(require("util").inspect(e,!1,1e3))}var mpath=require("../"),assert=require("assert"),special="_doc";describe("mpath",function(){function e(){var e={first:{second:{third:[3,{name:"aaron"},9]}}};return e.comments=[{name:"one"},{name:"two",_doc:{name:"2"}},{name:"three",comments:[{},{comments:[{val:"twoo"}]}],_doc:{name:"3",comments:[{},{_doc:{comments:[{val:2}]}}]}}],e.name="jiro",e.array=[{o:{array:[{x:{b:[4,6,8]}},{y:10}]}},{o:{array:[{x:{b:[1,2,3]}},{x:{z:10}},{x:{b:"hi"}}]}},{o:{array:[{x:{b:null}},{x:{b:[null,1]}}]}},{o:{array:[{x:null}]}},{o:{array:[{y:3}]}},{o:{array:[3,0,null]}},{o:{name:"ha"}}],e.arr=[{arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:!0}],e}describe("get",function(){var a=e();it("`path` must be a string or array",function(e){assert["throws"](function(){mpath.get({},a)},/Must be either string or array/),assert["throws"](function(){mpath.get(4,a)},/Must be either string or array/),assert["throws"](function(){mpath.get(function(){},a)},/Must be either string or array/),assert["throws"](function(){mpath.get(/asdf/,a)},/Must be either string or array/),assert["throws"](function(){mpath.get(Math,a)},/Must be either string or array/),assert["throws"](function(){mpath.get(Buffer,a)},/Must be either string or array/),assert.doesNotThrow(function(){mpath.get("string",a)}),assert.doesNotThrow(function(){mpath.get([],a)}),e()}),describe("without `special`",function(){it("works",function(e){assert.equal("jiro",mpath.get("name",a)),assert.deepEqual({second:{third:[3,{name:"aaron"},9]}},mpath.get("first",a)),assert.deepEqual({third:[3,{name:"aaron"},9]},mpath.get("first.second",a)),assert.deepEqual([3,{name:"aaron"},9],mpath.get("first.second.third",a)),assert.deepEqual(3,mpath.get("first.second.third.0",a)),assert.deepEqual(9,mpath.get("first.second.third.2",a)),assert.deepEqual({name:"aaron"},mpath.get("first.second.third.1",a)),assert.deepEqual("aaron",mpath.get("first.second.third.1.name",a)),assert.deepEqual([{name:"one"},{name:"two",_doc:{name:"2"}},{name:"three",comments:[{},{comments:[{val:"twoo"}]}],_doc:{name:"3",comments:[{},{_doc:{comments:[{val:2}]}}]}}],mpath.get("comments",a)),assert.deepEqual({name:"one"},mpath.get("comments.0",a)),assert.deepEqual("one",mpath.get("comments.0.name",a)),assert.deepEqual("two",mpath.get("comments.1.name",a)),assert.deepEqual("three",mpath.get("comments.2.name",a)),assert.deepEqual([{},{comments:[{val:"twoo"}]}],mpath.get("comments.2.comments",a)),assert.deepEqual({comments:[{val:"twoo"}]},mpath.get("comments.2.comments.1",a)),assert.deepEqual("twoo",mpath.get("comments.2.comments.1.comments.0.val",a)),e()}),it("handles array.property dot-notation",function(e){assert.deepEqual(["one","two","three"],mpath.get("comments.name",a)),e()}),it("handles array.array notation",function(e){assert.deepEqual([void 0,void 0,[{},{comments:[{val:"twoo"}]}]],mpath.get("comments.comments",a)),e()}),it("handles prop.prop.prop.arrayProperty notation",function(e){assert.deepEqual([void 0,"aaron",void 0],mpath.get("first.second.third.name",a)),assert.deepEqual([1,"aaron",1],mpath.get("first.second.third.name",a,function(e){return void 0===e?1:e})),e()}),it("handles array.prop.array",function(e){assert.deepEqual([[{x:{b:[4,6,8]}},{y:10}],[{x:{b:[1,2,3]}},{x:{z:10}},{x:{b:"hi"}}],[{x:{b:null}},{x:{b:[null,1]}}],[{x:null}],[{y:3}],[3,0,null],void 0],mpath.get("array.o.array",a)),e()}),it("handles array.prop.array.index",function(e){assert.deepEqual([{x:{b:[4,6,8]}},{x:{b:[1,2,3]}},{x:{b:null}},{x:null},{y:3},3,void 0],mpath.get("array.o.array.0",a)),e()}),it("handles array.prop.array.index.prop",function(e){assert.deepEqual([{b:[4,6,8]},{b:[1,2,3]},{b:null},null,void 0,void 0,void 0],mpath.get("array.o.array.0.x",a)),e()}),it("handles array.prop.array.prop",function(e){assert.deepEqual([[void 0,10],[void 0,void 0,void 0],[void 0,void 0],[void 0],[3],[void 0,void 0,void 0],void 0],mpath.get("array.o.array.y",a)),assert.deepEqual([[{b:[4,6,8]},void 0],[{b:[1,2,3]},{z:10},{b:"hi"}],[{b:null},{b:[null,1]}],[null],[void 0],[void 0,void 0,void 0],void 0],mpath.get("array.o.array.x",a)),e()}),it("handles array.prop.array.prop.prop",function(e){assert.deepEqual([[[4,6,8],void 0],[[1,2,3],void 0,"hi"],[null,[null,1]],[null],[void 0],[void 0,void 0,void 0],void 0],mpath.get("array.o.array.x.b",a)),e()}),it("handles array.prop.array.prop.prop.index",function(e){assert.deepEqual([[6,void 0],[2,void 0,"i"],[null,1],[null],[void 0],[void 0,void 0,void 0],void 0],mpath.get("array.o.array.x.b.1",a)),assert.deepEqual([[6,0],[2,0,"i"],[null,1],[null],[0],[0,0,0],0],mpath.get("array.o.array.x.b.1",a,function(e){return void 0===e?0:e})),e()}),it("handles array.index.prop.prop",function(e){assert.deepEqual([{x:{b:[1,2,3]}},{x:{z:10}},{x:{b:"hi"}}],mpath.get("array.1.o.array",a)),assert.deepEqual(["hi","hi","hi"],mpath.get("array.1.o.array",a,function(e){return Array.isArray(e)?e.map(function(e){return"hi"}):e})),e()}),it("handles array.array.index",function(e){assert.deepEqual([{a:{c:48}},void 0],mpath.get("arr.arr.1",a)),assert.deepEqual(["woot",void 0],mpath.get("arr.arr.1",a,function(e){return e&&e.a&&e.a.c?"woot":e})),e()}),it("handles array.array.index.prop",function(e){assert.deepEqual([{c:48},"woot"],mpath.get("arr.arr.1.a",a,function(e){return void 0===e?"woot":e})),assert.deepEqual([{c:48},void 0],mpath.get("arr.arr.1.a",a)),mpath.set("arr.arr.1.a",[{c:49},void 0],a),assert.deepEqual([{c:49},void 0],mpath.get("arr.arr.1.a",a)),mpath.set("arr.arr.1.a",[{c:48},void 0],a),e()}),it("handles array.array.index.prop.prop",function(e){assert.deepEqual([48,void 0],mpath.get("arr.arr.1.a.c",a)),assert.deepEqual([48,"woot"],mpath.get("arr.arr.1.a.c",a,function(e){return void 0===e?"woot":e})),e()})}),describe("with `special`",function(){describe("that is a string",function(){it("works",function(e){assert.equal("jiro",mpath.get("name",a,special)),assert.deepEqual({second:{third:[3,{name:"aaron"},9]}},mpath.get("first",a,special)),assert.deepEqual({third:[3,{name:"aaron"},9]},mpath.get("first.second",a,special)),assert.deepEqual([3,{name:"aaron"},9],mpath.get("first.second.third",a,special)),assert.deepEqual(3,mpath.get("first.second.third.0",a,special)),assert.deepEqual(4,mpath.get("first.second.third.0",a,special,function(e){return 3===e?4:e})),assert.deepEqual(9,mpath.get("first.second.third.2",a,special)),assert.deepEqual({name:"aaron"},mpath.get("first.second.third.1",a,special)),assert.deepEqual("aaron",mpath.get("first.second.third.1.name",a,special)),assert.deepEqual([{name:"one"},{name:"two",_doc:{name:"2"}},{name:"three",comments:[{},{comments:[{val:"twoo"}]}],_doc:{name:"3",comments:[{},{_doc:{comments:[{val:2}]}}]}}],mpath.get("comments",a,special)),assert.deepEqual({name:"one"},mpath.get("comments.0",a,special)),assert.deepEqual("one",mpath.get("comments.0.name",a,special)),assert.deepEqual("2",mpath.get("comments.1.name",a,special)),assert.deepEqual("3",mpath.get("comments.2.name",a,special)),assert.deepEqual("nice",mpath.get("comments.2.name",a,special,function(e){return"3"===e?"nice":e})),assert.deepEqual([{},{_doc:{comments:[{val:2}]}}],mpath.get("comments.2.comments",a,special)),assert.deepEqual({_doc:{comments:[{val:2}]}},mpath.get("comments.2.comments.1",a,special)),assert.deepEqual(2,mpath.get("comments.2.comments.1.comments.0.val",a,special)),e()}),it("handles array.property dot-notation",function(e){assert.deepEqual(["one","2","3"],mpath.get("comments.name",a,special)),assert.deepEqual(["one",2,"3"],mpath.get("comments.name",a,special,function(e){return"2"===e?2:e})),e()}),it("handles array.array notation",function(e){assert.deepEqual([void 0,void 0,[{},{_doc:{comments:[{val:2}]}}]],mpath.get("comments.comments",a,special)),e()}),it("handles array.array.index.array",function(e){assert.deepEqual([void 0,void 0,[{val:2}]],mpath.get("comments.comments.1.comments",a,special)),e()}),it("handles array.array.index.array.prop",function(e){assert.deepEqual([void 0,void 0,[2]],mpath.get("comments.comments.1.comments.val",a,special)),assert.deepEqual(["nil","nil",[2]],mpath.get("comments.comments.1.comments.val",a,special,function(e){return void 0===e?"nil":e})),e()})}),describe("that is a function",function(){var e=function(e,a){return e[a]};it("works",function(r){assert.equal("jiro",mpath.get("name",a,e)),assert.deepEqual({second:{third:[3,{name:"aaron"},9]}},mpath.get("first",a,e)),assert.deepEqual({third:[3,{name:"aaron"},9]},mpath.get("first.second",a,e)),assert.deepEqual([3,{name:"aaron"},9],mpath.get("first.second.third",a,e)),assert.deepEqual(3,mpath.get("first.second.third.0",a,e)),assert.deepEqual(4,mpath.get("first.second.third.0",a,e,function(e){return 3===e?4:e})),assert.deepEqual(9,mpath.get("first.second.third.2",a,e)),assert.deepEqual({name:"aaron"},mpath.get("first.second.third.1",a,e)),assert.deepEqual("aaron",mpath.get("first.second.third.1.name",a,e)),assert.deepEqual([{name:"one"},{name:"two",_doc:{name:"2"}},{name:"three",comments:[{},{comments:[{val:"twoo"}]}],_doc:{name:"3",comments:[{},{_doc:{comments:[{val:2}]}}]}}],mpath.get("comments",a,e)),assert.deepEqual({name:"one"},mpath.get("comments.0",a,e)),assert.deepEqual("one",mpath.get("comments.0.name",a,e)),assert.deepEqual("two",mpath.get("comments.1.name",a,e)),assert.deepEqual("three",mpath.get("comments.2.name",a,e)),assert.deepEqual("nice",mpath.get("comments.2.name",a,e,function(e){return"three"===e?"nice":e})),assert.deepEqual([{},{comments:[{val:"twoo"}]}],mpath.get("comments.2.comments",a,e)),assert.deepEqual({comments:[{val:"twoo"}]},mpath.get("comments.2.comments.1",a,e)),assert.deepEqual("twoo",mpath.get("comments.2.comments.1.comments.0.val",a,e));var t=!1;assert.deepEqual("twoo",mpath.get("comments.8.comments.1.comments.0.val",a,function(e,a){return Array.isArray(e)&&8==a?(t=!0,e[2]):e[a]})),assert.ok(t),r()}),it("in combination with map",function(e){var a=function(e,a){return Array.isArray(e)?e[a]:e.mpath},r=function(e){return"convert"==e?"mpath":e},t={mpath:[{mpath:"converse"},{mpath:"convert"}]};assert.equal("mpath",mpath.get("something.1.kewl",t,a,r)),e()})})})}),describe("set",function(){describe("without `special`",function(){var a=e();it("works",function(e){mpath.set("name","a new val",a,function(e){return"a new val"===e?"changed":e}),assert.deepEqual("changed",a.name),mpath.set("name","changed",a),assert.deepEqual("changed",a.name),mpath.set("first.second.third",[1,{name:"x"},9],a),assert.deepEqual([1,{name:"x"},9],a.first.second.third),mpath.set("first.second.third.1.name","y",a),assert.deepEqual([1,{name:"y"},9],a.first.second.third),mpath.set("comments.1.name","ttwwoo",a),assert.deepEqual({name:"ttwwoo",_doc:{name:"2"}},a.comments[1]),mpath.set("comments.2.comments.1.comments.0.expand","added",a),assert.deepEqual({val:"twoo",expand:"added"},a.comments[2].comments[1].comments[0]),mpath.set("comments.2.comments.1.comments.2","added",a),assert.equal(3,a.comments[2].comments[1].comments.length),assert.deepEqual({val:"twoo",expand:"added"},a.comments[2].comments[1].comments[0]),assert.deepEqual(void 0,a.comments[2].comments[1].comments[1]),assert.deepEqual("added",a.comments[2].comments[1].comments[2]),e()}),describe("array.path",function(){describe("with single non-array value",function(){it("works",function(e){mpath.set("arr.yep",!1,a,function(e){return!1===e?!0:e}),assert.deepEqual([{yep:!0,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:!0}],a.arr),mpath.set("arr.yep",!1,a),assert.deepEqual([{yep:!1,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:!1}],a.arr),e()})}),describe("with array of values",function(){it("that are equal in length",function(e){mpath.set("arr.yep",["one",2],a,function(e){return"one"===e?1:e}),assert.deepEqual([{yep:1,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:2}],a.arr),mpath.set("arr.yep",["one",2],a),assert.deepEqual([{yep:"one",arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:2}],a.arr),e()}),it("that is less than length",function(e){mpath.set("arr.yep",[47],a,function(e){return 47===e?4:e}),assert.deepEqual([{yep:4,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:2}],a.arr),mpath.set("arr.yep",[47],a),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:2}],a.arr),e()}),it("that is greater than length",function(e){mpath.set("arr.yep",[5,6,7],a,function(e){return 5===e?"five":e}),assert.deepEqual([{yep:"five",arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:6}],a.arr),mpath.set("arr.yep",[5,6,7],a),assert.deepEqual([{yep:5,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:6}],a.arr),e()})})}),describe("array.$.path",function(){describe("with single non-array value",function(){it("copies the value to each item in array",function(e){mpath.set("arr.$.yep",{xtra:"double good"},a,function(e){return e&&e.xtra?"hi":e}),assert.deepEqual([{yep:"hi",arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:"hi"}],a.arr),mpath.set("arr.$.yep",{xtra:"double good"},a),assert.deepEqual([{yep:{xtra:"double good"},arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:{xtra:"double good"}}],a.arr),e()})}),describe("with array of values",function(){it("copies the value to each item in array",function(e){mpath.set("arr.$.yep",[15],a,function(e){return 1===e.length?[]:e}),assert.deepEqual([{yep:[],arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:[]}],a.arr),mpath.set("arr.$.yep",[15],a),assert.deepEqual([{yep:[15],arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:[15]}],a.arr),e()})})}),describe("array.index.path",function(){it("works",function(e){mpath.set("arr.1.yep",0,a,function(e){return 0===e?"zero":e}),assert.deepEqual([{yep:[15],arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:"zero"}],a.arr),mpath.set("arr.1.yep",0,a),assert.deepEqual([{yep:[15],arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:0}],a.arr),e()})}),describe("array.index.array.path",function(){it("with single value",function(e){mpath.set("arr.0.arr.e",35,a,function(e){return 35===e?3:e}),assert.deepEqual([{yep:[15],arr:[{a:{b:47},e:3},{a:{c:48},e:3},{d:"yep",e:3}]},{yep:0}],a.arr),mpath.set("arr.0.arr.e",35,a),assert.deepEqual([{yep:[15],arr:[{a:{b:47},e:35},{a:{c:48},e:35},{d:"yep",e:35}]},{yep:0}],a.arr),e()}),it("with array",function(e){mpath.set("arr.0.arr.e",["a","b"],a,function(e){return"a"===e?"x":e}),assert.deepEqual([{yep:[15],arr:[{a:{b:47},e:"x"},{a:{c:48},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.0.arr.e",["a","b"],a),assert.deepEqual([{yep:[15],arr:[{a:{b:47},e:"a"},{a:{c:48},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),e()})}),describe("array.index.array.path.path",function(){it("with single value",function(e){mpath.set("arr.0.arr.a.b",36,a,function(e){return 36===e?3:e}),assert.deepEqual([{yep:[15],arr:[{a:{b:3},e:"a"},{a:{c:48,b:3},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.0.arr.a.b",36,a),assert.deepEqual([{yep:[15],arr:[{a:{b:36},e:"a"},{a:{c:48,b:36},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),e()}),it("with array",function(e){mpath.set("arr.0.arr.a.b",[1,2,3,4],a,function(e){return 2===e?"two":e}),assert.deepEqual([{yep:[15],arr:[{a:{b:1},e:"a"},{a:{c:48,b:"two"},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.0.arr.a.b",[1,2,3,4],a),assert.deepEqual([{yep:[15],arr:[{a:{b:1},e:"a"},{a:{c:48,b:2},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),e()})}),describe("array.index.array.$.path.path",function(){it("with single value",function(e){mpath.set("arr.0.arr.$.a.b","$",a,function(e){return"$"===e?"dolla billz":e}),assert.deepEqual([{yep:[15],arr:[{a:{b:"dolla billz"},e:"a"},{a:{c:48,b:"dolla billz"},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.0.arr.$.a.b","$",a),assert.deepEqual([{yep:[15],arr:[{a:{b:"$"},e:"a"},{a:{c:48,b:"$"},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),e()}),it("with array",function(e){mpath.set("arr.0.arr.$.a.b",[1],a,function(e){return Array.isArray(e)?{}:e}),assert.deepEqual([{yep:[15],arr:[{a:{b:{}},e:"a"},{a:{c:48,b:{}},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.0.arr.$.a.b",[1],a),assert.deepEqual([{yep:[15],arr:[{a:{b:[1]},e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),e()})}),describe("array.array.index.path",function(){it("with single value",function(e){mpath.set("arr.arr.0.a","single",a,function(e){return"single"===e?"double":e}),assert.deepEqual([{yep:[15],arr:[{a:"double",e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.arr.0.a","single",a),assert.deepEqual([{yep:[15],arr:[{a:"single",e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),e()}),it("with array",function(e){mpath.set("arr.arr.0.a",[4,8,15,16,23,42],a,function(e){return 4===e?3:e}),assert.deepEqual([{yep:[15],arr:[{a:3,e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:!1}],a.arr),mpath.set("arr.arr.0.a",[4,8,15,16,23,42],a),assert.deepEqual([{yep:[15],arr:[{a:4,e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:!1}],a.arr),e()})}),describe("array.array.$.index.path",function(){it("with single value",function(e){mpath.set("arr.arr.$.0.a","singles",a,function(e){return 0}),assert.deepEqual([{yep:[15],arr:[{a:0,e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.arr.$.0.a","singles",a),assert.deepEqual([{yep:[15],arr:[{a:"singles",e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("$.arr.arr.0.a","single",a),assert.deepEqual([{yep:[15],arr:[{a:"single",e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),e()}),it("with array",function(e){mpath.set("arr.arr.$.0.a",[4,8,15,16,23,42],a,function(e){return"nope"}),assert.deepEqual([{yep:[15],arr:[{a:"nope",e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.arr.$.0.a",[4,8,15,16,23,42],a),assert.deepEqual([{yep:[15],arr:[{a:[4,8,15,16,23,42],e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.$.arr.0.a",[4,8,15,16,23,42,108],a),assert.deepEqual([{yep:[15],arr:[{a:[4,8,15,16,23,42,108],e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),e()})}),describe("array.array.path.index",function(){it("with single value",function(e){mpath.set("arr.arr.a.7",47,a,function(e){return 1}),assert.deepEqual([{yep:[15],arr:[{a:[4,8,15,16,23,42,108,1],e:"a"},{a:{c:48,b:[1],7:1},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),mpath.set("arr.arr.a.7",47,a),assert.deepEqual([{yep:[15],arr:[{a:[4,8,15,16,23,42,108,47],e:"a"},{a:{c:48,b:[1],7:47},e:"b"},{d:"yep",e:35}]},{yep:0}],a.arr),e()}),it("with array",function(e){a.arr[1].arr=[{a:[]},{a:[]},{a:null}],mpath.set("arr.arr.a.7",[[null,46],[void 0,"woot"]],a);var r=[],t=[];r[7]=void 0,t[7]="woot",assert.deepEqual([{yep:[15],arr:[{a:[4,8,15,16,23,42,108,null],e:"a"},{a:{c:48,b:[1],7:46},e:"b"},{d:"yep",e:35}]},{yep:0,arr:[{a:r},{a:t},{a:null}]}],a.arr),e()})}),describe("handles array.array.path",function(){it("with single",function(e){a.arr[1].arr=[{},{}],assert.deepEqual([{},{}],a.arr[1].arr),a.arr.push({arr:"something else"}),a.arr.push({arr:["something else"]}),a.arr.push({arr:[[]]}),a.arr.push({arr:[5]});var r=[];r.e="xmas",mpath.set("arr.arr.e",47,a,function(e){return"xmas"}),assert.deepEqual([{yep:[15],arr:[{a:[4,8,15,16,23,42,108,null],e:"xmas"},{a:{c:48,b:[1],7:46},e:"xmas"},{d:"yep",e:"xmas"}]},{yep:0,arr:[{e:"xmas"},{e:"xmas"}]},{arr:"something else"},{arr:["something else"]},{arr:[r]},{arr:[5]}],a.arr),r.e=47,mpath.set("arr.arr.e",47,a),assert.deepEqual([{yep:[15],arr:[{a:[4,8,15,16,23,42,108,null],e:47},{a:{c:48,b:[1],7:46},e:47},{d:"yep",e:47}]},{yep:0,arr:[{e:47},{e:47}]},{arr:"something else"},{arr:["something else"]},{arr:[r]},{arr:[5]}],a.arr),e()}),it("with arrays",function(e){mpath.set("arr.arr.e",[[1,2,3],[4,5],null,[],[6],[7,8,9]],a,function(e){return 10});var r=[];r.e=10,assert.deepEqual([{yep:[15],arr:[{a:[4,8,15,16,23,42,108,null],e:10},{a:{c:48,b:[1],7:46},e:10},{d:"yep",e:10}]},{yep:0,arr:[{e:10},{e:10}]},{arr:"something else"},{arr:["something else"]},{arr:[r]},{arr:[5]}],a.arr),mpath.set("arr.arr.e",[[1,2,3],[4,5],null,[],[6],[7,8,9]],a),r.e=6,assert.deepEqual([{yep:[15],arr:[{a:[4,8,15,16,23,42,108,null],e:1},{a:{c:48,b:[1],7:46},e:2},{d:"yep",e:3}]},{yep:0,arr:[{e:4},{e:5}]},{arr:"something else"},{arr:["something else"]},{arr:[r]},{arr:[5]}],a.arr),e()})})}),describe("with `special`",function(){var a=e();it("works",function(e){mpath.set("name","chan",a,special,function(e){return"hi"}),assert.deepEqual("hi",a.name),mpath.set("name","changer",a,special),assert.deepEqual("changer",a.name),mpath.set("first.second.third",[1,{name:"y"},9],a,special),assert.deepEqual([1,{name:"y"},9],a.first.second.third),mpath.set("first.second.third.1.name","z",a,special),assert.deepEqual([1,{name:"z"},9],a.first.second.third),mpath.set("comments.1.name","ttwwoo",a,special),assert.deepEqual({name:"two",_doc:{name:"ttwwoo"}},a.comments[1]),mpath.set("comments.2.comments.1.comments.0.expander","adder",a,special,function(e){return"super"}),assert.deepEqual({val:2,expander:"super"},a.comments[2]._doc.comments[1]._doc.comments[0]),mpath.set("comments.2.comments.1.comments.0.expander","adder",a,special),assert.deepEqual({val:2,expander:"adder"},a.comments[2]._doc.comments[1]._doc.comments[0]),mpath.set("comments.2.comments.1.comments.2","set",a,special),assert.equal(3,a.comments[2]._doc.comments[1]._doc.comments.length),assert.deepEqual({val:2,expander:"adder"},a.comments[2]._doc.comments[1]._doc.comments[0]),assert.deepEqual(void 0,a.comments[2]._doc.comments[1]._doc.comments[1]),assert.deepEqual("set",a.comments[2]._doc.comments[1]._doc.comments[2]),e()}),describe("array.path",function(){describe("with single non-array value",function(){it("works",function(e){a.arr[1]._doc={special:!0},mpath.set("arr.yep",!1,a,special,function(e){return"yes"}),assert.deepEqual([{yep:"yes",arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:!0,_doc:{special:!0,yep:"yes"}}],a.arr),mpath.set("arr.yep",!1,a,special),assert.deepEqual([{yep:!1,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:!0,_doc:{special:!0,yep:!1}}],a.arr),e()})}),describe("with array of values",function(){it("that are equal in length",function(e){mpath.set("arr.yep",["one",2],a,special,function(e){return 2===e?20:e}),assert.deepEqual([{yep:"one",arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:!0,_doc:{special:!0,yep:20}}],a.arr),mpath.set("arr.yep",["one",2],a,special),assert.deepEqual([{yep:"one",arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:!0,_doc:{special:!0,yep:2}}],a.arr),e()}),it("that is less than length",function(e){mpath.set("arr.yep",[47],a,special,function(e){return 80}),assert.deepEqual([{yep:80,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:!0,_doc:{special:!0,yep:2}}],a.arr),mpath.set("arr.yep",[47],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},{yep:!0,_doc:{special:!0,yep:2}}],a.arr),a.arr[0]._doc={yep:46,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]},mpath.set("arr.yep",[20],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:20,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]}},{yep:!0,_doc:{special:!0,yep:2}}],a.arr),e()}),it("that is greater than length",function(e){mpath.set("arr.yep",[5,6,7],a,special,function(){return"x"}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:"x",arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]}},{yep:!0,_doc:{special:!0,yep:"x"}}],a.arr),mpath.set("arr.yep",[5,6,7],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:5,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]}},{yep:!0,_doc:{special:!0,yep:6}}],a.arr),e()})})}),describe("array.$.path",function(){describe("with single non-array value",function(){it("copies the value to each item in array",function(e){mpath.set("arr.$.yep",{xtra:"double good"},a,special,function(e){return 9}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:9,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]}},{yep:!0,_doc:{special:!0,yep:9}}],a.arr),mpath.set("arr.$.yep",{xtra:"double good"},a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:{xtra:"double good"},arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]}},{yep:!0,_doc:{special:!0,yep:{xtra:"double good"}}}],a.arr),e()})}),describe("with array of values",function(){it("copies the value to each item in array",function(e){mpath.set("arr.$.yep",[15],a,special,function(e){return"array"}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:"array",arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]}},{yep:!0,_doc:{special:!0,yep:"array"}}],a.arr),mpath.set("arr.$.yep",[15],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]}},{yep:!0,_doc:{special:!0,yep:[15]}}],a.arr),e()})})}),describe("array.index.path",function(){it("works",function(e){mpath.set("arr.1.yep",0,a,special,function(e){return 1}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]}},{yep:!0,_doc:{special:!0,yep:1}}],a.arr),mpath.set("arr.1.yep",0,a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()})}),describe("array.index.array.path",function(){it("with single value",function(e){mpath.set("arr.0.arr.e",35,a,special,function(e){return 30}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:47},e:30},{a:{c:48},e:30},{d:"yep",e:30}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.0.arr.e",35,a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:47},e:35},{a:{c:48},e:35},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()}),it("with array",function(e){mpath.set("arr.0.arr.e",["a","b"],a,special,function(e){return"a"===e?"A":e}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:47},e:"A"},{a:{c:48},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.0.arr.e",["a","b"],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:47},e:"a"},{a:{c:48},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()})}),describe("array.index.array.path.path",function(){it("with single value",function(e){mpath.set("arr.0.arr.a.b",36,a,special,function(e){return 20}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:20},e:"a"},{a:{c:48,b:20},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.0.arr.a.b",36,a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:36},e:"a"},{a:{c:48,b:36},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()}),it("with array",function(e){mpath.set("arr.0.arr.a.b",[1,2,3,4],a,special,function(e){return 2*e}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:2},e:"a"},{a:{c:48,b:4},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.0.arr.a.b",[1,2,3,4],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:1},e:"a"},{a:{c:48,b:2},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()})}),describe("array.index.array.$.path.path",function(){it("with single value",function(e){mpath.set("arr.0.arr.$.a.b","$",a,special,function(e){return"dollaz"}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:"dollaz"},e:"a"},{a:{c:48,b:"dollaz"},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.0.arr.$.a.b","$",a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:"$"},e:"a"},{a:{c:48,b:"$"},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()}),it("with array",function(e){mpath.set("arr.0.arr.$.a.b",[1],a,special,function(e){return{}}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:{}},e:"a"},{a:{c:48,b:{}},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.0.arr.$.a.b",[1],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:{b:[1]},e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()})}),describe("array.array.index.path",function(){it("with single value",function(e){mpath.set("arr.arr.0.a","single",a,special,function(e){return 88}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:88,e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.arr.0.a","single",a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:"single",e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()}),it("with array",function(e){mpath.set("arr.arr.0.a",[4,8,15,16,23,42],a,special,function(e){return 2*e}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:8,e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.arr.0.a",[4,8,15,16,23,42],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:4,e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()})}),describe("array.array.$.index.path",function(){it("with single value",function(e){mpath.set("arr.arr.$.0.a","singles",a,special,function(e){return e.toUpperCase()}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:"SINGLES",e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.arr.$.0.a","singles",a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:"singles",e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("$.arr.arr.0.a","single",a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:"single",e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()}),it("with array",function(e){mpath.set("arr.arr.$.0.a",[4,8,15,16,23,42],a,special,function(e){return Array}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:Array,e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.arr.$.0.a",[4,8,15,16,23,42],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:[4,8,15,16,23,42],e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.$.arr.0.a",[4,8,15,16,23,42,108],a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:[4,8,15,16,23,42,108],e:"a"},{a:{c:48,b:[1]},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()})}),describe("array.array.path.index",function(){it("with single value",function(e){mpath.set("arr.arr.a.7",47,a,special,function(e){return Object}),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:[4,8,15,16,23,42,108,Object],e:"a"},{a:{c:48,b:[1],7:Object},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),mpath.set("arr.arr.a.7",47,a,special),assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:[4,8,15,16,23,42,108,47],e:"a"},{a:{c:48,b:[1],7:47},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{special:!0,yep:0}}],a.arr),e()}),it("with array",function(e){a.arr[1]._doc.arr=[{a:[]},{a:[]},{a:null}],mpath.set("arr.arr.a.7",[[null,46],[void 0,"woot"]],a,special,function(e){return void 0===e?"nope":e});var r=[],t=[];r[7]="nope",t[7]="woot",assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:[4,8,15,16,23,42,108,null],e:"a"},{a:{c:48,b:[1],7:46},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{arr:[{a:r},{a:t},{a:null}],special:!0,yep:0}}],a.arr),mpath.set("arr.arr.a.7",[[null,46],[void 0,"woot"]],a,special),r[7]=void 0,assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:[4,8,15,16,23,42,108,null],e:"a"},{a:{c:48,b:[1],7:46},e:"b"},{d:"yep",e:35}]}},{yep:!0,_doc:{arr:[{a:r},{a:t},{a:null}],special:!0,yep:0}}],a.arr),e()})}),describe("handles array.array.path",function(){it("with single",function(e){a.arr[1]._doc.arr=[{},{}],assert.deepEqual([{},{}],a.arr[1]._doc.arr),a.arr.push({_doc:{arr:"something else"}}),a.arr.push({_doc:{arr:["something else"]}}),a.arr.push({_doc:{arr:[[]]}}),a.arr.push({_doc:{arr:[5]}}),mpath.set("arr.arr.e",47,a,special);var r=[];r.e=47,assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:[4,8,15,16,23,42,108,null],e:47},{a:{c:48,b:[1],7:46},e:47},{d:"yep",e:47}]}},{yep:!0,_doc:{arr:[{
e:47},{e:47}],special:!0,yep:0}},{_doc:{arr:"something else"}},{_doc:{arr:["something else"]}},{_doc:{arr:[r]}},{_doc:{arr:[5]}}],a.arr),e()}),it("with arrays",function(e){mpath.set("arr.arr.e",[[1,2,3],[4,5],null,[],[6],[7,8,9]],a,special);var r=[];r.e=6,assert.deepEqual([{yep:47,arr:[{a:{b:47}},{a:{c:48}},{d:"yep"}],_doc:{yep:[15],arr:[{a:[4,8,15,16,23,42,108,null],e:1},{a:{c:48,b:[1],7:46},e:2},{d:"yep",e:3}]}},{yep:!0,_doc:{arr:[{e:4},{e:5}],special:!0,yep:0}},{_doc:{arr:"something else"}},{_doc:{arr:["something else"]}},{_doc:{arr:[r]}},{_doc:{arr:[5]}}],a.arr),e()})}),describe("that is a function",function(){describe("without map",function(){it("works on array value",function(e){var a={hello:{world:[{how:"are"},{you:"?"}]}},r=function(e,a,r){return r?void(e[a]=r):"thing"==a?e.world:e[a]};mpath.set("hello.thing.how","arrrr",a,r),assert.deepEqual(a,{hello:{world:[{how:"arrrr"},{you:"?",how:"arrrr"}]}}),e()}),it("works on non-array value",function(e){var a={hello:{world:{how:"are you"}}},r=function(e,a,r){return r?void(e[a]=r):"thing"==a?e.world:e[a]};mpath.set("hello.thing.how","RU",a,r),assert.deepEqual(a,{hello:{world:{how:"RU"}}}),e()})}),it("works with map",function(e){var a={hello:{world:[{how:"are"},{you:"?"}]}},r=function(e,a,r){return r?void(e[a]=r):"thing"==a?e.world:e[a]},t=function(e){return"convert"==e?"\xba\xba":e};mpath.set("hello.thing.how","convert",a,r,t),assert.deepEqual(a,{hello:{world:[{how:"\xba\xba"},{you:"?",how:"\xba\xba"}]}}),e()})})}),describe("get/set integration",function(){var a=e();it("works",function(e){var r=mpath.get("array.o.array.x.b",a);r[0][0][2]=10,r[1][0][1]=0,r[1][1]="Rambaldi",r[1][2]=[12,14],r[2]=[{changed:!0},[null,["changed","to","array"]]],mpath.set("array.o.array.x.b",r,a);var t=[{o:{array:[{x:{b:[4,6,10]}},{y:10}]}},{o:{array:[{x:{b:[1,0,3]}},{x:{b:"Rambaldi",z:10}},{x:{b:[12,14]}}]}},{o:{array:[{x:{b:{changed:!0}}},{x:{b:[null,["changed","to","array"]]}}]}},{o:{array:[{x:null}]}},{o:{array:[{y:3}]}},{o:{array:[3,0,null]}},{o:{name:"ha"}}];assert.deepEqual(t,a.array),e()}),it("array.prop",function(e){mpath.set("comments.name",["this","was","changed"],a),assert.deepEqual([{name:"this"},{name:"was",_doc:{name:"2"}},{name:"changed",comments:[{},{comments:[{val:"twoo"}]}],_doc:{name:"3",comments:[{},{_doc:{comments:[{val:2}]}}]}}],a.comments),mpath.set("comments.name",["also","changed","this"],a,special),assert.deepEqual([{name:"also"},{name:"was",_doc:{name:"changed"}},{name:"changed",comments:[{},{comments:[{val:"twoo"}]}],_doc:{name:"this",comments:[{},{_doc:{comments:[{val:2}]}}]}}],a.comments),e()})}),describe("multiple $ use",function(){var a=e();it("is ok",function(e){assert.doesNotThrow(function(){mpath.set("arr.$.arr.$.a",35,a)}),e()})}),it("ignores setting a nested path that doesnt exist",function(a){var r=e();assert.doesNotThrow(function(){mpath.set("thing.that.is.new",10,r)}),a()})})});