var mongodb=require("./"),CoreConnection=mongodb.CoreConnection,CoreServer=mongodb.CoreServer,uri="mongodb://foo:bar@ds021331-a0.mlab.com:21331,ds021331-a1.mlab.com:21331/driver-test?replicaSet=rs-ds021331",options={server:{socketOptions:{connectTimeoutMS:5e3,socketTimeoutMS:15e3}}},interval=100,total=1e3;CoreConnection.enableConnectionAccounting(),CoreServer.enableServerAccounting();var openThenClose=function(o){var e=mongodb.MongoClient;e.connect(uri,options,function(e,n){if(e)console.error(Date()+" "+e);else{console.error(Date()+" open :: "+o);var r=n.collection("some-collection").find();r.toArray(function(e,r){console.error(Date()+" found "+r.length+" docs"),n.close(function(){console.error(Date()+" close :: "+o)})})}})},count=total,intervalId=setInterval(function(){count-=1,0==count?(clearInterval(intervalId),setTimeout(function(){CoreConnection.disableConnectionAccounting(),CoreServer.disableServerAccounting(),console.log("============================= connections left"),console.dir(Object.keys(CoreConnection.connections())),console.dir(Object.keys(CoreServer.servers()))},5e3)):openThenClose(count)},interval);