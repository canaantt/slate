function BSON(){}function calculateElement(e,r,t){var n="undefined"!=typeof Buffer;switch(r&&r.toBSON&&(r=r.toBSON()),typeof r){case"string":return 1+(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1+4+(n?Buffer.byteLength(r,"utf8"):numberOfBytes(r))+1;case"number":return Math.floor(r)===r&&r>=BSON.JS_INT_MIN&&r<=BSON.JS_INT_MAX&&r>=BSON.BSON_INT32_MIN&&r<=BSON.BSON_INT32_MAX?(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+5:(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9;case"undefined":return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1;case"boolean":return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+2;case"object":if(null==r||r instanceof MinKey||r instanceof MaxKey||"MinKey"==r._bsontype||"MaxKey"==r._bsontype)return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1;if(r instanceof ObjectID||"ObjectID"==r._bsontype)return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+13;if(r instanceof Date||isDate(r))return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(r))return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+6+r.length;if(r instanceof Long||r instanceof Double||r instanceof Timestamp||"Long"==r._bsontype||"Double"==r._bsontype||"Timestamp"==r._bsontype)return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+9;if(r instanceof Code||"Code"==r._bsontype)return null!=r.scope&&Object.keys(r.scope).length>0?(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+4+(n?Buffer.byteLength(r.code.toString(),"utf8"):numberOfBytes(r.code.toString()))+1+BSON.calculateObjectSize(r.scope,t):(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+(n?Buffer.byteLength(r.code.toString(),"utf8"):numberOfBytes(r.code.toString()))+1;if(r instanceof Binary||"Binary"==r._bsontype)return r.sub_type==Binary.SUBTYPE_BYTE_ARRAY?(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+(r.position+1+4+1+4):(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+(r.position+1+4+1);if(r instanceof Symbol||"Symbol"==r._bsontype)return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+((n?Buffer.byteLength(r.value,"utf8"):numberOfBytes(r.value))+4+1+1);if(r instanceof DBRef||"DBRef"==r._bsontype){var u={$ref:r.namespace,$id:r.oid};return null!=r.db&&(u.$db=r.db),(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+BSON.calculateObjectSize(u,t)}return r instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(r)?(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+(n?Buffer.byteLength(r.source,"utf8"):numberOfBytes(r.source))+1+(r.global?1:0)+(r.ignoreCase?1:0)+(r.multiline?1:0)+1:(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+BSON.calculateObjectSize(r,t)+1;case"function":if(r instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(r)||"[object RegExp]"==String.call(r))return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+(n?Buffer.byteLength(r.source,"utf8"):numberOfBytes(r.source))+1+(r.global?1:0)+(r.ignoreCase?1:0)+(r.multiline?1:0)+1;if(t&&null!=r.scope&&Object.keys(r.scope).length>0)return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+4+(n?Buffer.byteLength(r.toString(),"utf8"):numberOfBytes(r.toString()))+1+BSON.calculateObjectSize(r.scope,t);if(t)return(null!=e?(n?Buffer.byteLength(e,"utf8"):numberOfBytes(e))+1:0)+1+4+(n?Buffer.byteLength(r.toString(),"utf8"):numberOfBytes(r.toString()))+1}return 0}var Long=require("../lib/bson/long").Long,Double=require("../lib/bson/double").Double,Timestamp=require("../lib/bson/timestamp").Timestamp,ObjectID=require("../lib/bson/objectid").ObjectID,Symbol=require("../lib/bson/symbol").Symbol,Code=require("../lib/bson/code").Code,MinKey=require("../lib/bson/min_key").MinKey,MaxKey=require("../lib/bson/max_key").MaxKey,DBRef=require("../lib/bson/db_ref").DBRef,Binary=require("../lib/bson/binary").Binary,BinaryParser=require("../lib/bson/binary_parser").BinaryParser,writeIEEE754=require("../lib/bson/float_parser").writeIEEE754,readIEEE754=require("../lib/bson/float_parser").readIEEE754,isDate=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)};BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_UNDEFINED=6,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.calculateObjectSize=function(e,r){var t=5;if(Array.isArray(e))for(var n=0;n<e.length;n++)t+=calculateElement(n.toString(),e[n],r);else{e.toBSON&&(e=e.toBSON());for(var u in e)t+=calculateElement(u,e[u],r)}return t},BSON.serializeWithBufferAndIndex=function(e,r,t,n,u){u=null==u?!1:u;var f=t.length;return t[n++]=255&f,t[n++]=f>>8&255,t[n++]=f>>16&255,t[n++]=f>>24&255,serializeObject(e,r,t,n,u)-1};var serializeObject=function(e,r,t,n,u){if(e.toBSON){if("function"!=typeof e.toBSON)throw new Error("toBSON is not a function");if(e=e.toBSON(),null!=e&&"object"!=typeof e)throw new Error("toBSON function did not return an object")}if(Array.isArray(e))for(var f=0;f<e.length;f++)n=packElement(f.toString(),e[f],r,t,n,u);else{e.toBSON&&(e=e.toBSON());for(var o in e)"$db"!=o&&"$ref"!=o&&"$id"!=o&&BSON.checkKey(o,!r),n=packElement(o,e[o],r,t,n,u)}return t[n++]=0,n},stringToBytes=function(e){for(var r,t,n=[],u=0;u<e.length;u++){r=e.charCodeAt(u),t=[];do t.push(255&r),r>>=8;while(r);n=n.concat(t.reverse())}return n},numberOfBytes=function(e){for(var r,t,n=0,u=0;u<e.length;u++){r=e.charCodeAt(u),t=[];do t.push(255&r),r>>=8;while(r);n+=t.length}return n},writeToTypedArray=function(e,r,t){for(var n=stringToBytes(r),u=0;u<n.length;u++)e[t+u]=n[u];return n.length},supportsBuffer="undefined"!=typeof Buffer,packElement=function(e,r,t,n,u,f){r&&r.toBSON&&(r=r.toBSON());switch(typeof r){case"string":n[u++]=BSON.BSON_DATA_STRING;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var i=supportsBuffer?Buffer.byteLength(r)+1:numberOfBytes(r)+1;return n[u+3]=i>>24&255,n[u+2]=i>>16&255,n[u+1]=i>>8&255,n[u]=255&i,u+=4,supportsBuffer?n.write(r,u,"utf8"):writeToTypedArray(n,r,u),u=u+i-1,n[u++]=0,u;case"number":if(Math.floor(r)===r&&r>=BSON.JS_INT_MIN&&r<=BSON.JS_INT_MAX)if(r>=BSON.BSON_INT32_MIN&&r<=BSON.BSON_INT32_MAX){n[u++]=BSON.BSON_DATA_INT;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0,n[u++]=255&r,n[u++]=r>>8&255,n[u++]=r>>16&255,n[u++]=r>>24&255}else if(r>=BSON.JS_INT_MIN&&r<=BSON.JS_INT_MAX){n[u++]=BSON.BSON_DATA_NUMBER;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0,writeIEEE754(n,r,u,"little",52,8),u+=8}else{n[u++]=BSON.BSON_DATA_LONG;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var B=Long.fromNumber(r),a=B.getLowBits(),s=B.getHighBits();n[u++]=255&a,n[u++]=a>>8&255,n[u++]=a>>16&255,n[u++]=a>>24&255,n[u++]=255&s,n[u++]=s>>8&255,n[u++]=s>>16&255,n[u++]=s>>24&255}else{n[u++]=BSON.BSON_DATA_NUMBER;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0,writeIEEE754(n,r,u,"little",52,8),u+=8}return u;case"undefined":n[u++]=BSON.BSON_DATA_NULL;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);return u=u+o+1,n[u-1]=0,u;case"boolean":n[u++]=BSON.BSON_DATA_BOOLEAN;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);return u=u+o+1,n[u-1]=0,n[u++]=r?1:0,u;case"object":if(null===r||r instanceof MinKey||r instanceof MaxKey||"MinKey"==r._bsontype||"MaxKey"==r._bsontype){null===r?n[u++]=BSON.BSON_DATA_NULL:r instanceof MinKey?n[u++]=BSON.BSON_DATA_MIN_KEY:n[u++]=BSON.BSON_DATA_MAX_KEY;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);return u=u+o+1,n[u-1]=0,u}if(r instanceof ObjectID||"ObjectID"==r._bsontype){n[u++]=BSON.BSON_DATA_OID;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);return u=u+o+1,n[u-1]=0,supportsBuffer?n.write(r.id,u,"binary"):writeToTypedArray(n,r.id,u),u+=12}if(r instanceof Date||isDate(r)){n[u++]=BSON.BSON_DATA_DATE;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var O=Long.fromNumber(r.getTime()),a=O.getLowBits(),s=O.getHighBits();return n[u++]=255&a,n[u++]=a>>8&255,n[u++]=a>>16&255,n[u++]=a>>24&255,n[u++]=255&s,n[u++]=s>>8&255,n[u++]=s>>16&255,n[u++]=s>>24&255,u}if("undefined"!=typeof Buffer&&Buffer.isBuffer(r)){n[u++]=BSON.BSON_DATA_BINARY;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var i=r.length;return n[u++]=255&i,n[u++]=i>>8&255,n[u++]=i>>16&255,n[u++]=i>>24&255,n[u++]=BSON.BSON_BINARY_SUBTYPE_DEFAULT,r.copy(n,u,0,i),u+=i}if(r instanceof Long||r instanceof Timestamp||"Long"==r._bsontype||"Timestamp"==r._bsontype){n[u++]=r instanceof Long||"Long"==r._bsontype?BSON.BSON_DATA_LONG:BSON.BSON_DATA_TIMESTAMP;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var a=r.getLowBits(),s=r.getHighBits();return n[u++]=255&a,n[u++]=a>>8&255,n[u++]=a>>16&255,n[u++]=a>>24&255,n[u++]=255&s,n[u++]=s>>8&255,n[u++]=s>>16&255,n[u++]=s>>24&255,u}if(r instanceof Double||"Double"==r._bsontype){n[u++]=BSON.BSON_DATA_NUMBER;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);return u=u+o+1,n[u-1]=0,writeIEEE754(n,r,u,"little",52,8),u+=8}if(r instanceof Code||"Code"==r._bsontype){if(null!=r.scope&&Object.keys(r.scope).length>0){n[u++]=BSON.BSON_DATA_CODE_W_SCOPE;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var S=BSON.calculateObjectSize(r.scope,f),l=r.code.toString(),N=supportsBuffer?Buffer.byteLength(l)+1:numberOfBytes(l)+1,c=4+N+S+4;n[u++]=255&c,n[u++]=c>>8&255,n[u++]=c>>16&255,n[u++]=c>>24&255,n[u++]=255&N,n[u++]=N>>8&255,n[u++]=N>>16&255,n[u++]=N>>24&255,supportsBuffer?n.write(l,u,"utf8"):writeToTypedArray(n,l,u),u=u+N-1,n[u++]=0;var y=supportsBuffer?new Buffer(S):new Uint8Array(new ArrayBuffer(S));serializeObject(r.scope,t,y,0,f);var p=S;return n[u++]=255&p,n[u++]=p>>8&255,n[u++]=p>>16&255,n[u++]=p>>24&255,supportsBuffer?y.copy(n,u,0,S):n.set(y,u),u=u+p-5,n[u++]=0,u}n[u++]=BSON.BSON_DATA_CODE;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var l=r.code.toString(),i=supportsBuffer?Buffer.byteLength(l)+1:numberOfBytes(l)+1;return n[u++]=255&i,n[u++]=i>>8&255,n[u++]=i>>16&255,n[u++]=i>>24&255,supportsBuffer?n.write(l,u,"utf8"):writeToTypedArray(n,l,u),u=u+i-1,n[u++]=0,u}if(r instanceof Binary||"Binary"==r._bsontype){n[u++]=BSON.BSON_DATA_BINARY;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var b=r.value(!0),i=r.position;return n[u++]=255&i,n[u++]=i>>8&255,n[u++]=i>>16&255,n[u++]=i>>24&255,n[u++]=r.sub_type,r.sub_type==Binary.SUBTYPE_BYTE_ARRAY&&(n[u++]=255&i,n[u++]=i>>8&255,n[u++]=i>>16&255,n[u++]=i>>24&255),supportsBuffer?b.copy(n,u,0,r.position):n.set(b,u),u+=r.position}if(r instanceof Symbol||"Symbol"==r._bsontype){n[u++]=BSON.BSON_DATA_SYMBOL;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var i=supportsBuffer?Buffer.byteLength(r.value)+1:numberOfBytes(r.value)+1;return n[u++]=255&i,n[u++]=i>>8&255,n[u++]=i>>16&255,n[u++]=i>>24&255,n.write(r.value,u,"utf8"),u=u+i-1,n[u++]=0,u}if(r instanceof DBRef||"DBRef"==r._bsontype){n[u++]=BSON.BSON_DATA_OBJECT;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var _={$ref:r.namespace,$id:r.oid};null!=r.db&&(_.$db=r.db);var i=BSON.calculateObjectSize(_,f),A=BSON.serializeWithBufferAndIndex(_,t,n,u,f);return n[u++]=255&i,n[u++]=i>>8&255,n[u++]=i>>16&255,n[u++]=i>>24&255,n[A++]=0,A}if(r instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(r)){n[u++]=BSON.BSON_DATA_REGEXP;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);return u=u+o+1,n[u-1]=0,supportsBuffer?n.write(r.source,u,"utf8"):writeToTypedArray(n,r.source,u),u+=supportsBuffer?Buffer.byteLength(r.source):numberOfBytes(r.source),n[u++]=0,r.global&&(n[u++]=115),r.ignoreCase&&(n[u++]=105),r.multiline&&(n[u++]=109),n[u++]=0,u}n[u++]=Array.isArray(r)?BSON.BSON_DATA_ARRAY:BSON.BSON_DATA_OBJECT;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var A=serializeObject(r,t,n,u+4,f),i=A-u;return n[u++]=255&i,n[u++]=i>>8&255,n[u++]=i>>16&255,n[u++]=i>>24&255,A;case"function":if(r instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(r)||"[object RegExp]"==String.call(r)){n[u++]=BSON.BSON_DATA_REGEXP;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);return u=u+o+1,n[u-1]=0,n.write(r.source,u,"utf8"),u+=supportsBuffer?Buffer.byteLength(r.source):numberOfBytes(r.source),n[u++]=0,r.global&&(n[u++]=115),r.ignoreCase&&(n[u++]=105),r.multiline&&(n[u++]=109),n[u++]=0,u}if(f&&null!=r.scope&&Object.keys(r.scope).length>0){n[u++]=BSON.BSON_DATA_CODE_W_SCOPE;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var S=BSON.calculateObjectSize(r.scope,f),l=r.toString(),N=supportsBuffer?Buffer.byteLength(l)+1:numberOfBytes(l)+1,c=4+N+S;n[u++]=255&c,n[u++]=c>>8&255,n[u++]=c>>16&255,n[u++]=c>>24&255,n[u++]=255&N,n[u++]=N>>8&255,n[u++]=N>>16&255,n[u++]=N>>24&255,supportsBuffer?n.write(l,u,"utf8"):writeToTypedArray(n,l,u),u=u+N-1,n[u++]=0;var y=new Buffer(S);serializeObject(r.scope,t,y,0,f);var p=S-4;return n[u++]=255&p,n[u++]=p>>8&255,n[u++]=p>>16&255,n[u++]=p>>24&255,y.copy(n,u,0,S),u=u+p-5,n[u++]=0,u}if(f){n[u++]=BSON.BSON_DATA_CODE;var o=supportsBuffer?n.write(e,u,"utf8"):writeToTypedArray(n,e,u);u=u+o+1,n[u-1]=0;var l=r.toString(),i=supportsBuffer?Buffer.byteLength(l)+1:numberOfBytes(l)+1;return n[u++]=255&i,n[u++]=i>>8&255,n[u++]=i>>16&255,n[u++]=i>>24&255,supportsBuffer?n.write(l,u,"utf8"):writeToTypedArray(n,l,u),u=u+i-1,n[u++]=0,u}}return u};BSON.serialize=function(e,r,t,n){if(null==e||"object"!=typeof e||Array.isArray(e))throw new Error("Only javascript objects supported");var u=null,f=BSON.calculateObjectSize(e,n);return(u="undefined"!=typeof Buffer)?(u=new Buffer(f),t=!0):u="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(f)):new Array(f),BSON.serializeWithBufferAndIndex(e,r,u,0,n),u};var functionCache=BSON.functionCache={},table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],crc32=function(e,r,t){var n=0,u=0,f=0;n=-1^n;for(var o=r,i=t;i>o;o++)f=255&(n^e[o]),u=table[f],n=n>>>8^u;return-1^n};BSON.deserializeStream=function(e,r,t,n,u,f){f=null!=f?f:{};for(var o=r,i=0;t>i;i++){var B=e[o]|e[o+1]<<8|e[o+2]<<16|e[o+3]<<24;f.index=o,n[u+i]=BSON.deserialize(e,f),o+=B}return o};var isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},convertUint8ArrayToUtf8String=function(e,r,t){return BinaryParser.decode_utf8(convertArraytoUtf8BinaryString(e,r,t))},convertArraytoUtf8BinaryString=function(e,r,t){for(var n="",u=r;t>u;u++)n+=String.fromCharCode(e[u]);return n};BSON.deserialize=function(e,r,t){r=null==r?{}:r;var n=null==r.evalFunctions?!1:r.evalFunctions,u=null==r.cacheFunctions?!1:r.cacheFunctions,f=null==r.cacheFunctionsCrc32?!1:r.cacheFunctionsCrc32,o=null==r.promoteLongs?!0:r.promoteLongs;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var i="number"==typeof r.index?r.index:0,B=function(){for(var r=i;0!==e[r]&&r<e.length;)r++;if(r>=e.length)throw new Error("Bad BSON Document: illegal CString");var t=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",i,r):convertUint8ArrayToUtf8String(e,i,r);return i=r+1,t},a=t?[]:{},s=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;if(5>s||s>e.length)throw new Error("corrupt bson message");for(;;){var O=e[i++];if(0==O)break;var S=B();switch(O){case BSON.BSON_DATA_OID:var l=supportsBuffer&&Buffer.isBuffer(e)?e.toString("binary",i,i+12):convertArraytoUtf8BinaryString(e,i,i+12);a[S]=new ObjectID(l),i+=12;break;case BSON.BSON_DATA_STRING:var N=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;a[S]=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",i,i+N-1):convertUint8ArrayToUtf8String(e,i,i+N-1),i+=N;break;case BSON.BSON_DATA_INT:a[S]=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;break;case BSON.BSON_DATA_NUMBER:a[S]=readIEEE754(e,i,"little",52,8),i+=8;break;case BSON.BSON_DATA_DATE:var c=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24,y=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;a[S]=new Date(new Long(c,y).toNumber());break;case BSON.BSON_DATA_BOOLEAN:a[S]=1==e[i++];break;case BSON.BSON_DATA_UNDEFINED:case BSON.BSON_DATA_NULL:a[S]=null;break;case BSON.BSON_DATA_BINARY:var p=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24,b=e[i++];if(null!=e.slice)b==Binary.SUBTYPE_BYTE_ARRAY&&(p=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24),a[S]=new Binary(e.slice(i,i+p),b);else{var _="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(p)):new Array(p);b==Binary.SUBTYPE_BYTE_ARRAY&&(p=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24);for(var A=0;p>A;A++)_[A]=e[i+A];a[S]=new Binary(_,b)}i+=p;break;case BSON.BSON_DATA_ARRAY:r.index=i;var T=e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24;a[S]=BSON.deserialize(e,r,!0),i+=T;break;case BSON.BSON_DATA_OBJECT:r.index=i;var T=e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24;a[S]=BSON.deserialize(e,r,!1),i+=T;break;case BSON.BSON_DATA_REGEXP:for(var g=B(),d=B(),E=new Array(d.length),A=0;A<d.length;A++)switch(d[A]){case"m":E[A]="m";break;case"s":E[A]="g";break;case"i":E[A]="i"}a[S]=new RegExp(g,E.join(""));break;case BSON.BSON_DATA_LONG:var c=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24,y=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24,D=new Long(c,y);o?a[S]=D.lessThanOrEqual(JS_INT_MAX_LONG)&&D.greaterThanOrEqual(JS_INT_MIN_LONG)?D.toNumber():D:a[S]=D;break;case BSON.BSON_DATA_SYMBOL:var N=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;a[S]=new Symbol(e.toString("utf8",i,i+N-1)),i+=N;break;case BSON.BSON_DATA_TIMESTAMP:var c=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24,y=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24;a[S]=new Timestamp(c,y);break;case BSON.BSON_DATA_MIN_KEY:a[S]=new MinKey;break;case BSON.BSON_DATA_MAX_KEY:a[S]=new MaxKey;break;case BSON.BSON_DATA_CODE:var N=e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24,m=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",i,i+N-1):convertUint8ArrayToUtf8String(e,i,i+N-1);if(n){if(u){var h=f?crc32(m):m;a[S]=isolateEvalWithHash(functionCache,h,m,a)}else a[S]=isolateEval(m)}else a[S]=new Code(m,{});i+=N;break;case BSON.BSON_DATA_CODE_W_SCOPE:var N=(e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24,e[i++]|e[i++]<<8|e[i++]<<16|e[i++]<<24),m=supportsBuffer&&Buffer.isBuffer(e)?e.toString("utf8",i,i+N-1):convertUint8ArrayToUtf8String(e,i,i+N-1);i+=N,r.index=i;var T=e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24,w=BSON.deserialize(e,r,!1);if(i+=T,n){if(u){var h=f?crc32(m):m;a[S]=isolateEvalWithHash(functionCache,h,m,a)}else a[S]=isolateEval(m);a[S].scope=w}else a[S]=new Code(m,w)}}return null!=a.$id&&(a=new DBRef(a.$ref,a.$id,a.$db)),a},BSON.checkKey=function(e,r){if(e.length){if(~e.indexOf("\x00"))throw Error("key "+e+" must not contain null bytes");if(!r){if("$"==e[0])throw Error("key "+e+" must not start with '$'");if(~e.indexOf("."))throw Error("key "+e+" must not contain '.'")}}},BSON.prototype.deserialize=function(e,r){return BSON.deserialize(e,r)},BSON.prototype.deserializeStream=function(e,r,t,n,u,f){return BSON.deserializeStream(e,r,t,n,u,f)},BSON.prototype.serialize=function(e,r,t,n){return BSON.serialize(e,r,t,n)},BSON.prototype.calculateObjectSize=function(e,r){return BSON.calculateObjectSize(e,r)},BSON.prototype.serializeWithBufferAndIndex=function(e,r,t,n,u){return BSON.serializeWithBufferAndIndex(e,r,t,n,u)},module.exports=BSON,module.exports.Code=Code,module.exports.Symbol=Symbol,module.exports.BSON=BSON,module.exports.DBRef=DBRef,module.exports.Binary=Binary,module.exports.ObjectID=ObjectID,module.exports.Long=Long,module.exports.Timestamp=Timestamp,module.exports.Double=Double,module.exports.MinKey=MinKey,module.exports.MaxKey=MaxKey;