// Copyright 2009 Google Inc. All Rights Reserved
function Timestamp(t,i){return this instanceof Timestamp?(this._bsontype="Timestamp",this.low_=0|t,void(this.high_=0|i)):new Timestamp(t,i)}Timestamp.prototype.toInt=function(){return this.low_},Timestamp.prototype.toNumber=function(){return this.high_*Timestamp.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},Timestamp.prototype.toJSON=function(){return this.toString()},Timestamp.prototype.toString=function(t){var i=t||10;if(2>i||i>36)throw Error("radix out of range: "+i);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(Timestamp.MIN_VALUE)){var e=Timestamp.fromNumber(i),m=this.div(e),s=m.multiply(e).subtract(this);return m.toString(i)+s.toInt().toString(i)}return"-"+this.negate().toString(i)}for(var r=Timestamp.fromNumber(Math.pow(i,6)),s=this,a="";;){var o=s.div(r),p=s.subtract(o.multiply(r)).toInt(),n=p.toString(i);if(s=o,s.isZero())return n+a;for(;n.length<6;)n="0"+n;a=""+n+a}},Timestamp.prototype.getHighBits=function(){return this.high_},Timestamp.prototype.getLowBits=function(){return this.low_},Timestamp.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:Timestamp.TWO_PWR_32_DBL_+this.low_},Timestamp.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(Timestamp.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high_?this.high_:this.low_,i=31;i>0&&0==(t&1<<i);i--);return 0!=this.high_?i+33:i+1},Timestamp.prototype.isZero=function(){return 0==this.high_&&0==this.low_},Timestamp.prototype.isNegative=function(){return this.high_<0},Timestamp.prototype.isOdd=function(){return 1==(1&this.low_)},Timestamp.prototype.equals=function(t){return this.high_==t.high_&&this.low_==t.low_},Timestamp.prototype.notEquals=function(t){return this.high_!=t.high_||this.low_!=t.low_},Timestamp.prototype.lessThan=function(t){return this.compare(t)<0},Timestamp.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},Timestamp.prototype.greaterThan=function(t){return this.compare(t)>0},Timestamp.prototype.greaterThanOrEqual=function(t){return this.compare(t)>=0},Timestamp.prototype.compare=function(t){if(this.equals(t))return 0;var i=this.isNegative(),e=t.isNegative();return i&&!e?-1:!i&&e?1:this.subtract(t).isNegative()?-1:1},Timestamp.prototype.negate=function(){return this.equals(Timestamp.MIN_VALUE)?Timestamp.MIN_VALUE:this.not().add(Timestamp.ONE)},Timestamp.prototype.add=function(t){var i=this.high_>>>16,e=65535&this.high_,m=this.low_>>>16,s=65535&this.low_,r=t.high_>>>16,a=65535&t.high_,o=t.low_>>>16,p=65535&t.low_,n=0,h=0,_=0,T=0;return T+=s+p,_+=T>>>16,T&=65535,_+=m+o,h+=_>>>16,_&=65535,h+=e+a,n+=h>>>16,h&=65535,n+=i+r,n&=65535,Timestamp.fromBits(_<<16|T,n<<16|h)},Timestamp.prototype.subtract=function(t){return this.add(t.negate())},Timestamp.prototype.multiply=function(t){if(this.isZero())return Timestamp.ZERO;if(t.isZero())return Timestamp.ZERO;if(this.equals(Timestamp.MIN_VALUE))return t.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO;if(t.equals(Timestamp.MIN_VALUE))return this.isOdd()?Timestamp.MIN_VALUE:Timestamp.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(Timestamp.TWO_PWR_24_)&&t.lessThan(Timestamp.TWO_PWR_24_))return Timestamp.fromNumber(this.toNumber()*t.toNumber());var i=this.high_>>>16,e=65535&this.high_,m=this.low_>>>16,s=65535&this.low_,r=t.high_>>>16,a=65535&t.high_,o=t.low_>>>16,p=65535&t.low_,n=0,h=0,_=0,T=0;return T+=s*p,_+=T>>>16,T&=65535,_+=m*p,h+=_>>>16,_&=65535,_+=s*o,h+=_>>>16,_&=65535,h+=e*p,n+=h>>>16,h&=65535,h+=m*o,n+=h>>>16,h&=65535,h+=s*a,n+=h>>>16,h&=65535,n+=i*p+e*o+m*a+s*r,n&=65535,Timestamp.fromBits(_<<16|T,n<<16|h)},Timestamp.prototype.div=function(t){if(t.isZero())throw Error("division by zero");if(this.isZero())return Timestamp.ZERO;if(this.equals(Timestamp.MIN_VALUE)){if(t.equals(Timestamp.ONE)||t.equals(Timestamp.NEG_ONE))return Timestamp.MIN_VALUE;if(t.equals(Timestamp.MIN_VALUE))return Timestamp.ONE;var i=this.shiftRight(1),e=i.div(t).shiftLeft(1);if(e.equals(Timestamp.ZERO))return t.isNegative()?Timestamp.ONE:Timestamp.NEG_ONE;var m=this.subtract(t.multiply(e)),s=e.add(m.div(t));return s}if(t.equals(Timestamp.MIN_VALUE))return Timestamp.ZERO;if(this.isNegative())return t.isNegative()?this.negate().div(t.negate()):this.negate().div(t).negate();if(t.isNegative())return this.div(t.negate()).negate();for(var r=Timestamp.ZERO,m=this;m.greaterThanOrEqual(t);){for(var e=Math.max(1,Math.floor(m.toNumber()/t.toNumber())),a=Math.ceil(Math.log(e)/Math.LN2),o=48>=a?1:Math.pow(2,a-48),p=Timestamp.fromNumber(e),n=p.multiply(t);n.isNegative()||n.greaterThan(m);)e-=o,p=Timestamp.fromNumber(e),n=p.multiply(t);p.isZero()&&(p=Timestamp.ONE),r=r.add(p),m=m.subtract(n)}return r},Timestamp.prototype.modulo=function(t){return this.subtract(this.div(t).multiply(t))},Timestamp.prototype.not=function(){return Timestamp.fromBits(~this.low_,~this.high_)},Timestamp.prototype.and=function(t){return Timestamp.fromBits(this.low_&t.low_,this.high_&t.high_)},Timestamp.prototype.or=function(t){return Timestamp.fromBits(this.low_|t.low_,this.high_|t.high_)},Timestamp.prototype.xor=function(t){return Timestamp.fromBits(this.low_^t.low_,this.high_^t.high_)},Timestamp.prototype.shiftLeft=function(t){if(t&=63,0==t)return this;var i=this.low_;if(32>t){var e=this.high_;return Timestamp.fromBits(i<<t,e<<t|i>>>32-t)}return Timestamp.fromBits(0,i<<t-32)},Timestamp.prototype.shiftRight=function(t){if(t&=63,0==t)return this;var i=this.high_;if(32>t){var e=this.low_;return Timestamp.fromBits(e>>>t|i<<32-t,i>>t)}return Timestamp.fromBits(i>>t-32,i>=0?0:-1)},Timestamp.prototype.shiftRightUnsigned=function(t){if(t&=63,0==t)return this;var i=this.high_;if(32>t){var e=this.low_;return Timestamp.fromBits(e>>>t|i<<32-t,i>>>t)}return 32==t?Timestamp.fromBits(i,0):Timestamp.fromBits(i>>>t-32,0)},Timestamp.fromInt=function(t){if(t>=-128&&128>t){var i=Timestamp.INT_CACHE_[t];if(i)return i}var e=new Timestamp(0|t,0>t?-1:0);return t>=-128&&128>t&&(Timestamp.INT_CACHE_[t]=e),e},Timestamp.fromNumber=function(t){return isNaN(t)||!isFinite(t)?Timestamp.ZERO:t<=-Timestamp.TWO_PWR_63_DBL_?Timestamp.MIN_VALUE:t+1>=Timestamp.TWO_PWR_63_DBL_?Timestamp.MAX_VALUE:0>t?Timestamp.fromNumber(-t).negate():new Timestamp(t%Timestamp.TWO_PWR_32_DBL_|0,t/Timestamp.TWO_PWR_32_DBL_|0)},Timestamp.fromBits=function(t,i){return new Timestamp(t,i)},Timestamp.fromString=function(t,i){if(0==t.length)throw Error("number format error: empty string");var e=i||10;if(2>e||e>36)throw Error("radix out of range: "+e);if("-"==t.charAt(0))return Timestamp.fromString(t.substring(1),e).negate();if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+t);for(var m=Timestamp.fromNumber(Math.pow(e,8)),s=Timestamp.ZERO,r=0;r<t.length;r+=8){var a=Math.min(8,t.length-r),o=parseInt(t.substring(r,r+a),e);if(8>a){var p=Timestamp.fromNumber(Math.pow(e,a));s=s.multiply(p).add(Timestamp.fromNumber(o))}else s=s.multiply(m),s=s.add(Timestamp.fromNumber(o))}return s},Timestamp.INT_CACHE_={},Timestamp.TWO_PWR_16_DBL_=65536,Timestamp.TWO_PWR_24_DBL_=1<<24,Timestamp.TWO_PWR_32_DBL_=Timestamp.TWO_PWR_16_DBL_*Timestamp.TWO_PWR_16_DBL_,Timestamp.TWO_PWR_31_DBL_=Timestamp.TWO_PWR_32_DBL_/2,Timestamp.TWO_PWR_48_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_16_DBL_,Timestamp.TWO_PWR_64_DBL_=Timestamp.TWO_PWR_32_DBL_*Timestamp.TWO_PWR_32_DBL_,Timestamp.TWO_PWR_63_DBL_=Timestamp.TWO_PWR_64_DBL_/2,Timestamp.ZERO=Timestamp.fromInt(0),Timestamp.ONE=Timestamp.fromInt(1),Timestamp.NEG_ONE=Timestamp.fromInt(-1),Timestamp.MAX_VALUE=Timestamp.fromBits(-1,2147483647),Timestamp.MIN_VALUE=Timestamp.fromBits(0,-2147483648),Timestamp.TWO_PWR_24_=Timestamp.fromInt(1<<24),module.exports=Timestamp,module.exports.Timestamp=Timestamp;