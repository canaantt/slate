function executeCursors(e,o){for(var r=100,n=0;100>n;n++){var t=e.cursor("test.test",{find:"test.test",query:{a:1}},{readPreference:new ReadPreference("secondary")});t.next(function(e,n){return r-=1,e&&console.dir(e),0==r?o():void 0})}}var ReplSet=require("./lib2/topologies/replset"),ReadPreference=require("./lib2/topologies/read_preference"),server=new ReplSet([{host:"localhost",port:31e3},{host:"localhost",port:31001}],{setName:"rs"});server.on("connect",function(e){console.log("---------------------------------- 0"),e.auth("scram-sha-1","admin","root","root",function(o,r){console.log("---------------------------------- 1"),e.insert("test.test",[{a:1}],function(o,r){console.log("---------------------------------- 2"),console.dir(o),r&&console.dir(r.result);var n=null;e.on("joined",function(e,o){n==o.name&&(console.log("=========== joined :: "+e+" :: "+o.name),executeCursors(o,function(){}))}),executeCursors(e,function(){console.log("============== 0");var o=e.s.replicaSetState.secondaries[0];n=o.name,o.destroy({emitClose:!0})})})})}),server.connect();