"use strict";var MongoError=require("mongodb-core").MongoError,f=require("util").format,Store=function(e,r){var o=this,s=[];r=r||{force:!1,bufferMaxEntries:-1},this.s={storedOps:s,storeOptions:r,topology:e},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return o.s.storedOps.length}})};Store.prototype.add=function(e,r,o,s,t){if(this.s.storeOptions.force)return t(MongoError.create({message:"db closed by application",driver:!0}));if(0==this.s.storeOptions.bufferMaxEntries)return t(MongoError.create({message:f("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){var i=this.s.storedOps.shift();i.c(MongoError.create({message:f("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,n:r,o:o,op:s,c:t})},Store.prototype.addObjectAndMethod=function(e,r,o,s,t){if(this.s.storeOptions.force)return t(MongoError.create({message:"db closed by application",driver:!0}));if(0==this.s.storeOptions.bufferMaxEntries)return t(MongoError.create({message:f("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){var i=this.s.storedOps.shift();i.c(MongoError.create({message:f("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,m:o,o:r,p:s,c:t})},Store.prototype.flush=function(e){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(e||MongoError.create({message:f("no connection available for operation"),driver:!0}))},Store.prototype.execute=function(){var e=this.s.storedOps;for(this.s.storedOps=[];e.length>0;){var r=e.shift();"cursor"==r.t?r.o[r.m].apply(r.o,r.p):"auth"==r.t?this.s.topology[r.t].apply(this.s.topology,r.o):this.s.topology[r.t](r.n,r.o,r.op,r.c)}},Store.prototype.all=function(){return this.s.storedOps};var ServerCapabilities=function(e){var r=function(e,r,o){Object.defineProperty(e,r,{enumerable:!0,get:function(){return o}})},o=!1,s=!1,t=!1,i=!1,n=!1,a=!1,p=e.maxWriteBatchSize||1e3,f=!1,h=!1;e.minWireVersion>=0&&(t=!0),e.maxWireVersion>=1&&(o=!0,i=!0),e.maxWireVersion>=2&&(s=!0),e.maxWireVersion>=3&&(n=!0,a=!0),e.maxWireVersion>=5&&(f=!0,h=!0),null==e.minWireVersion&&(e.minWireVersion=0),null==e.maxWireVersion&&(e.maxWireVersion=0),r(this,"hasAggregationCursor",o),r(this,"hasWriteCommands",s),r(this,"hasTextSearch",t),r(this,"hasAuthCommands",i),r(this,"hasListCollectionsCommand",n),r(this,"hasListIndexesCommand",a),r(this,"minWireVersion",e.minWireVersion),r(this,"maxWireVersion",e.maxWireVersion),r(this,"maxNumberOfDocsInBatch",p),r(this,"commandsTakeWriteConcern",f),r(this,"commandsTakeCollation",h)};exports.Store=Store,exports.ServerCapabilities=ServerCapabilities;