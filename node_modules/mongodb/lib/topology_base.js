"use strict";var MongoError=require("mongodb-core").MongoError,f=require("util").format,Store=function(e,r){var s=this,t=[];r=r||{force:!1,bufferMaxEntries:-1},this.s={storedOps:t,storeOptions:r,topology:e},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return s.s.storedOps.length}})};Store.prototype.add=function(e,r,s,t,o){if(this.s.storeOptions.force)return o(MongoError.create({message:"db closed by application",driver:!0}));if(0==this.s.storeOptions.bufferMaxEntries)return o(MongoError.create({message:f("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){var i=this.s.storedOps.shift();i.c(MongoError.create({message:f("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,n:r,o:s,op:t,c:o})},Store.prototype.addObjectAndMethod=function(e,r,s,t,o){if(this.s.storeOptions.force)return o(MongoError.create({message:"db closed by application",driver:!0}));if(0==this.s.storeOptions.bufferMaxEntries)return o(MongoError.create({message:f("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){var i=this.s.storedOps.shift();i.c(MongoError.create({message:f("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,m:s,o:r,p:t,c:o})},Store.prototype.flush=function(){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(MongoError.create({message:f("no connection available for operation"),driver:!0}))},Store.prototype.execute=function(){var e=this.s.storedOps;for(this.s.storedOps=[];e.length>0;){var r=e.shift();"cursor"==r.t?r.o[r.m].apply(r.o,r.p):this.s.topology[r.t](r.n,r.o,r.op,r.c)}},Store.prototype.all=function(){return this.s.storedOps};var ServerCapabilities=function(e){var r=function(e,r,s){Object.defineProperty(e,r,{enumerable:!0,get:function(){return s}})},s=!1,t=!1,o=!1,i=!1,n=!1,a=!1,f=e.maxWriteBatchSize||1e3;e.minWireVersion>=0&&(o=!0),e.maxWireVersion>=1&&(s=!0,i=!0),e.maxWireVersion>=2&&(t=!0),e.maxWireVersion>=3&&(n=!0,a=!0),null==e.minWireVersion&&(e.minWireVersion=0),null==e.maxWireVersion&&(e.maxWireVersion=0),r(this,"hasAggregationCursor",s),r(this,"hasWriteCommands",t),r(this,"hasTextSearch",o),r(this,"hasAuthCommands",i),r(this,"hasListCollectionsCommand",n),r(this,"hasListIndexesCommand",a),r(this,"minWireVersion",e.minWireVersion),r(this,"maxWireVersion",e.maxWireVersion),r(this,"maxNumberOfDocsInBatch",f)};exports.Store=Store,exports.ServerCapabilities=ServerCapabilities;