function cleanup(){Location.remove(function(){mongoose.disconnect()})}var async=require("async"),mongoose=require("../../lib");require("./geoJSONSchema.js")();var Location=mongoose.model("Location"),data=[{loc:{type:"Point",coordinates:[-20,5]}},{loc:{type:"Point",coordinates:[6,10]}},{loc:{type:"Point",coordinates:[34,-50]}},{loc:{type:"Point",coordinates:[-100,70]}},{loc:{type:"Point",coordinates:[38,38]}}];mongoose.connect("mongodb://localhost/locations",function(o){if(o)throw o;Location.on("index",function(o){if(o)throw o;async.each(data,function(o,n){Location.create(o,n)},function(o){if(o)throw o;var n={type:"Point",coordinates:[-5,5]};Location.find({loc:{$near:n}}).limit(1).exec(function(o,t){if(o)throw o;console.log("Closest to %s is %s",JSON.stringify(n),t),cleanup()})})})});