/*!
 * Module dependencies.
 */
function MongooseDocumentArray(e,t,r){var n=[].concat(e);n._path=t;for(var o={isMongooseArray:!0,isMongooseDocumentArray:!0,validators:[],_atomics:{},_schema:void 0,_handlers:void 0},i=Object.keys(MongooseArray.mixin),s=i.length,a=0;s>a;++a)n[i[a]]=MongooseArray.mixin[i[a]];var c=Object.keys(MongooseDocumentArray.mixin);s=c.length;for(var u=0;s>u;++u)n[c[u]]=MongooseDocumentArray.mixin[c[u]];var f=Object.keys(o);s=f.length;for(var h=0;s>h;++h)n[f[h]]=o[f[h]];return r&&r instanceof Document&&(n._parent=r,n._schema=r.schema.path(t),n._handlers={isNew:n.notify("isNew"),save:n.notify("save")},r.on("save",n._handlers.save),r.on("isNew",n._handlers.isNew)),n}var MongooseArray=require("./array"),ObjectId=require("./objectid"),ObjectIdSchema=require("../schema/objectid"),utils=require("../utils"),Document=require("../document");/*!
 * Inherits from MongooseArray
 */
MongooseDocumentArray.mixin={_cast:function(e,t){return e instanceof this._schema.casterConstructor?(e.__parent&&e.__parentArray||(e.__parent=this._parent,e.__parentArray=this),e.__index=t,e):void 0===e||null===e?null:((Buffer.isBuffer(e)||e instanceof ObjectId||!utils.isObject(e))&&(e={_id:e}),new this._schema.casterConstructor(e,this,void 0,void 0,t))},id:function(e){var t,r,n;try{var o=ObjectIdSchema.prototype.cast.call({},e);o&&(t=String(o))}catch(i){t=null}for(var s=0,a=this.length;a>s;s++)if(n=this[s].get("_id"),null!==n&&"undefined"!=typeof n)if(n instanceof Document){if(r||(r=String(e)),r==n._id)return this[s]}else if(e instanceof ObjectId||n instanceof ObjectId){if(t==n)return this[s]}else if(utils.deepEqual(e,n))return this[s];return null},toObject:function(e){return this.map(function(t){return t&&t.toObject(e)||null})},inspect:function(){return Array.prototype.slice.call(this)},create:function(e){return new this._schema.casterConstructor(e)},notify:function(e){var t=this;return function(r){for(var n=t.length;n--;)if(t[n]){switch(e){case"save":r=t[n]}t[n].emit(e,r)}}}},/*!
 * Module exports.
 */
module.exports=MongooseDocumentArray;