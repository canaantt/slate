function Subdocument(e,t){this.$isSingleNested=!0,Document.call(this,e,t)}/*!
 * Registers remove event listeners for triggering
 * on subdocuments.
 *
 * @param {EmbeddedDocument} sub
 * @api private
 */
function registerRemoveListener(e){function t(){n.removeListener("save",t),n.removeListener("remove",t),e.emit("remove",e),n=e=null}var n=e.ownerDocument();n.on("save",t),n.on("remove",t)}var Document=require("../document"),PromiseProvider=require("../promise_provider");module.exports=Subdocument,Subdocument.prototype=Object.create(Document.prototype),Subdocument.prototype.save=function(e){var t=PromiseProvider.get();return new t.ES6(function(t){e&&e(),t()})},Subdocument.prototype.$isValid=function(e){return this.$parent?this.$parent.$isValid([this.$basePath,e].join(".")):void 0},Subdocument.prototype.markModified=function(e){Document.prototype.markModified.call(this,e),this.$parent&&this.$parent.markModified([this.$basePath,e].join("."))},Subdocument.prototype.$markValid=function(e){this.$parent&&this.$parent.$markValid([this.$basePath,e].join("."))},Subdocument.prototype.invalidate=function(e,t,n){if(this.$parent)this.$parent.invalidate([this.$basePath,e].join("."),t,n);else if("cast"===t.kind||"CastError"===t.name)throw t},Subdocument.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;var e=this.$parent;if(!e)return this;for(;e.$parent||e.__parent;)e=e.$parent||e.__parent;return this.$__.ownerDocument=e,this.$__.ownerDocument},Subdocument.prototype.remove=function(e,t){"function"==typeof e&&(t=e,e=null),this.$parent.set(this.$basePath,null),registerRemoveListener(this),"function"==typeof t&&t(null)};