/*!
 * Module dependencies.
 */
function EmbeddedDocument(e,t,r,n,o){t?(this.__parentArray=t,this.__parent=t._parent):(this.__parentArray=void 0,this.__parent=void 0),this.__index=o,Document.call(this,e,n,r);var i=this;this.on("isNew",function(e){i.isNew=e})}/*!
 * Registers remove event listeners for triggering
 * on subdocuments.
 *
 * @param {EmbeddedDocument} sub
 * @api private
 */
function registerRemoveListener(e){function t(){r.removeListener("save",t),r.removeListener("remove",t),e.emit("remove",e),r=e=null}var r=e.ownerDocument();r.on("save",t),r.on("remove",t)}var Document=require("../document_provider")(),PromiseProvider=require("../promise_provider");/*!
 * Inherit from Document
 */
EmbeddedDocument.prototype=Object.create(Document.prototype),EmbeddedDocument.prototype.constructor=EmbeddedDocument,EmbeddedDocument.prototype.markModified=function(e){this.$__.activePaths.modify(e),this.__parentArray&&(this.isNew?this.__parentArray._markModified():this.__parentArray._markModified(this,e))},EmbeddedDocument.prototype.save=function(e){var t=PromiseProvider.get();return new t.ES6(function(t){e&&e(),t()})},EmbeddedDocument.prototype.remove=function(e,t){if("function"!=typeof e||t||(t=e,e=void 0),!this.__parentArray||e&&e.noop)return t&&t(null),this;var r;if(!this.willRemove){if(r=this._doc._id,!r)throw new Error("For your own good, Mongoose does not know how to remove an EmbeddedDocument that has no _id");this.__parentArray.pull({_id:r}),this.willRemove=!0,registerRemoveListener(this)}return t&&t(null),this},EmbeddedDocument.prototype.update=function(){throw new Error("The #update method is not available on EmbeddedDocuments")},EmbeddedDocument.prototype.inspect=function(){return this.toObject()},EmbeddedDocument.prototype.invalidate=function(e,t,r,n){if(!this.__parent)throw t;var o=this.__index;if("undefined"!=typeof o){var i=this.__parentArray._path,_=[i,o,e].join(".");this.__parent.invalidate(_,t,r)}return n&&(this.$__.validationError=this.ownerDocument().$__.validationError),!0},EmbeddedDocument.prototype.$markValid=function(e){if(this.__parent){var t=this.__index;if("undefined"!=typeof t){var r=this.__parentArray._path,n=[r,t,e].join(".");this.__parent.$markValid(n)}}},EmbeddedDocument.prototype.$isValid=function(e){var t=this.__index;return"undefined"!=typeof t?!this.__parent.$__.validationError||!this.__parent.$__.validationError.errors[this.$__fullPath(e)]:!0},EmbeddedDocument.prototype.ownerDocument=function(){if(this.$__.ownerDocument)return this.$__.ownerDocument;var e=this.__parent;if(!e)return this;for(;e.__parent||e.$parent;)e=e.__parent||e.$parent;return this.$__.ownerDocument=e,this.$__.ownerDocument},EmbeddedDocument.prototype.$__fullPath=function(e){if(!this.$__.fullPath){var t=this;if(!t.__parent)return e;for(var r=[];t.__parent||t.$parent;)t.__parent?r.unshift(t.__parentArray._path):r.unshift(t.$basePath),t=t.__parent||t.$parent;this.$__.fullPath=r.join("."),this.$__.ownerDocument||(this.$__.ownerDocument=t)}return e?this.$__.fullPath+"."+e:this.$__.fullPath},EmbeddedDocument.prototype.parent=function(){return this.__parent},EmbeddedDocument.prototype.parentArray=function(){return this.__parentArray},/*!
 * Module exports.
 */
module.exports=EmbeddedDocument;