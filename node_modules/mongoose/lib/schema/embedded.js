"use strict";function Embedded(e,t,o){var r=function(e,t,o){var r=this;Subdocument.apply(this,arguments),this.$parent=o,o&&o.on("save",function(){r.emit("save",r)})};r.prototype=Object.create(Subdocument.prototype),r.prototype.$__setSchema(e),r.schema=e,r.$isSingleNested=!0,r.prototype.$basePath=t;for(var a in e.methods)r.prototype[a]=e.methods[a];for(a in e.statics)r[a]=e.statics[a];this.caster=r,this.schema=e,this.$isSingleNested=!0,SchemaType.call(this,t,o,"Embedded")}/*!
 * Module dependencies.
 */
var SchemaType=require("../schematype"),Subdocument=require("../types/subdocument"),castToNumber=require("./operators/helpers").castToNumber,geospatial=require("./operators/geospatial");module.exports=Embedded,Embedded.prototype=Object.create(SchemaType.prototype),Embedded.prototype.$conditionalHandlers.$geoWithin=function(e){return{$geometry:this.castForQuery(e.$geometry)}},/*!
 * ignore
 */
Embedded.prototype.$conditionalHandlers.$near=Embedded.prototype.$conditionalHandlers.$nearSphere=geospatial.cast$near,Embedded.prototype.$conditionalHandlers.$within=Embedded.prototype.$conditionalHandlers.$geoWithin=geospatial.cast$within,Embedded.prototype.$conditionalHandlers.$geoIntersects=geospatial.cast$geoIntersects,Embedded.prototype.$conditionalHandlers.$minDistance=castToNumber,Embedded.prototype.$conditionalHandlers.$maxDistance=castToNumber,Embedded.prototype.cast=function(e,t,o){if(e&&e.$isSingleNested)return e;var r=new this.caster(void 0,t?t.$__.selected:void 0,t);return o?r.init(e):r.set(e,void 0,!0),r},Embedded.prototype.castForQuery=function(e,t){var o;if(2===arguments.length){if(o=this.$conditionalHandlers[e],!o)throw new Error("Can't use "+e);return o.call(this,t)}return t=e,null==t?t:new this.caster(t).toObject({virtuals:!1})},Embedded.prototype.doValidate=function(e,t){SchemaType.prototype.doValidate.call(this,e,function(o){return o?t(o):e?void e.validate(t,{__noPromise:!0}):t(null)})},Embedded.prototype.doValidateSync=function(e){var t=SchemaType.prototype.doValidateSync.call(this,e);if(t)return t;if(e)return e.validateSync()};