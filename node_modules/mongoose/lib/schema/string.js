/*!
 * Module dependencies.
 */
function SchemaString(t,e){this.enumValues=[],this.regExp=null,SchemaType.call(this,t,e,"String")}/*!
 * ignore
 */
function handleSingle(t){return this.castForQuery(t)}function handleArray(t){var e=this;return Array.isArray(t)?t.map(function(t){return e.castForQuery(t)}):[this.castForQuery(t)]}var SchemaType=require("../schematype"),CastError=SchemaType.CastError,MongooseError=require("../error"),utils=require("../utils"),Document;SchemaString.schemaName="String",/*!
 * Inherits from SchemaType.
 */
SchemaString.prototype=Object.create(SchemaType.prototype),SchemaString.prototype.constructor=SchemaString,SchemaString.prototype["enum"]=function(){if(this.enumValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.enumValidator},this),this.enumValidator=!1),void 0===arguments[0]||arguments[0]===!1)return this;var t,e;utils.isObject(arguments[0])?(t=arguments[0].values,e=arguments[0].message):(t=arguments,e=MongooseError.messages.String["enum"]);for(var r=0;r<t.length;r++)void 0!==t[r]&&this.enumValues.push(this.cast(t[r]));var n=this.enumValues;return this.enumValidator=function(t){return void 0===t||~n.indexOf(t)},this.validators.push({validator:this.enumValidator,message:e,type:"enum",enumValues:n}),this},SchemaString.prototype.lowercase=function(){return this.set(function(t,e){return"string"!=typeof t&&(t=e.cast(t)),t?t.toLowerCase():t})},SchemaString.prototype.uppercase=function(){return this.set(function(t,e){return"string"!=typeof t&&(t=e.cast(t)),t?t.toUpperCase():t})},SchemaString.prototype.trim=function(){return this.set(function(t,e){return"string"!=typeof t&&(t=e.cast(t)),t&&e.options.trim?t.trim():t})},SchemaString.prototype.minlength=function(t,e){if(this.minlengthValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.minlengthValidator},this)),null!==t&&void 0!==t){var r=e||MongooseError.messages.String.minlength;r=r.replace(/{MINLENGTH}/,t),this.validators.push({validator:this.minlengthValidator=function(e){return null===e||e.length>=t},message:r,type:"minlength",minlength:t})}return this},SchemaString.prototype.maxlength=function(t,e){if(this.maxlengthValidator&&(this.validators=this.validators.filter(function(t){return t.validator!==this.maxlengthValidator},this)),null!==t&&void 0!==t){var r=e||MongooseError.messages.String.maxlength;r=r.replace(/{MAXLENGTH}/,t),this.validators.push({validator:this.maxlengthValidator=function(e){return null===e||e.length<=t},message:r,type:"maxlength",maxlength:t})}return this},SchemaString.prototype.match=function(t,e){var r=e||MongooseError.messages.String.match,n=function(e){if(!t)return!1;var r=null!=e&&""!==e?t.test(e):!0;return r};return this.validators.push({validator:n,message:r,type:"regexp",regexp:t}),this},SchemaString.prototype.checkRequired=function(t,e){return SchemaType._isRef(this,t,e,!0)?!!t:(t instanceof String||"string"==typeof t)&&t.length},SchemaString.prototype.cast=function(t,e,r){if(SchemaType._isRef(this,t,e,r)){if(null===t||void 0===t)return t;if(Document||(Document=require("./../document")),t instanceof Document)return t.$__.wasPopulated=!0,t;if("string"==typeof t)return t;if(Buffer.isBuffer(t)||!utils.isObject(t))throw new CastError("string",t,this.path);var n=e.$__fullPath(this.path),i=e.ownerDocument?e.ownerDocument():e,a=i.populated(n,!0),o=new a.options.model(t);return o.$__.wasPopulated=!0,o}if(null===t||void 0===t)return t;if("undefined"!=typeof t){if(t._id&&"string"==typeof t._id)return t._id;if(t.toString&&t.toString!==Object.prototype.toString)return t.toString()}throw new CastError("string",t,this.path)},SchemaString.prototype.$conditionalHandlers=utils.options(SchemaType.prototype.$conditionalHandlers,{$all:handleArray,$gt:handleSingle,$gte:handleSingle,$lt:handleSingle,$lte:handleSingle,$options:handleSingle,$regex:handleSingle}),SchemaString.prototype.castForQuery=function(t,e){var r;if(2===arguments.length){if(r=this.$conditionalHandlers[t],!r)throw new Error("Can't use "+t+" with String.");return r.call(this,e)}return e=t,"[object RegExp]"===Object.prototype.toString.call(e)?e:this.cast(e)},/*!
 * Module exports.
 */
module.exports=SchemaString;